[{"label": "eq:precedes",
"index": "3.1",
"tex": "\\begin{align}\\label{eq:precedes}\n  y \\prec x \\Longleftrightarrow \\exists f: y = f(x)\n\\end{align}"},
{"label": "eq:substituteifnothing",
"index": "3.2",
"tex": "\\begin{align}\\label{eq:substituteifnothing}\n  \\subifnone{a_0, \\dots a\\sub{n}} \\equiv a\\sub{x} : (a\\sub{x} \\ne \\none \\vee x = n), \\bigwedge_{i=0}^{x-1} a\\sub{i} = \\none\n\\end{align}"},
{"label": null,
"index": "3.3",
"tex": "\\begin{equation}\n  \\dictionary{\\mathrm{K}}{\\mathrm{V}} \\subset \\protoset{\\tuple{\\mathrm{K}, \\mathrm{V}}}\n\\end{equation}"},
{"label": null,
"index": "3.4",
"tex": "\\begin{equation}\n  \\forall \\mathrm{K}, \\mathrm{V}, \\mathbf{d} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}} : \\forall \\tup{k, v} \\in \\mathbf{d} : \\exists! v' : \\tup{k, v'} \\in \\mathbf{d}\n\\end{equation}"},
{"label": null,
"index": "3.5",
"tex": "\\begin{align}\n  &\\dictionary{\\mathrm{K}}{\\mathrm{V}} \\equiv \\protoset{\\keyvalue{\\mathrm{K}}{\\mathrm{V}}}"},
{"label": null,
"index": "3.6",
"tex": "\n  &\\mathbf{p} \\in \\keyvalue{\\mathrm{K}}{\\mathrm{V}} \\Leftrightarrow \\exists k \\in \\mathrm{K}, v \\in \\mathrm{V}, \\mathbf{p} \\equiv \\kv{k}{v}\n\\end{align}"},
{"label": null,
"index": "3.7",
"tex": "\\begin{align}\n  &\\forall \\mathrm{K}, \\mathrm{V}, \\mathbf{d} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}}: \\mathbf{d}\\subb{k} \\equiv \\begin{cases}\n    v & \\text{if}\\ \\exists k : \\kv{k}{v} \\in \\mathbf{d} \n    \\none & \\otherwise\n  \\end{cases}"},
{"label": null,
"index": "3.8",
"tex": "\n  &\\begin{aligned}\n    &\\forall \\mathrm{K}, \\mathrm{V}, \\mathbf{d} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}}, \\mathbf{s} \\subseteq K:\n    &\\quad \\mathbf{d} \\setminus \\mathbf{s} \\equiv \\set{ \\kv{k}{v}: \\kv{k}{v} \\in \\mathbf{d}, k \\not\\in \\mathbf{s} }\n  \\end{aligned}\n\\end{align}"},
{"label": null,
"index": "3.9",
"tex": "\\begin{align}\n  \\forall \\mathrm{K}, \\mathrm{V}, \\mathbf{d} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}} : \\keys{\\mathbf{d}} &\\equiv \\set{\\build{k}{\\exists v : \\kv{k}{v} \\in \\mathbf{d}}} "},
{"label": null,
"index": "3.10",
"tex": "\n  \\forall \\mathrm{K}, \\mathrm{V}, \\mathbf{d} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}} : \\values{\\mathbf{d}} &\\equiv \\set{\\build{v}{\\exists k : \\kv{k}{v} \\in \\mathbf{d}}}\n\\end{align}"},
{"label": null,
"index": "3.11",
"tex": "\\begin{equation}\n  \\forall \\mathbf{d} \\in \\mathrm{K}, \\mathrm{V}, \\tup{\\mathbf{d}, \\mathbf{e}} \\in \\dictionary{\\mathrm{K}}{\\mathrm{V}}^2 : \\mathbf{d} \\cup \\mathbf{e} \\equiv (\\mathbf{d} \\setminus \\keys{\\mathbf{e}}) \\cup \\mathbf{e}\n\\end{equation}"},
{"label": "eq:statetransition",
"index": "4.1",
"tex": "\\begin{align}\\label{eq:statetransition}\n\\thestate' \\equiv \\transitionstate(\\thestate, \\block)\n\\end{align}"},
{"label": "eq:block",
"index": "4.2",
"tex": "\\begin{align}\n  \\label{eq:block}\\block &\\equiv \\tup{\\header, \\extrinsic} "},
{"label": "eq:extrinsic",
"index": "4.3",
"tex": "\n  \\label{eq:extrinsic}\\extrinsic &\\equiv \\tup{\\xttickets, \\xtdisputes, \\xtpreimages, \\xtassurances, \\xtguarantees}\n\\end{align}"},
{"label": "eq:statecomposition",
"index": "4.4",
"tex": "\\begin{align}\\label{eq:statecomposition}\n  \\thestate &\\equiv \\tup{\\authpool, \\recent, \\lastaccout, \\safrole, \\accounts, \\entropy, \\stagingset, \\activeset, \\previousset, \\reports, \\thetime, \\authqueue, \\privileges, \\disputes, \\activity, \\ready, \\accumulated}\n\\end{align}"},
{"label": "eq:transitionfunctioncomposition",
"index": "4.5",
"tex": "\\begin{align}\\label{eq:transitionfunctioncomposition}\n  \\thetime' &\\prec \\theheader "},
{"label": "eq:betadagger",
"index": "4.6",
"tex": "\n  \\recenthistorypostparentstaterootupdate &\\prec \\tup{\\theheader, \\recenthistory} \\label{eq:betadagger} "},
{"label": null,
"index": "4.7",
"tex": "\n  \\safrole' &\\prec \\tup{\\theheader, \\thetime, \\xttickets, \\safrole, \\stagingset, \\entropy', \\activeset', \\disputes'} "},
{"label": null,
"index": "4.8",
"tex": "\n  \\entropy' &\\prec \\tup{\\theheader, \\thetime, \\entropy} "},
{"label": null,
"index": "4.9",
"tex": "\n  \\activeset' &\\prec \\tup{\\theheader, \\thetime, \\activeset, \\safrole} "},
{"label": null,
"index": "4.10",
"tex": "\n  \\previousset' &\\prec \\tup{\\theheader, \\thetime, \\previousset, \\activeset} "},
{"label": null,
"index": "4.11",
"tex": "\n  \\disputes' &\\prec \\tup{\\xtdisputes, \\disputes} "},
{"label": "eq:rhodagger",
"index": "4.12",
"tex": "\n  \\reportspostjudgement &\\prec \\tup{\\xtdisputes, \\reports} \\label{eq:rhodagger} "},
{"label": "eq:rhoddagger",
"index": "4.13",
"tex": "\n  \\reportspostguarantees &\\prec \\tup{\\xtassurances, \\reportspostjudgement} \\label{eq:rhoddagger} "},
{"label": "eq:rhoprime",
"index": "4.14",
"tex": "\n  \\reports' &\\prec \\tup{\\xtguarantees, \\reportspostguarantees, \\activeset, \\thetime'} \\label{eq:rhoprime} "},
{"label": null,
"index": "4.15",
"tex": "\n  \\justbecameavailable^* &\\prec \\tup{\\xtassurances, \\reportspostjudgement} "},
{"label": "eq:accountspostxfer",
"index": "4.16",
"tex": "\n  \\tup{\\ready', \\accumulated', \\accountspostxfer, \\privileges', \\stagingset', \\authqueue', \\lastaccout', \\accumulationstatistics, \\deferredtransfersstatistics} &\\prec \\tup{\\justbecameavailable^*, \\ready, \\accumulated, \\accountspre, \\privileges, \\stagingset, \\authqueue, \\thetime, \\thetime'} \\label{eq:accountspostxfer} "},
{"label": "eq:betaprime",
"index": "4.17",
"tex": "\n  \\recenthistory' &\\prec \\tup{\\theheader, \\xtguarantees, \\recenthistorypostparentstaterootupdate, \\lastaccout'} \\label{eq:betaprime} "},
{"label": "eq:accountspostpreimage",
"index": "4.18",
"tex": "\n  \\accountspostpreimage &\\prec \\tup{\\xtpreimages, \\accountspostxfer, \\thetime'} \\label{eq:accountspostpreimage} "},
{"label": null,
"index": "4.19",
"tex": "\n  \\authpool' &\\prec \\tup{\\theheader, \\xtguarantees, \\authqueue', \\authpool} "},
{"label": null,
"index": "4.20",
"tex": "\n  \\activity' &\\prec \\tup{\\xtguarantees, \\xtpreimages, \\xtassurances, \\xttickets, \\thetime, \\activeset', \\activity, \\theheader, \\accumulationstatistics, \\deferredtransfersstatistics}\\!\\!\\!\\!\\!\\!\\!\\!\n\\end{align}"},
{"label": "eq:balance",
"index": "4.21",
"tex": "\\begin{align}\\label{eq:balance}\n  \\balance \\equiv \\Nbits{64}\n\\end{align}"},
{"label": null,
"index": "4.22",
"tex": "\\begin{equation}\n  \\Psi\\colon\n  \\tuple{\\,\n    \\begin{alignedat}{3}\n      &\\blob,\\,\\ \\ \\pvmreg,\\,\\ \\ &&\\gas,\\,\\\\\n      &\\!\\sequence[13]{\\pvmreg},\\,\\ \\ &&\\ram\\\\\n    \\end{alignedat}\n  \\,}\n  \\to\n  \\tuple{\\,\n    \\begin{aligned}\n      &\\set{\\halt, \\panic, \\oog} \\cup \\set{\\fault,\\host} \\times \\pvmreg,\\\\\n      &\\pvmreg,\\ \\ \\signedgas,\\ \\ \\sequence[13]{\\pvmreg},\\ \\ \\ram\n    \\end{aligned}\n  \\,}\n\\end{equation}"},
{"label": "eq:gasregentry",
"index": "4.23",
"tex": "\\begin{equation}\\label{eq:gasregentry}\n  \\signedgas \\equiv \\Z_{-2^{63}\\dots2^{63}}\\ ,\\quad\n  \\gas \\equiv \\Nbits{64}\\ ,\\quad\n  \\pvmreg \\equiv \\Nbits{64}\n\\end{equation}"},
{"label": "eq:pvmmemory",
"index": "4.24",
"tex": "\\begin{align}\\label{eq:pvmmemory}\n  \\ram &\\equiv \\tuple{\n    \\isa{\\ram\u00acvalue}{\\blob[2^{32}]},\n    \\isa{\\ram\u00acaccess}{\\sequence[p]{\\set{\\text{W}, \\text{R}, \\none}}}\n  }\\,,\\ p = \\frac{2^{32}}{\\Cpvmpagesize}"},
{"label": null,
"index": "4.25",
"tex": "\n  \\Cpvmpagesize &= 2^{12}\n\\end{align}"},
{"label": null,
"index": "4.26",
"tex": "\\begin{align}\n  \\readable{\\memory} &\\equiv \\set{\\build{i}{\\memory_\\ram\u00acaccess\\subb{\\floor{\\nicefrac{i}{\\Cpvmpagesize}}} \\ne \\none}} "},
{"label": null,
"index": "4.27",
"tex": "\n  \\writable{\\memory} &\\equiv \\set{\\build{i}{\\memory_\\ram\u00acaccess\\subb{\\floor{\\nicefrac{i}{\\Cpvmpagesize}}} = \\text{W} }}\n\\end{align}"},
{"label": "eq:time",
"index": "4.28",
"tex": "\\begin{align}\\label{eq:time}\n  \\timeslot \\equiv \\Nbits{32}\n\\end{align}"},
{"label": "eq:header",
"index": "5.1",
"tex": "\\begin{equation}\\label{eq:header}\n  \\theheader \\equiv \\tup{\\H_\\\u00acparent, \\H_\\\u00acpriorstateroot, \\H_\\\u00acextrinsichash, \\H_\\\u00actimeslot, \\H_\\\u00acepochmark, \\H_\\\u00acwinnersmark, \\H_\\\u00acoffendersmark, \\H_\\\u00acauthorindex, \\H_\\\u00acvrfsig, \\H_\\\u00acsealsig}\n\\end{equation}"},
{"label": null,
"index": "5.2",
"tex": "\\begin{equation}\n  \\header_\\\u00acparent \\in \\hash \\,,\\quad \\H_\\\u00acparent \\equiv \\blake{\\encode{\\getparent{\\header}}}\n\\end{equation}"},
{"label": "eq:ancestors",
"index": "5.3",
"tex": "\\begin{align}\\label{eq:ancestors}\n  h \\in \\ancestors \\Leftrightarrow h = \\header \\vee (\\exists i \\in \\ancestors : h = \\getparent{i})\n\\end{align}"},
{"label": null,
"index": "5.4",
"tex": "\\begin{align}\n  \\H_\\\u00acextrinsichash &\\in \\hash \\ ,\\quad\n  \\H_\\\u00acextrinsichash \\equiv \\blake{\\encode{\\blakemany{\\mathbf{a}}}} "},
{"label": null,
"index": "5.5",
"tex": "\n  \\where \\mathbf{a} &= \\sq{\n    \\encodetickets{\\xttickets},\n    \\encodepreimages{\\xtpreimages},\n    \\mathbf{g},\n    \\encodeassurances{\\xtassurances},\n    \\encodedisputes{\\xtdisputes}\n  } "},
{"label": null,
"index": "5.6",
"tex": "\n  \\also \\mathbf{g} &= \\encode{\\var{\\sq{\\build{\n    \\tup{\\blake{\\xg\u00acworkreport}, \\encode[4]{\\xg\u00actimeslot}, \\var{\\xg\u00accredential}}\n  }{\n    \\tup{\\xg\u00acworkreport, \\xg\u00actimeslot, \\xg\u00accredential} \\orderedin \\xtguarantees\n  }}}}\n\\end{align}"},
{"label": null,
"index": "5.7",
"tex": "\\begin{equation}\n  \\H_\\\u00actimeslot \\in \\timeslot \\,,\\quad\n  \\getparent{\\H}_\\\u00actimeslot < \\H_\\\u00actimeslot\\ \\wedge\\ \\H_\\\u00actimeslot\\cdot\\Cslotseconds \\leq \\wallclock\n\\end{equation}"},
{"label": null,
"index": "5.8",
"tex": "\\begin{equation}\n  \\H_\\\u00acpriorstateroot \\in \\hash \\,,\\quad \\H_\\\u00acpriorstateroot \\equiv \\merklizestate{\\thestate}\n\\end{equation}"},
{"label": null,
"index": "5.9",
"tex": "\\begin{equation}\n  \\H_\\\u00acauthorindex \\in \\valindex \\,,\\quad \\H_\\\u00acauthorbskey \\equiv \\activeset'[\\H_\\\u00acauthorindex]_\\vk\u00acbs\n\\end{equation}"},
{"label": null,
"index": "5.10",
"tex": "\\begin{equation}\n  \\H_\\\u00acepochmark \\in \\optional{\\tuple{\\hash, \\hash, \\sequence[\\Cvalcount]{\\tuple{\\bskey, \\edkey}}}}\\,,\\quad\n  \\H_\\\u00acwinnersmark \\in \\optional{\\sequence[\\Cepochlen]{\\safroleticket}}\\,,\\quad\n  \\H_\\\u00acoffendersmark \\in \\sequence{\\edkey}\n\\end{equation}"},
{"label": "eq:timeslotindex",
"index": "6.1",
"tex": "\\begin{equation}\n  \\label{eq:timeslotindex}\n  \\thetime \\in \\timeslot \\ ,\\quad\n  \\thetime' \\equiv \\H_\\\u00actimeslot\n\\end{equation}"},
{"label": null,
"index": "6.2",
"tex": "\\begin{align}\n  \\mathrm{let}\\quad e \\remainder m = \\frac{\\thetime}{\\Cepochlen} \\,,\\quad\n  e' \\remainder m' = \\frac{\\thetime'}{\\Cepochlen}\n\\end{align}"},
{"label": "eq:consensusstatecomposition",
"index": "6.3",
"tex": "\\begin{align}\n  \\label{eq:consensusstatecomposition}\n  \\safrole &\\equiv \\tuple{\n    \\pendingset,\\,\n    \\epochroot,\\,\n    \\sealtickets,\\,\n    \\ticketaccumulator\n  }\n\\end{align}"},
{"label": "eq:epochrootspec",
"index": "6.4",
"tex": "\\begin{align}\n  \\label{eq:epochrootspec}\n  \\epochroot &\\in \\ringroot\n\\end{align}"},
{"label": "eq:ticketaccumulatorsealticketsspec",
"index": "6.5",
"tex": "\\begin{align}\n  \\label{eq:ticketaccumulatorsealticketsspec}\n  \\ticketaccumulator \\in \\sequence[:\\Cepochlen]{\\safroleticket} \\,,\\quad\n  \\sealtickets \\in \\sequence[\\Cepochlen]{\\safroleticket} \\cup \\sequence[\\Cepochlen]{\\bskey}\n\\end{align}"},
{"label": "eq:ticket",
"index": "6.6",
"tex": "\\begin{align}\n  \\label{eq:ticket}\n  \\safroleticket &\\equiv \\tuple{\n    \\isa{\\st\u00acid}{\\hash},\\,\n    \\isa{\\st\u00acentryindex}{\\ticketentryindex}\n  }\n\\end{align}"},
{"label": "eq:validatorkeys",
"index": "6.7",
"tex": "\\begin{align}\n  \\label{eq:validatorkeys}\n  \\stagingset \\in \\allvalkeys \\;,\\quad\n  \\pendingset \\in \\allvalkeys \\;,\\quad\n  \\activeset \\in \\allvalkeys \\;,\\quad\n  \\previousset \\in \\allvalkeys\n\\end{align}"},
{"label": null,
"index": "6.8",
"tex": "\\begin{align}\n  \\valkey &\\equiv \\blob[336] "},
{"label": null,
"index": "6.9",
"tex": "\n  \\forall \\vkX \\in \\valkey : \\vkX_\\vk\u00acbs \\in \\bskey &\\equiv \\vkX\\subrange{0}{32} "},
{"label": null,
"index": "6.10",
"tex": "\n  \\forall \\vkX \\in \\valkey : \\vkX_\\vk\u00aced \\in \\edkey &\\equiv \\vkX\\subrange{32}{32} "},
{"label": null,
"index": "6.11",
"tex": "\n  \\forall \\vkX \\in \\valkey : \\vkX_\\vk\u00acbls \\in \\blskey &\\equiv \\vkX\\subrange{64}{144} "},
{"label": null,
"index": "6.12",
"tex": "\n  \\forall \\vkX \\in \\valkey : \\vkX_\\vk\u00acmetadata \\in \\metadatakey &\\equiv \\vkX\\subrange{208}{128}\n\\end{align}"},
{"label": null,
"index": "6.13",
"tex": "\\begin{align}\n  \\tup{\\pendingset', \\activeset', \\previousset', \\epochroot'} &\\equiv \\begin{cases}\n    (\\Phi(\\stagingset), \\pendingset, \\activeset, z) &\\when e' > e  \\tup{\\pendingset, \\activeset, \\previousset, \\epochroot} &\\otherwise\n  \\end{cases} \n  \\nonumber \\where z &= \\getringroot{\\sq{\\build{k_\\vk\u00acbs}{k \\orderedin \\pendingset'}}} "},
{"label": "eq:blacklistfilter",
"index": "6.14",
"tex": "\n  \\label{eq:blacklistfilter} \\Phi(\\mathbf{k}) &\\equiv \\sq{\n    \\build{\n      \\begin{rcases}\n        \\sq{0, 0, \\dots} &\\when \\vkX_\\vk\u00aced \\in \\offenders' \n        \\vkX &\\otherwise\n      \\end{rcases}\n    }{\n      \\vkX \\orderedin \\mathbf{k}\n    }\n  }\n\\end{align}"},
{"label": "eq:ticketconditiontrue",
"index": "6.15",
"tex": "\n  \\label{eq:ticketconditiontrue}\n  \\safroleticket \\in \\sequence{\\safroleticket} &\\implies \\abracegroup[\\,]{\n      &i_\\st\u00acid = \\banderout{\\H_\\\u00acsealsig}\\,,"},
{"label": null,
"index": "6.16",
"tex": "\n      &\\H_\\\u00acsealsig \\in \\bssignature{\\H_\\\u00acauthorbskey}{\\Xticket \\concat \\entropy'_3 \\append i_\\st\u00acentryindex}{\\encodeunsignedheader{\\H}}\\,,"},
{"label": null,
"index": "6.17",
"tex": "\n      &\\isticketed = 1\n  }"},
{"label": "eq:ticketconditionfalse",
"index": "6.18",
"tex": "\n  \\label{eq:ticketconditionfalse}\n  \\safroleticket \\in \\sequence{\\bskey} &\\implies \\abracegroup[\\,]{\n      &i = \\H_\\\u00acauthorbskey\\,,"},
{"label": null,
"index": "6.19",
"tex": "\n      &\\H_\\\u00acsealsig \\in \\bssignature{\\H_\\\u00acauthorbskey}{\\Xfallback \\concat \\entropy'_3}{\\encodeunsignedheader{\\H}}\\,,"},
{"label": null,
"index": "6.20",
"tex": "\n      &\\isticketed = 0\n  }"},
{"label": "eq:vrfsigcheck",
"index": "6.21",
"tex": "\n  \\label{eq:vrfsigcheck}\n  \\H_\\\u00acvrfsig &\\in \\bssignature{\\H_\\\u00acauthorbskey}{\\Xentropy \\concat \\banderout{\\H_\\\u00acsealsig}}{\\sq{}} "},
{"label": null,
"index": "6.22",
"tex": "\n  \\Xentropy &= \\token{\\$jam\\_entropy}"},
{"label": null,
"index": "6.23",
"tex": "\n  \\Xfallback &= \\token{\\$jam\\_fallback\\_seal}"},
{"label": null,
"index": "6.24",
"tex": "\n  \\Xticket &= \\token{\\$jam\\_ticket\\_seal}\n  \\end{align}"},
{"label": "eq:entropycomposition",
"index": "6.25",
"tex": "\\begin{align}\n  \\label{eq:entropycomposition}\n  \\entropy &\\in \\sequence[4]{\\hash}\n\\end{align}"},
{"label": null,
"index": "6.26",
"tex": "\\begin{align}\n  \\entropyaccumulator' &\\equiv \\blake{\\entropyaccumulator \\concat \\banderout{\\H_\\\u00acvrfsig}}\n\\end{align}"},
{"label": null,
"index": "6.27",
"tex": "\\begin{align}\n  \\tup{\\entropy'_1, \\entropy'_2, \\entropy'_3} &\\equiv \\begin{cases}\n    \\tup{\\entropy_0, \\entropy_1, \\entropy_2} &\\when e' > e \n    \\tup{\\entropy_1, \\entropy_2, \\entropy_3} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": "eq:slotkeysequence",
"index": "6.28",
"tex": "\\begin{align}\n  \\label{eq:slotkeysequence}\n  \\safroleticket &\\equiv \\begin{cases}\n    Z(\\ticketaccumulator) &\\when e' = e + 1 \\wedge m \\geq \\Cepochtailstart \\wedge \\len{\\ticketaccumulator} = \\Cepochlen\\!\\!\n    \\sealtickets &\\when e' = e \n    F(\\entropy'_2, \\activeset') \\!\\!\\!&\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "6.29",
"tex": "\\begin{equation}\n  Z\\colon\\abracegroup[\\,]{\n    \\sequence[\\Cepochlen]{\\safroleticket} &\\to \\sequence[\\Cepochlen]{\\safroleticket}\\\\\n    \\mathbf{s} &\\mapsto \\sq{\\mathbf{s}_0, \\mathbf{s}_{\\len{\\mathbf{s}} - 1}, \\mathbf{s}_1, \\mathbf{s}_{\\len{\\mathbf{s}} - 2}, \\dots}\\\\\n  }\n\\end{equation}"},
{"label": "eq:fallbackkeysequence",
"index": "6.30",
"tex": "\\begin{equation}\n  \\label{eq:fallbackkeysequence}\n  F\\colon \\abracegroup[\\ ]{\n    \\tuple{\\hash,\\,\\sequence{\\valkey}} &\\to \\sequence[\\Cepochlen]{\\bskey}\\\\\n    \\tup{r,\\, \\mathbf{k}} &\\mapsto \\sq{\\build{\n      \\cyclic{\\mathbf{k}\\sub{\\decode[4]{\\blake{r \\concat \\encode[4]{i}}_{\\dots 4}}}}_\\vk\u00acbs\n    }{\n      i \\in \\epochindex\n    }}\n  }\\!\\!\\!\n\\end{equation}"},
{"label": "eq:epochmarker",
"index": "6.31",
"tex": "\\begin{align}\n  \\label{eq:epochmarker}\n  \\H_\\\u00acepochmark &\\equiv \\begin{cases}\n    \\tup{ \\entropyaccumulator, \\entropy_1, \\sq{\\build{\n      \\tup{k_\\vk\u00acbs, k_\\vk\u00aced}\n    }{\n      k \\orderedin \\pendingset'\n    }} } \\qquad\\qquad &\\when e' > e \n    \\none & \\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": "eq:winningticketsmarker",
"index": "6.32",
"tex": "\\begin{align}\n  \\label{eq:winningticketsmarker}\n  \\H_\\\u00acwinnersmark &\\equiv \\begin{cases}\n    Z(\\ticketaccumulator) &\\when e' = e \\wedge m < \\Cepochtailstart \\le m' \\wedge \\len{\\ticketaccumulator} = \\Cepochlen \n    \\none & \\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": "eq:ticketsextrinsic",
"index": "6.33",
"tex": "\\begin{align}\n  \\label{eq:ticketsextrinsic}\n  \\xttickets &\\in \\sequence{\\tuple{\n    \\isa{\\xt\u00acentryindex}{\\Nmax{\\Cticketentries}},\\,\n    \\isa{\\xt\u00acproof}{\\bsringproof{\\epochroot'}{\\Xticket \\concat \\entropy'_2 \\append \\xt\u00acentryindex}{\\sq{}}}\n  }} "},
{"label": "eq:enforceticketlimit",
"index": "6.34",
"tex": "\n  \\label{eq:enforceticketlimit}\n  \\len{\\xttickets} &\\le \\begin{cases}\n      \\Cmaxblocktickets &\\when m' < \\Cepochtailstart \n      0 &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "6.35",
"tex": "\\begin{align}\n  \\mathbf{n} &\\equiv \\sq{\\build{\n    \\tup{\n      \\is{\\st\u00acid}{\\banderout{i_\\xt\u00acproof}},\\,\n      \\is{\\st\u00acentryindex}{i_\\st\u00acentryindex}\n    }\n  }{\n    i \\orderedin \\xttickets\n  }}\n\\end{align}"},
{"label": null,
"index": "6.36",
"tex": "\\begin{align}\n  \\mathbf{n} &= \\sqorderuniqby{x_\\st\u00acid}{x \\in \\mathbf{n}} "},
{"label": null,
"index": "6.37",
"tex": "\n  \\set{ \\build{ x_\\st\u00acid }{ x \\in \\mathbf{n} }} &\\disjoint \\set{ \\build{ x_\\st\u00acid }{ x \\in \\ticketaccumulator }}\n\\end{align}"},
{"label": null,
"index": "6.38",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\ticketaccumulator' &\\equiv{\\overrightarrow{\\sqorderby{x_\\st\u00acid}{x \\in \\mathbf{n} \\cup \\begin{cases} \\none\\ &\\when e' > e \\\\ \\ticketaccumulator\\ &\\otherwise \\end{cases}}~}}^\\Cepochlen \\\\\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "6.39",
"tex": "\\begin{align}\n  \\mathbf{n} \\subseteq \\ticketaccumulator'\n\\end{align}"},
{"label": "eq:recentspec",
"index": "7.1",
"tex": "\\begin{align}\n  \\label{eq:recentspec}\n  \\recent &\\equiv \\tup{\\recenthistory, \\accoutbelt}"},
{"label": "eq:recenthistoryspec",
"index": "7.2",
"tex": "\n  \\label{eq:recenthistoryspec}\n  \\recenthistory &\\in \\sequence[:\\Crecenthistorylen]{\\tuple{\n    \\isa{\\rh\u00acheaderhash}{\\hash},\n    \\isa{\\rh\u00acstateroot}{\\hash},\n    \\isa{\\rh\u00acaccoutlogsuperpeak}{\\hash},\n    \\isa{\\rh\u00acreportedpackagehashes}{\\dictionary{\\hash}{\\hash}}\n  }}"},
{"label": "eq:accoutbeltspec",
"index": "7.3",
"tex": "\n  \\label{eq:accoutbeltspec}\n  \\accoutbelt &\\in \\sequence{\\optional{\\hash}} "},
{"label": "eq:lastaccoutspec",
"index": "7.4",
"tex": "\n  \\label{eq:lastaccoutspec}\n  \\lastaccout &\\in \\sequence{\\tup{\\serviceid, \\hash}}\n\\end{align}"},
{"label": "eq:correctlaststateroot",
"index": "7.5",
"tex": "\\begin{equation}\\label{eq:correctlaststateroot}\n  \\recenthistorypostparentstaterootupdate \\equiv \\recenthistory\\quad\\exc\\quad\\recenthistorypostparentstaterootupdate\\subb{\\len{\\recenthistory} - 1}_\\rh\u00acstateroot = \\H_\\\u00acpriorstateroot\n\\end{equation}"},
{"label": null,
"index": "7.6",
"tex": "\\begin{align}\n  \\using \\mathbf{s} &= \\sq{\\build{\\encode[4]{s} \\concat \\encode{h}}{\\tup{s, h} \\orderedin \\lastaccout'}}"},
{"label": "eq:accoutbeltdef",
"index": "7.7",
"tex": "\n  \\label{eq:accoutbeltdef}\n  \\accoutbelt' &\\equiv \\mmrappend{\\accoutbelt, \\merklizewb{\\mathbf{s}, \\fnkeccak}, \\fnkeccak}\n\\end{align}"},
{"label": "eq:recenthistorydef",
"index": "7.8",
"tex": "\\begin{equation}\n  \\label{eq:recenthistorydef}\n  \\begin{aligned}\n    \\recenthistory' &\\equiv{\\overleftarrow{\\recenthistorypostparentstaterootupdate \\append \\tup{\n      \\rh\u00acreportedpackagehashes,\n      \\is{\\rh\u00acheaderhash}{\\blake{\\theheader}},\n      \\is{\\rh\u00acstateroot}{\\zerohash},\n      \\is{\\rh\u00acaccoutlogsuperpeak}{\\mmrsuperpeak{\\accoutbelt'}}\n      }}}^\\Crecenthistorylen \\\\\n    \\where \\rh\u00acreportedpackagehashes &= \\set{\\build{\n        \\kv{\n          ((g_\\xg\u00acworkreport)_\\wr\u00acavspec)_\\as\u00acpackagehash\n        }{\n          ((g_\\xg\u00acworkreport)_\\wr\u00acavspec)_\\as\u00acsegroot\n        }\n      }{\n        g \\in \\xtguarantees\n      }}\n  \\end{aligned}\n\\end{equation}"},
{"label": "eq:authstatecomposition",
"index": "8.1",
"tex": "\\begin{equation}\n  \\label{eq:authstatecomposition}\n  \\authpool \\in \\sequence[\\Ccorecount]{\\sequence[:\\Cauthpoolsize]{\\hash}}\\ , \\qquad\n  \\authqueue \\in \\sequence[\\Ccorecount]{\\sequence[\\Cauthqueuesize]{\\hash}}\n\\end{equation}"},
{"label": null,
"index": "8.2",
"tex": "\\begin{align}\n  &\\forall \\\u00accore \\in \\coreindex : \\authpool'\\subb{\\\u00accore} \\equiv{\\overleftarrow{F(\\\u00accore) \\append \\cyclic{\\authqueue'\\subb{\\\u00accore}\\subb{\\H_\\\u00actimeslot}}}}^{\\Cauthpoolsize} "},
{"label": null,
"index": "8.3",
"tex": "\n  &F(\\\u00accore) \\equiv \\begin{cases} \\authpool[\\\u00accore] \\seqminusl \\set{(g_\\xg\u00acworkreport)_\\wr\u00acauthorizer} &\\when \\exists g \\in \\xtguarantees : (g_\\xg\u00acworkreport)_\\\u00accore = \\\u00accore  \\authpool[\\\u00accore] & \\otherwise \\end{cases}\n\\end{align}"},
{"label": "eq:serviceaccounts",
"index": "9.1",
"tex": "\\begin{align}\\label{eq:serviceaccounts}\n  \\serviceid &\\equiv \\Nbits{32} "},
{"label": null,
"index": "9.2",
"tex": "\n  \\accounts &\\in \\dictionary{\\serviceid}{\\serviceaccount}\n\\end{align}"},
{"label": "eq:serviceaccount",
"index": "9.3",
"tex": "\\begin{align}\\label{eq:serviceaccount}\n  \\serviceaccount \\equiv \\tuple{\\ \\begin{aligned}\n    \\sa\u00acstorage &\\in \\dictionary{\\blob}{\\blob}\\,,\\ \n    \\sa\u00acpreimages \\in \\dictionary{\\hash}{\\blob}\\,,\n    \\sa\u00acrequests &\\in \\dictionary{\\tuple{\\hash,\\bloblength}}{\\sequence[:3]{\\timeslot}}\\,,\n    \\sa\u00acgratis &\\in \\balance\\,,\\ \n    \\sa\u00accodehash \\in \\hash\\,,\\ \n    \\sa\u00acbalance \\in \\balance\\,,\\ \n    \\sa\u00acminaccgas \\in \\gas\\,,\n    \\sa\u00acminmemogas &\\in \\gas\\,,\\ \n    \\sa\u00accreated \\in \\timeslot\\,,\\ \n    \\sa\u00aclastacc \\in \\timeslot\\,,\\ \n    \\sa\u00acparent \\in \\serviceid\n    %i, o, f\n  \\end{aligned}\\,}\n\\end{align}"},
{"label": null,
"index": "9.4",
"tex": "\\begin{align}\n  \\forall \\mathbf{a} \\in \\serviceaccount : \\tup{\\mathbf{a}_\\sa\u00acmetadata, \\mathbf{a}_\\sa\u00accode} \\equiv \\begin{cases}\n    \\tup{\\mathbf{m}, \\mathbf{c}} &\\when \\encode{\\var{\\mathbf{m}}, \\mathbf{c}} = \\mathbf{a}_\\sa\u00acpreimages[\\mathbf{a}_\\sa\u00accodehash] \n    \\tup{\\none, \\none} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "9.5",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\histlookup\\colon \\abracegroup[\\ ]{\n    \\tuple{\\serviceaccount, \\Nmax{(\\H_\\\u00actimeslot - \\Cexpungeperiod) \\dots \\H_\\\u00actimeslot}, \\hash} &\\to \\optional{\\blob} \\\\\n    (\\mathbf{a}, t, \\blake{\\mathbf{p}}) &\\mapsto v : v \\in \\set{ \\mathbf{p}, \\none }\n  }\n\\end{aligned}\n\\end{equation}"},
{"label": "eq:preimageconstraints",
"index": "9.6",
"tex": "\\begin{equation}\\label{eq:preimageconstraints}\n  \\forall \\mathbf{a} \\in \\serviceaccount, \\kv{h}{\\mathbf{d}} \\in \\mathbf{a}_\\sa\u00acpreimages \\Rightarrow\n    h = \\blake{\\mathbf{d}}\\wedge\n    \\tup{h , \\len{\\mathbf{d}}} \\in \\keys{\\mathbf{a}_\\sa\u00acrequests}\n\\end{equation}"},
{"label": "eq:historicallookup",
"index": "9.7",
"tex": "\\begin{equation}\n  \\begin{aligned}\\label{eq:historicallookup}\n    &\\histlookup\\colon \\tuple{\\serviceaccount, \\timeslot, \\hash} \\to \\optional{\\blob} \\\\\n    &\\histlookup(\\mathbf{a}, t, h) \\equiv \\begin{cases}\n      \\mathbf{a}_\\sa\u00acpreimages\\subb{h}\\!\\!\\!\\! &\\when h \\in \\keys{\\mathbf{a}_\\sa\u00acpreimages} \\wedge I(\\mathbf{a}_\\sa\u00acrequests\\subb{h, \\len{\\mathbf{a}_\\sa\u00acpreimages\\subb{h}}}, t) \\!\\!\\!\\!\\! \\\\\n      \\none &\\otherwise\n    \\end{cases}\\\\\n    &\\where I(\\mathbf{l}, t) = \\begin{cases}\n      \\bot &\\when \\sq{} = \\mathbf{l} \\\\\n      x \\le t &\\when \\sq{x} = \\mathbf{l} \\\\\n      x \\le t < y &\\when \\sq{x, y} = \\mathbf{l} \\\\\n      x \\le t < y \\vee z \\le t &\\when \\sq{x, y, z} = \\mathbf{l} \\\\\n    \\end{cases}\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "9.8",
"tex": "\\begin{align}\n  \\forall \\mathbf{a} \\in \\values{\\accounts}\\colon \\abracegroup{\n    \\mathbf{a}_\\sa\u00acitems \\in \\Nbits{32} &\\equiv\n      2\\cdot\\len{\\,\\mathbf{a}_\\sa\u00acrequests\\,} + \\len{\\,\\mathbf{a}_\\sa\u00acstorage\\,} "},
{"label": null,
"index": "9.9",
"tex": "\n    \\mathbf{a}_\\sa\u00acoctets \\in \\Nbits{64} &\\equiv\n      \\sum\\limits_{\\,\\tup{h, z} \\in \\keys{\\mathbf{a}_\\sa\u00acrequests}\\,} \\!\\!\\!\\!81 + z "},
{"label": null,
"index": "9.10",
"tex": "\n    &\\phantom{\\equiv\\ } + \\sum\\limits_{\\tup{x, y} \\in \\mathbf{a}_\\sa\u00acstorage} 34 + \\len{y} + \\len{x} "},
{"label": "eq:deposits",
"index": "9.11",
"tex": "\n    \\label{eq:deposits}\n    \\mathbf{a}_\\sa\u00acminbalance \\in \\balance &\\equiv\n      \\max(0,\n        \\Cbasedeposit\n        + \\Citemdeposit \\cdot \\mathbf{a}_\\sa\u00acitems\n        + \\Cbytedeposit \\cdot \\mathbf{a}_\\sa\u00acoctets\n        - \\mathbf{a}_\\sa\u00acgratis\n      )\n  }\n\\end{align}"},
{"label": "eq:privilegesspec",
"index": "9.12",
"tex": "\\begin{align}\n  \\label{eq:privilegesspec}\n  \\privileges \\equiv \\tuple{\n    \\isa{\\manager}{\\serviceid} ,\n    \\isa{\\assigners}{\\sequence[\\Ccorecount]{\\serviceid}} ,\n    \\isa{\\delegator}{\\serviceid} ,\n    \\isa{\\alwaysaccers}{\\dictionary{\\serviceid}{\\gas}}\n  }\n\\end{align}"},
{"label": "eq:disputesspec",
"index": "10.1",
"tex": "\\begin{equation}\\label{eq:disputesspec}\n  \\disputes \\equiv \\tup{\\goodset, \\badset, \\wonkyset, \\offenders}\n\\end{equation}"},
{"label": null,
"index": "10.2",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\xtdisputes &\\equiv \\tuple{\\xtverdicts, \\xtculprits, \\xtfaults} \\\\\n    \\where \\xtverdicts &\\in \\sequence{\\tuple{\n      \\hash,\n      \\ffrac{\\thetime}{\\Cepochlen} - \\N_2,\n      \\sequence[\\floor{\\twothirds\\Cvalcount} + 1]{\\tuple{\n        \\set{\\top, \\bot},\n        \\valindex,\n        \\edsignaturebase\n      }}\n    }}\\\\\n    \\also \\xtculprits &\\in \\sequence{\\tuple{\\hash, \\edkey, \\edsignaturebase}} \\,,\\quad\n    \\xtfaults \\in \\sequence{\\tuple{\\hash, \\set{\\top,\\bot}, \\edkey, \\edsignaturebase}}\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "10.3",
"tex": "\\begin{align}\n  &\\begin{aligned}\n    &\\forall \\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\in \\xtverdicts, \\forall \\tup{\\xvj\u00acvalidity, \\xvj\u00acjudgeindex, \\xvj\u00acsignature} \\in \\xv\u00acjudgments : \\xvj\u00acsignature \\in \\edsignature{\\mathbf{k}[\\xvj\u00acjudgeindex]_\\vk\u00aced}{\\mathsf{X}\\sub{v} \\concat \\xv\u00acreporthash}\n    &\\quad\\where \\mathbf{k} = \\begin{cases}\n      \\activeset &\\when \\xv\u00acepochindex = \\displaystyle \\ffrac{\\thetime}{\\Cepochlen}\n      \\previousset &\\otherwise\n    \\end{cases}\n  \\end{aligned}"},
{"label": null,
"index": "10.4",
"tex": "\n  &\\Xvalid \\equiv \\text{{\\small \\texttt{\\$jam\\_valid}}}\\,,\\ \\Xinvalid \\equiv \\text{{\\small \\texttt{\\$jam\\_invalid}}}\n\\end{align}"},
{"label": null,
"index": "10.5",
"tex": "\\begin{align}\n  \\forall \\tup{\\xc\u00acreporthash, \\xc\u00acoffenderindex, \\xc\u00acsignature} &\\in \\xtculprits : \\bigwedge \\abracegroup{\n    &\\xc\u00acreporthash \\in \\badset' \\,,"},
{"label": null,
"index": "10.6",
"tex": "\n    &\\xc\u00acoffenderindex \\in \\mathbf{k} \\,,"},
{"label": null,
"index": "10.7",
"tex": "\n    &\\xc\u00acsignature \\in \\edsignature{\\xc\u00acoffenderindex}{\\Xguarantee \\concat \\xc\u00acreporthash}\n  }"},
{"label": null,
"index": "10.8",
"tex": "\n  \\forall \\tup{\\xf\u00acreporthash, \\xf\u00acvalidity, \\xf\u00acoffenderindex, \\xf\u00acsignature} &\\in \\xtfaults : \\bigwedge \\abracegroup{\n    &\\xf\u00acreporthash \\in \\badset' \\Leftrightarrow \\xf\u00acreporthash \\not\\in \\goodset' \\Leftrightarrow \\xf\u00acvalidity \\,,"},
{"label": null,
"index": "10.9",
"tex": "\n    &k \\in \\mathbf{k} \\,,"},
{"label": null,
"index": "10.10",
"tex": "\n    &s \\in \\edsignature{\\xf\u00acoffenderindex}{\\mathsf{X}\\sub{v} \\concat \\xf\u00acreporthash}"},
{"label": null,
"index": "10.11",
"tex": "\n  }\n  \\nonumber\\where \\mathbf{k} &= \\set{\\build{i_\\vk\u00aced}{i \\in \\previousset \\cup \\activeset}} \\setminus \\offenders\n\\end{align}"},
{"label": null,
"index": "10.12",
"tex": "\\begin{align}\n  &\\xtverdicts = \\sqorderuniqby{\\xv\u00acreporthash}{\\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\in \\xtverdicts}"},
{"label": null,
"index": "10.13",
"tex": "\n  &\\xtculprits = \\sqorderuniqby{\\xc\u00acoffenderindex}{\\tup{\\xc\u00acreporthash, \\xc\u00acoffenderindex, \\xc\u00acsignature} \\in \\xtculprits} \\,,\\ \n  \\xtfaults = \\sqorderuniqby{\\xf\u00acoffenderindex}{\\tup{\\xf\u00acreporthash, \\xf\u00acvalidity, \\xf\u00acoffenderindex, \\xf\u00acsignature} \\in \\xtfaults}\\!\\!\\!\\!\\!\\!"},
{"label": null,
"index": "10.14",
"tex": "\n  &\\set{\\build{\\xv\u00acreporthash}{\\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\in \\xtverdicts}} \\disjoint \\goodset \\cup \\badset \\cup \\wonkyset\n\\end{align}"},
{"label": null,
"index": "10.15",
"tex": "\\begin{equation}\n  \\forall \\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\in \\xtverdicts : \\xv\u00acjudgments = \\sqorderuniqby{\\xvj\u00acjudgeindex}{\\tup{\\xvj\u00acvalidity, \\xvj\u00acjudgeindex, \\xvj\u00acsignature} \\in \\xv\u00acjudgments}\n\\end{equation}"},
{"label": "eq:verdicts",
"index": "10.16",
"tex": "\\begin{align}\\label{eq:verdicts}\n  \\verdicts &\\in \\sequence{\\tup{\n    \\hash,\n    \\set{0, \\floor{\\onethird\\Cvalcount}, \\floor{\\twothirds\\Cvalcount} + 1}\n  }} "},
{"label": null,
"index": "10.17",
"tex": "\n  \\verdicts &= \\sq{\\build{\n      \\tup{\n        \\xv\u00acreporthash,\n        \\sum_{\\tup{\\xvj\u00acvalidity, \\xvj\u00acjudgeindex, \\xvj\u00acsignature} \\in \\xv\u00acjudgments}\\!\\!\\!\\!\n        \\xvj\u00acvalidity\n      }\n    }{\n      \\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\orderedin \\xtverdicts\n    }}\n\\end{align}"},
{"label": null,
"index": "10.18",
"tex": "\\begin{align}\n  \\forall \\tup{\\\u00acreporthash, \\floor{\\twothirds\\Cvalcount} + 1} \\in \\verdicts &:\n    \\exists \\tup{\\\u00acreporthash, \\dots} \\in \\xtfaults "},
{"label": null,
"index": "10.19",
"tex": "\n  \\forall \\tup{\\\u00acreporthash, 0} \\in \\verdicts &:\n    \\len{\\set{\\tup{\\\u00acreporthash, \\dots} \\in \\xtculprits}} \\ge 2\n\\end{align}"},
{"label": "eq:removenonpositive",
"index": "10.20",
"tex": "\\begin{equation}\\label{eq:removenonpositive}\n  \\forall c \\in \\coreindex : \\reportspostjudgement\\subb{c} = \\begin{cases}\n    \\none &\\!\\!\\!\\!\\when\n      \\tup{\\blake{\\reports\\subb{c}_\\rs\u00acworkreport}, \\vs\u00acapproval} \\in \\verdicts,\n      \\vs\u00acapproval < \\floor{\\twothirds\\Cvalcount} \\\\\n    \\reports\\subb{c} &\\!\\!\\!\\!\\otherwise\n  \\end{cases}\\!\\!\\!\\!\\!\\!\\!\n\\end{equation}"},
{"label": "eq:goodsetdef",
"index": "10.21",
"tex": "\\begin{align}\n  \\label{eq:goodsetdef}\n  \\goodset' &\\equiv \\goodset \\cup \\set{\\build{\n      \\vs\u00acreporthash\n    }{\n      \\tup{\\vs\u00acreporthash, \\floor{\\twothirds\\Cvalcount} + 1} \\in \\verdicts\n    }} "},
{"label": "eq:badsetdef",
"index": "10.22",
"tex": "\n  \\label{eq:badsetdef}\n  \\badset' &\\equiv \\badset \\cup \\set{\\build{\n      \\vs\u00acreporthash\n    }{\n      \\tup{\\vs\u00acreporthash, 0} \\in \\verdicts\n    }} "},
{"label": "eq:wonkysetdef",
"index": "10.23",
"tex": "\n  \\label{eq:wonkysetdef}\n  \\!\\!\\wonkyset' &\\equiv \\wonkyset \\cup \\set{\\build{\n      \\vs\u00acreporthash\n    }{\n      \\tup{\\vs\u00acreporthash, \\floor{\\onethird\\Cvalcount}} \\in \\verdicts\n    }} "},
{"label": "eq:offendersdef",
"index": "10.24",
"tex": "\n  \\label{eq:offendersdef}\n  \\offenders' &\\equiv \\offenders \\cup \\set{\\build{\n      \\\u00acoffenderindex\n    }{\n      \\tup{\\\u00acoffenderindex, \\dots} \\in \\xtculprits\n    }} \\cup \\set{\\build{\n      \\\u00acoffenderindex\n    }{\n      \\tup{\\\u00acoffenderindex, \\dots} \\in \\xtfaults\n    }}\\!\\!\\!\\!\n\\end{align}"},
{"label": null,
"index": "10.25",
"tex": "\\begin{align}\n  \\H_\\\u00acoffendersmark &\\equiv\n    \\sq{\\build{\\\u00acoffenderindex}{\\tup{\\\u00acoffenderindex,\\dots} \\orderedin \\xtculprits}}\n    \\concat\n    \\sq{\\build{\\\u00acoffenderindex}{\\tup{\\\u00acoffenderindex,\\dots} \\orderedin \\xtfaults}}\n\\end{align}"},
{"label": "eq:reportingstate",
"index": "11.1",
"tex": "\\begin{equation}\n  \\label{eq:reportingstate}\n  \\reports \\in \\sequence[\\Ccorecount]{\n    \\optional{\\tuple{\n      \\isa{\\rs\u00acworkreport}{\\workreport} ,\\,\n      \\isa{\\rs\u00actimestamp}{\\timeslot}\n    }}\n  }\n\\end{equation}"},
{"label": "eq:workreport",
"index": "11.2",
"tex": "\\begin{equation}\n  \\label{eq:workreport}\n  \\workreport \\equiv \\tuple{\n    \\begin{aligned}\n      &\\isa{\\wr\u00acavspec}{\\avspec},\\ \n      \\isa{\\wr\u00accontext}{\\workcontext},\\ \n      \\isa{\\wr\u00accore}{\\coreindex},\\ \n      \\isa{\\wr\u00acauthorizer}{\\hash},\\ \n      \\isa{\\wr\u00acauthtrace}{\\blob},\\\\\n      &\\isa{\\wr\u00acsrlookup}{\\dictionary{\\hash}{\\hash}},\\ \n      \\isa{\\wr\u00acdigests}{\\sequence[1:\\Cmaxpackageitems]{\\workdigest}},\\ \n      \\isa{\\wr\u00acauthgasused}{\\gas}\n    \\end{aligned}\n  }\n\\end{equation}"},
{"label": "eq:limitreportdeps",
"index": "11.3",
"tex": "\\begin{equation}\n  \\label{eq:limitreportdeps}\n  \\forall \\wrX \\in \\workreport : \\len{\\wrX_\\wr\u00acsrlookup} + \\len{(\\wrX_\\wr\u00accontext)_\\wc\u00acprerequisites} \\le \\Cmaxreportdeps\n\\end{equation}"},
{"label": "eq:workcontext",
"index": "11.4",
"tex": "\\begin{equation}\n  \\label{eq:workcontext}\n  \\workcontext \\equiv \\tuple{\\,\\begin{alignedat}{5}\n    \\isa{\\wc\u00acanchorhash&}{\\hash}\\,,\\;\n    \\isa{&\\wc\u00acanchorpoststate&}{\\hash}\\,,\\;\n    \\isa{&\\wc\u00acanchoraccoutlog&}{\\hash}\\,,\\;\\\\\n    \\isa{\\wc\u00aclookupanchorhash&}{\\hash}\\,,\\;\n    \\isa{&\\wc\u00aclookupanchortime&}{\\timeslot}\\,,\\;\n    \\isa{&\\wc\u00acprerequisites&}{\\protoset{\\hash}}\n  \\end{alignedat}}\n\\end{equation}"},
{"label": "eq:avspec",
"index": "11.5",
"tex": "\\begin{align}\n  \\label{eq:avspec}\n  \\avspec &\\equiv \\tuple{\n    \\isa{\\as\u00acpackagehash}{\\hash}\\,,\\;\n    \\isa{\\as\u00acbundlelen}{\\bloblength}\\,,\\;\n    \\isa{\\as\u00acerasureroot}{\\hash}\\,,\\;\n    \\isa{\\as\u00acsegroot}{\\hash}\\,,\\;\n    \\isa{\\as\u00acsegcount}{\\N}\n  }\n\\end{align}"},
{"label": "eq:workdigest",
"index": "11.6",
"tex": "\\begin{equation}\n  \\label{eq:workdigest}\n  \\workdigest \\equiv \\tuple{\n    \\begin{alignedat}{9}\n      \\isa{\\wd\u00acserviceindex&}{\\serviceid}\\,,\\;\n      \\isa{&\\wd\u00accodehash&}{\\hash}\\,,\\;\n      \\isa{&\\wd\u00acpayloadhash&}{\\hash}\\,,\\;\n      \\isa{&\\wd\u00acgaslimit&}{\\gas}\\,,\\;\n      \\isa{&\\wd\u00acresult&}{\\blob \\cup \\workerror}\\,,\\;\\\\\n      \\isa{\\wd\u00acgasused&}{\\gas}\\,,\\;\n      \\isa{&\\wd\u00acimportcount&}{\\N}\\,,\\;\n      \\isa{&\\wd\u00acxtcount&}{\\N}\\,,\\;\n      \\isa{&\\wd\u00acxtsize&}{\\N}\\,,\\;\n      \\isa{&\\wd\u00acexportcount&}{\\N}\n    \\end{alignedat}\n  }\n\\end{equation}"},
{"label": "eq:workerror",
"index": "11.7",
"tex": "\\begin{equation}\n  \\label{eq:workerror}\n  \\workerror \\in \\set{ \\oog, \\panic, \\badexports, \\oversize, \\token{BAD}, \\token{BIG} }\n\\end{equation}"},
{"label": "eq:limitworkreportsize",
"index": "11.8",
"tex": "\\begin{align}\n  \\label{eq:limitworkreportsize}\n  &\\forall \\wrX \\in \\workreport:\n    \\len{\\wrX_\\wr\u00acauthtrace} + \\sum_{\\wdX \\in \\wrX_\\wr\u00acdigests \\cap \\blob} \\len{\\wdX_\\wd\u00acresult} \\le \\Cmaxreportvarsize "},
{"label": null,
"index": "11.9",
"tex": "\n  &\\Cmaxreportvarsize \\equiv 48\\cdot2^{10}\n\\end{align}"},
{"label": "eq:xtassurances",
"index": "11.10",
"tex": "\\begin{align}\n  \\label{eq:xtassurances}\n  \\xtassurances \\in \\sequence[\\mathsf{:\\Cvalcount}]{\\tuple{\n    \\isa{\\xa\u00acanchor}{\\hash},\\,\n    \\isa{\\xa\u00acavailabilities}{\\bitstring[\\Ccorecount]},\\,\n    \\isa{\\xa\u00acassurer}{\\valindex},\\,\n    \\isa{\\xa\u00acsignature}{\\edsignaturebase}\n  }}\n\\end{align}"},
{"label": null,
"index": "11.11",
"tex": "\\begin{align}\n  \\forall a &\\in \\xtassurances : a_\\xa\u00acanchor = \\H_\\\u00acparent "},
{"label": null,
"index": "11.12",
"tex": "\n  \\forall i &\\in \\set{ 1 \\dots \\len{\\xtassurances} } : \\xtassurances\\subb{i - 1}_\\xa\u00acassurer < \\xtassurances\\subb{i}_\\xa\u00acassurer\n\\end{align}"},
{"label": "eq:assurancesig",
"index": "11.13",
"tex": "\\begin{align}\n  \\label{eq:assurancesig}\n  &\\forall a \\in \\xtassurances : a_\\xa\u00acsignature \\in \\edsignature{\\activeset\\subb{a_\\xa\u00acassurer}_\\vk\u00aced}{\\Xavailable \\concat \\blake{\\encode{\\H_\\\u00acparent, a_\\xa\u00acavailabilities}}} "},
{"label": null,
"index": "11.14",
"tex": "\n  &\\Xavailable \\equiv \\token{\\$jam\\_available}\n\\end{align}"},
{"label": null,
"index": "11.15",
"tex": "\\begin{equation}\n  \\forall a \\in \\xtassurances, \\cX \\in \\coreindex :\n  \\quad a_\\xa\u00acavailabilities\\subb{\\cX} \\Rightarrow \\reportspostjudgement\\subb{\\cX} \\ne \\none\n\\end{equation}"},
{"label": "eq:availableworkreports",
"index": "11.16",
"tex": "\\begin{align}\n  \\label{eq:availableworkreports}\n  \\justbecameavailable &\\equiv \\sq{\\build{\n      \\reportspostjudgement\\subb{\\cX}_\\rs\u00acworkreport\n    }{\n      \\cX \\orderedin \\coreindex,\\;\n      \\sum_{a \\in \\xtassurances}\\!a_\\xa\u00acavailabilities\\subb{\\cX}\\,>\\,\\twothirds\\,\\Cvalcount\n    }}\n\\end{align}"},
{"label": "eq:reportspostguaranteesdef",
"index": "11.17",
"tex": "\\begin{align}\n  \\label{eq:reportspostguaranteesdef}\n  \\forall \\cX \\in \\coreindex: \\reportspostguarantees\\subb{\\cX} \\equiv \\begin{cases}\n    \\none &\\when\\reports\\subb{\\cX}_\\rs\u00acworkreport \\in \\justbecameavailable \\vee \\H_\\\u00actimeslot \\ge \\reportspostjudgement\\subb{\\cX}_\\rs\u00actimestamp + \\Cassurancetimeoutperiod\n    \\reportspostjudgement\\subb{\\cX} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "11.18",
"tex": "\\begin{equation}\n  \\guarantorassignments \\in \\tuple{\\sequence[\\Cvalcount]{\\coreindex}, \\sequence[\\Cvalcount]{\\edkey}}\n\\end{equation}"},
{"label": null,
"index": "11.19",
"tex": "\\begin{align}\n  R(\\mathbf{c}, n) &\\equiv \\sq{\\build{(x + n) \\bmod \\Ccorecount}{x \\orderedin \\mathbf{c}}}"},
{"label": null,
"index": "11.20",
"tex": "\n  P(e, t) &\\equiv R\\left(\n    \\fyshuffle{\\sq{\\build{\\ffrac{\\Ccorecount \\cdot i}{\\Cvalcount}}{i \\orderedin \\valindex}}, e},\n    \\ffrac{t \\bmod \\Cepochlen}{\\Crotationperiod}\n  \\right)"},
{"label": null,
"index": "11.21",
"tex": "\n  \\guarantorassignments &\\equiv \\tup{P(\\entropy'_2, \\thetime'), \\Phi(\\activeset')}\n\\end{align}"},
{"label": "eq:priorassignments",
"index": "11.22",
"tex": "\\begin{equation}\n  \\label{eq:priorassignments}\n  \\begin{aligned}\n    \\using \\tup{e, \\mathbf{k}} &= \\begin{cases}\n      \\tup{\\entropy'_2, \\activeset'} &\\when \\displaystyle\\ffrac{\\thetime' - \\Crotationperiod}{\\Cepochlen} = \\ffrac{\\thetime'}{\\Cepochlen}\\\\\n      \\tup{\\entropy'_3, \\previousset'} &\\otherwise\n    \\end{cases} \\\\\n    \\guarantorassignmentsunderlastrotation &\\equiv \\tup{\n      P(e, \\thetime' - \\Crotationperiod),\n      \\Phi(\\mathbf{k})\n    }\n  \\end{aligned}\n\\end{equation}"},
{"label": "eq:guaranteesextrinsic",
"index": "11.23",
"tex": "\\begin{align}\\label{eq:guaranteesextrinsic}\n  \\xtguarantees &\\in \\sequence[:\\Ccorecount]{\\tuple{\n    \\isa{\\xg\u00acworkreport}{\\workreport},\\,\n    \\isa{\\xg\u00actimeslot}{\\timeslot},\\,\n    \\isa{\\xg\u00accredential}{\\sequence[2:3]{\\tuple{\\valindex, \\edsignaturebase}}}\n  }} "},
{"label": null,
"index": "11.24",
"tex": "\n  \\xtguarantees &= \\sqorderby{(g_\\xg\u00acworkreport)_\\wr\u00accore}{g \\in \\xtguarantees}\n\\end{align}"},
{"label": null,
"index": "11.25",
"tex": "\\begin{align}\n  \\forall g &\\in \\xtguarantees : g_\\xg\u00accredential = \\sqorderuniqby{v}{\\tup{v, s} \\in g_\\xg\u00accredential}\n\\end{align}"},
{"label": "eq:guarantorsig",
"index": "11.26",
"tex": "\\begin{align}\n  \\label{eq:guarantorsig}\n  &\\begin{aligned}\n    &\\begin{aligned}\n      \\forall \\tup{\\xg\u00acworkreport, \\xg\u00actimeslot, \\xg\u00accredential} &\\in \\xtguarantees,\n      \\forall \\tup{v, s} &\\in \\xg\u00accredential\n    \\end{aligned} :\n      \\abracegroup[\\,]{\n        &s \\in \\edsignature{(\\mathbf{k}\\sub{v})_\\vk\u00aced}{\\Xguarantee\\concat\\blake{\\xg\u00acworkreport}}\n        &\\mathbf{c}\\sub{v} = \\wrX_\\wr\u00accore \\wedge \\Crotationperiod(\\floor{\\nicefrac{\\thetime'}{\\Crotationperiod}} - 1) \\le \\xg\u00actimeslot \\le \\thetime'\n      }\n      &k \\in \\reporters \\Leftrightarrow \\exists \\tup{\\xg\u00acworkreport, \\xg\u00actimeslot, \\xg\u00accredential} \\in \\xtguarantees, \\exists \\tup{v, s} \\in \\xg\u00accredential: k = (\\mathbf{k}\\sub{v})_\\vk\u00aced\n      &\\quad\\where \\tup{\\mathbf{c}, \\mathbf{k}} = \\begin{cases}\n        \\guarantorassignments &\\when \\displaystyle \\ffrac{\\thetime'}{\\Crotationperiod} = \\ffrac{t}{\\Crotationperiod} \n        \\guarantorassignmentsunderlastrotation &\\otherwise\n      \\end{cases}\n  \\end{aligned}"},
{"label": null,
"index": "11.27",
"tex": "\n  &\\Xguarantee \\equiv \\token{\\$jam\\_guarantee}\n\\end{align}"},
{"label": "eq:incomingworkreports",
"index": "11.28",
"tex": "\\begin{align}\\label{eq:incomingworkreports}\n  \\using\\incomingreports = \\set{ \\build{ \\xgX_\\xg\u00acworkreport }{ \\xgX \\in \\xtguarantees } }\n\\end{align}"},
{"label": "eq:reportcoresareunusedortimedout",
"index": "11.29",
"tex": "\\begin{equation}\\label{eq:reportcoresareunusedortimedout}\n  \\forall \\wrX \\in \\incomingreports :\n    \\reportspostguarantees\\subb{\\wrX_\\wr\u00accore} = \\none \\wedge \\wrX_\\wr\u00acauthorizer \\in \\authpool_{\\wrX_\\wr\u00accore}\n\\end{equation}"},
{"label": null,
"index": "11.30",
"tex": "\\begin{equation}\n  \\forall \\wrX \\in \\incomingreports:\n    \\sum_{\\wdX \\in \\wrX_\\wr\u00acdigests}\\!(\\wdX_\\wd\u00acgaslimit) \\le \\Creportaccgas \\ \\wedge \\ \n    \\forall \\wdX \\in \\wrX_\\wr\u00acdigests: \\wdX_\\wd\u00acgaslimit \\ge \\accounts\\subb{\\wdX_\\wd\u00acserviceindex}_\\sa\u00acminaccgas\n\\end{equation}"},
{"label": null,
"index": "11.31",
"tex": "\\begin{equation}\n    \\using \\local\u00acincomingcontexts \\equiv \\set{ \\build{ \\wrX_\\wr\u00accontext }{ \\wrX \\in \\incomingreports } }\\ ,\\quad\n    \\local\u00acincomingpackagehashes \\equiv \\set{ \\build{ (\\wrX_\\wr\u00acavspec)_\\as\u00acpackagehash }{ \\wrX \\in \\incomingreports } }\n\\end{equation}"},
{"label": null,
"index": "11.32",
"tex": "\\begin{equation}\n  \\len{\\local\u00acincomingpackagehashes} = \\len{\\incomingreports}\n\\end{equation}"},
{"label": null,
"index": "11.33",
"tex": "\\begin{align}\n  \\forall x \\in \\local\u00acincomingcontexts : \\exists y \\in \\recenthistorypostparentstaterootupdate : x_\\wc\u00acanchorhash = y_\\rh\u00acheaderhash \\wedge x_\\wc\u00acanchorpoststate = y_\\rh\u00acstateroot \\wedge x_\\wc\u00acanchoraccoutlog = y_\\rh\u00acaccoutlogsuperpeak \\!\\!\\!\\!\\!\\!\n\\end{align}"},
{"label": "eq:limitlookupanchorage",
"index": "11.34",
"tex": "\\begin{align}\n  \\label{eq:limitlookupanchorage}\n  \\forall x \\in \\local\u00acincomingcontexts :\\ x_\\wc\u00aclookupanchortime \\ge \\H_\\\u00actimeslot - \\Cmaxlookupanchorage\n\\end{align}"},
{"label": null,
"index": "11.35",
"tex": "\\begin{align}\n  \\forall x \\in \\local\u00acincomingcontexts :\\ \\exists h \\in \\ancestors: h_\\\u00actimeslot = x_\\wc\u00aclookupanchortime \\wedge \\blake{h} = x_\\wc\u00aclookupanchorhash\n\\end{align}"},
{"label": null,
"index": "11.36",
"tex": "\\begin{align}\n  &\\using \\mathbf{q} = \\set{\\build{\n      (\\wrX_\\wr\u00acavspec)_\\as\u00acpackagehash\n    }{\n      \\tup{\\wrX, \\mathbf{d}} \\in \\concatall{\\ready}\n    }} "},
{"label": null,
"index": "11.37",
"tex": "\n  &\\using \\mathbf{a} = \\set{\\build{\n      ((\\wrX_\\rs\u00acworkreport)_\\wr\u00acavspec)_\\as\u00acpackagehash\n    }{\n      \\wrX \\in \\reports, \\wrX \\ne \\none\n    }} "},
{"label": null,
"index": "11.38",
"tex": "\n  &\\forall p \\in \\local\u00acincomingpackagehashes,\n    p \\not\\in \\bigcup_{x \\in \\recenthistory}\\keys{x_\\rh\u00acreportedpackagehashes}\n      \\cup\n      \\bigcup_{x \\in \\accumulated}x\n      \\cup \\mathbf{q}\n      \\cup \\mathbf{a}\n\\end{align}"},
{"label": null,
"index": "11.39",
"tex": "\\begin{align}\n  &\\begin{aligned}\n    &\\forall \\wrX \\in \\incomingreports,\n    \\forall p \\in (\\wrX_\\wr\u00accontext)_\\wc\u00acprerequisites \\cup\n      \\keys{\\wrX_\\wr\u00acsrlookup} :\n    &\\quad p \\in \\local\u00acincomingpackagehashes \\cup \\set{\n      \\build{x}{x \\in \\keys{b_\\rh\u00acreportedpackagehashes},\\, b \\in \\recenthistory}}\n  \\end{aligned}\n\\end{align}"},
{"label": null,
"index": "11.40",
"tex": "\\begin{align}\n  &\\using \\local\u00acincomingpackagehashes = \\set{ \\build{\n    \\kv{\n      ((g_\\xg\u00acworkreport)_\\wr\u00acavspec)_\\as\u00acpackagehash\n    }{\n      ((g_\\xg\u00acworkreport)_\\wr\u00acavspec)_\\as\u00acsegroot\n    }\n  }{\n    g \\in \\xtguarantees\n  } } "},
{"label": null,
"index": "11.41",
"tex": "\n  &\\forall \\wrX \\in \\incomingreports: \\wrX_\\wr\u00acsrlookup \\subseteq \\local\u00acincomingpackagehashes \\cup \\bigcup_{b \\in \\recenthistory} b_\\rh\u00acreportedpackagehashes\n\\end{align}"},
{"label": "eq:reportcodesarecorrect",
"index": "11.42",
"tex": "\\begin{align}\\label{eq:reportcodesarecorrect}\n  \\forall \\wrX \\in \\incomingreports, \\forall \\wdX \\in \\wrX_\\wr\u00acdigests : \\wdX_\\wd\u00accodehash = \\accounts\\subb{\\wdX_\\wd\u00acserviceindex}_\\sa\u00accodehash\n\\end{align}"},
{"label": null,
"index": "11.43",
"tex": "\\begin{equation}\n    \\forall \\cX \\in \\coreindex : \\reportspostassurances\\subb{\\cX} \\equiv \\begin{cases}\n      \\tup{\\\u00acworkreport,\\,\\is{\\rs\u00actimestamp}{\\thetime'}} &\\when \\exists \\tup{\\\u00acworkreport,\\,\\xg\u00actimeslot,\\,\\xg\u00accredential} \\in \\xtguarantees, \\\u00acworkreport_\\wr\u00accore = \\cX \\\\\n      \\reportspostguarantees\\subb{\\cX} &\\otherwise\n    \\end{cases}\n\\end{equation}"},
{"label": "eq:accumulatedspec",
"index": "12.1",
"tex": "\\begin{align}\n  \\label{eq:accumulatedspec}\n  \\accumulated &\\in \\sequence[\\Cepochlen]{\\protoset{\\hash}} "},
{"label": null,
"index": "12.2",
"tex": "\n  \\accumulatedcup &\\equiv \\bigcup_{x \\in \\accumulated}(x)\n\\end{align}"},
{"label": "eq:readyspec",
"index": "12.3",
"tex": "\\begin{align}\n  \\label{eq:readyspec}\n  \\ready &\\in \\sequence[\\Cepochlen]{\\sequence{\\tuple{\\workreport, \\protoset{\\hash}}}}\n\\end{align}"},
{"label": null,
"index": "12.4",
"tex": "\\begin{align}\n  \\justbecameavailable^! &\\equiv \\sq{\\build{w}{w \\orderedin \\justbecameavailable, \\len{(w_\\wr\u00accontext)_\\wc\u00acprerequisites} = 0 \\wedge w_\\wr\u00acsrlookup = \\emset}} "},
{"label": null,
"index": "12.5",
"tex": "\n  \\justbecameavailable^Q &\\equiv E(\\sq{\n    D(w) \\mid\n    w \\orderedin \\justbecameavailable,\n    \\len{(w_\\wr\u00accontext)_\\wc\u00acprerequisites} > 0 \\vee w_\\wr\u00acsrlookup \\ne \\emset\n  }, \\accumulatedcup)\\!\\!\\!\\!"},
{"label": null,
"index": "12.6",
"tex": "\n  D(w) &\\equiv (w, \\set{(w_\\wr\u00accontext)_\\wc\u00acprerequisites} \\cup \\keys{w_\\wr\u00acsrlookup})\n\\end{align}"},
{"label": null,
"index": "12.7",
"tex": "\\begin{equation}\n  E\\colon\\abracegroup{\n      &\\tuple{\\sequence{\\tuple{\\workreport, \\protoset{\\hash}}}, \\protoset{\\hash}} \\to \\sequence{\\tuple{\\workreport, \\protoset{\\hash}}} \\\\\n    &\\tup{\\mathbf{r}, \\mathbf{x}} \\mapsto \\sq{\\build{\n      \\tup{w, \\mathbf{d} \\setminus \\mathbf{x}}\n    }{\n      \\begin{aligned}\n        &\\tup{w, \\mathbf{d}} \\orderedin \\mathbf{r} ,\\\\\n        &(w_\\wr\u00acavspec)_\\as\u00acpackagehash \\not\\in \\mathbf{x}\n      \\end{aligned}\n    }}\n  }\n\\end{equation}"},
{"label": null,
"index": "12.8",
"tex": "\\begin{equation}\n  Q\\colon\\abracegroup{\n    &\\sequence{\\tuple{\\workreport, \\protoset{\\hash}}} \\to \\sequence{\\workreport} \\\\\n    &\\mathbf{r} \\mapsto \\begin{cases}\n      \\sq{} &\\when \\mathbf{g} = \\sq{} \\\\\n      \\mathbf{g} \\concat Q(E(\\mathbf{r}, \\local\u00acfnsrmap(\\mathbf{g})))\\!\\!\\!\\! &\\otherwise \\\\\n      \\multicolumn{2}{l}{\\,\\where \\mathbf{g} = \\sq{\\build{w}{\\tup{w, \\emset} \\orderedin \\mathbf{r}}}}\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "12.9",
"tex": "\\begin{equation}\n  \\local\u00acfnsrmap\\colon\\abracegroup{\n    \\protoset{\\workreport} &\\to \\protoset{\\hash}\\\\\n    \\mathbf{w} &\\mapsto \\set{\n      \\build{(w_\\wr\u00acavspec)_\\as\u00acpackagehash}{w \\in \\mathbf{w}}\n    }\n  }\n\\end{equation}"},
{"label": null,
"index": "12.10",
"tex": "\\begin{align}\n  \\using m &= \\H_\\\u00actimeslot \\bmod \\Cepochlen"},
{"label": null,
"index": "12.11",
"tex": "\n  \\justbecameavailable^* &\\equiv \\justbecameavailable^! \\concat Q(\\mathbf{q}) "},
{"label": null,
"index": "12.12",
"tex": "\n  \\quad\\where \\mathbf{q} &= E(\\concatall{\\ready\\interval{m}{}} \\concat \\concatall{\\ready\\interval{}{m}} \\concat \\justbecameavailable^Q, \\local\u00acfnsrmap(\\justbecameavailable^!))\n\\end{align}"},
{"label": "eq:partialstate",
"index": "12.13",
"tex": "\\begin{equation}\n  \\label{eq:partialstate}\n  \\partialstate \\equiv \\tuple{\\begin{aligned}\n    &\\isa{\\ps\u00acaccounts}{\\dictionary{\\serviceid}{\\serviceaccount}} \\,,\\;\n    \\isa{\\ps\u00acstagingset}{\\sequence[\\Cvalcount]{\\valkey}} \\,,\\;\n    \\isa{\\ps\u00acauthqueue}{\\sequence[\\Ccorecount]{\\sequence[\\Cauthqueuesize]{\\hash}}} \\,,\\\\\n    &\\isa{\\ps\u00acmanager}{\\serviceid} \\,,\\;\n    \\isa{\\ps\u00acassigners}{\\sequence[\\Ccorecount]{\\serviceid}} \\,,\\;\n    \\isa{\\ps\u00acdelegator}{\\serviceid} \\,,\\;\n    \\isa{\\ps\u00acalwaysaccers}{\\dictionary{\\serviceid}{\\gas}}\n  \\end{aligned}}\n\\end{equation}"},
{"label": "eq:defxfer",
"index": "12.14",
"tex": "\\begin{align}\n  \\label{eq:defxfer}\n  \\defxfer \\equiv \\tuple{\n    \\isa{\\dx\u00acsource}{\\serviceid} ,\n    \\isa{\\dx\u00acdest}{\\serviceid} ,\n    \\isa{\\dx\u00acamount}{\\balance} ,\n    \\isa{\\dx\u00acmemo}{\\blob[\\Cmemosize]} ,\n    \\isa{\\dx\u00acgas}{\\gas}\n  }\n\\end{align}"},
{"label": null,
"index": "12.15",
"tex": "\\begin{equation}\n  \\local\u00acfnservouts \\equiv \\protoset{\\tuple{\\serviceid, \\hash}} \\qquad\n  \\local\u00acfngasused \\equiv \\sequence{\\tuple{\\serviceid, \\gas}}\n\\end{equation}"},
{"label": "eq:accseq",
"index": "12.16",
"tex": "\\begin{equation}\n  \\label{eq:accseq}\n  \\accseq\\colon\\abracegroup{\n    &\\tuple{\\gas, \\sequence{\\workreport}, \\partialstate, \\dictionary{\\serviceid}{\\gas}} \\to \\tuple{\\N, \\partialstate, \\defxfers, \\local\u00acfnservouts, \\local\u00acfngasused} \\\\\n    &\\tup{g, \\mathbf{w}, \\psX, \\mathbf{f}} \\!\\mapsto\\! \\begin{cases}\n      \\tup{0, \\psX, \\sq{}, \\emset, \\sq{}} &\n        \\when i = 0 \\\\\n      \\tup{i + j, \\psX', \\mathbf{t}^* \\!\\!\\concat \\mathbf{t}, \\mathbf{b}^* \\!\\cup \\mathbf{b}, \\mathbf{u}^* \\!\\!\\concat \\mathbf{u}}\\!\\!\\!\\! &\n        \\text{o/w}\\!\\!\\!\\!\\!\\!\\!\\! \\\\\n    \\end{cases} \\\\\n    &\\quad\\where i = \\max(\\Nmax{\\len{\\mathbf{w}} + 1}): \\sum_{w \\in \\mathbf{w}\\sub{\\dots i}}\\sum_{r \\in w_\\wr\u00acdigests}(r_\\wd\u00acgaslimit) \\le g \\\\\n    &\\quad\\also \\tup{\\psX^*, \\mathbf{t}^*, \\mathbf{b}^*, \\mathbf{u}^*} = \\accpar(\\psX, \\mathbf{w}\\sub{\\dots i}, \\mathbf{f}) \\\\\n    &\\quad\\also \\tup{j, \\psX', \\mathbf{t}, \\mathbf{b}, \\mathbf{u}} = \\accseq(g - \\!\\!\\!\\!\\sum_{\\tup{s, u} \\in \\mathbf{u}^*}\\!\\!\\!\\!u, \\mathbf{w}\\sub{i\\dots}, \\psX^*, \\emset)\n  }\n\\end{equation}"},
{"label": "eq:accpar",
"index": "12.17",
"tex": "\\begin{equation}\n  \\label{eq:accpar}\n  \\accpar\\colon\\abracegroup[\\;]{\\begin{aligned}\n    &\\tuple{\\partialstate, \\sequence{\\workreport}, \\dictionary{\\serviceid}{\\gas}} \\to \\tuple{\\partialstate, \\defxfers, \\local\u00acfnservouts, \\local\u00acfngasused} \\\\\n    &\\tup{\\psX, \\mathbf{w}, \\mathbf{f}} \\mapsto \\tup{\n      \\tup{\n        \\local\u00acaccounts', \\local\u00acstagingset', \\local\u00acauthqueue', \\local\u00acmanager', \\local\u00acassigners', \\local\u00acdelegator', \\local\u00acalwaysaccers'\n      }, \\concatall{\\mathbf{t}}, \\mathbf{b}, \\mathbf{u}\n    }\\!\\!\\!\\!\\!\\!\\\\\n    &\\text{where:}\\\\\n    &\\ \\begin{aligned}\n      \\using \\mathbf{s} &= \\set{\\build{\n        \\mathbf{r}_\\wd\u00acserviceindex\n        }{\n          w \\in \\mathbf{w}, \\mathbf{r} \\in w_\\wr\u00acdigests\n        }} \\cup \\keys{\\mathbf{f}} \\\\\n      \\mathbf{u} &= \\sq{\\build{\n          \\tup{s, \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acgasused}\n        }{\n          s \\orderedin \\mathbf{s}\n        }} \\\\\n      \\mathbf{b} &= \\set{\\build{\n          \\tup{s, b}\n        }{\n          s \\in \\mathbf{s},\\,\n          b = \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acyield,\\,\n          b \\ne \\none\n        }} \\\\\n      \\mathbf{t} &= \\sq{\\build{\n          \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acdefxfers\n        }{\n          s \\orderedin \\mathbf{s}\n        }} \\\\\n      \\local\u00acaccounts' &= \\local\u00acfnprovide(\n        (\\ps\u00acaccounts \\cup \\mathbf{n}) \\setminus \\mathbf{m},\n        \\bigcup_{s \\in \\mathbf{s}} \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acprovisions\n      ) \\\\\n      &\\tup{\\ps\u00acaccounts, \\ps\u00acstagingset, \\ps\u00acauthqueue, \\ps\u00acmanager, \\ps\u00acalwaysaccers} = \\psX \\\\\n      \\tup{\\local\u00acmanager', \\local\u00acassigners^*, \\local\u00acdelegator^*, \\local\u00acalwaysaccers'} &=\n        (\\accone(\\psX, \\mathbf{w}, \\mathbf{f}, m)_\\ao\u00acpoststate)_{\n          \\tup{\\ps\u00acmanager, \\ps\u00acassigners, \\ps\u00acdelegator, \\ps\u00acalwaysaccers}\n        } \\\\\n      \\forall c \\in \\coreindex :\n        \\local\u00acassigners'\\sub{c} &= ((\n          \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, \\local\u00acassigners^*\\sub{c})_\\ao\u00acpoststate\n        )_\\ps\u00acassigners)\\sub{c} \\\\\n      \\local\u00acdelegator' &= (\n          \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, \\local\u00acdelegator^*)_\\ao\u00acpoststate\n        )_\\ps\u00acdelegator \\\\\n      \\local\u00acstagingset' &= (\n          \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, \\ps\u00acdelegator)_\\ao\u00acpoststate\n      )_\\ps\u00acstagingset \\\\\n      \\forall c \\in \\coreindex :\n        \\local\u00acauthqueue'\\sub{c} &= ((\n          \\accone(\\psX, \\mathbf{w}, \\mathbf{f}, \\ps\u00acassigners\\sub{c})_\\ao\u00acpoststate\n        )_\\ps\u00acauthqueue)\\sub{c} \\\\\n      \\mathbf{n} &= \\bigcup_{s \\in \\mathbf{s}}( \\set{\n          (\\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acpoststate)_\\ps\u00acaccounts\n            \\setminus\n          \\keys{\\ps\u00acaccounts \\setminus \\set{s}}\n        } ) \\\\\n      \\mathbf{m} &= \\bigcup_{s \\in \\mathbf{s}}(\n        \\keys{\\ps\u00acaccounts}\n          \\setminus\n        \\keys{(\\accone(\\psX, \\mathbf{w}, \\mathbf{f}, s)_\\ao\u00acpoststate)_\\ps\u00acaccounts}\n      )\n    \\end{aligned}\n  \\end{aligned}}\n\\end{equation}"},
{"label": null,
"index": "12.18",
"tex": "\\begin{equation}\n  \\local\u00acfnprovide\\colon\\abracegroup{\n    &\\tuple{\\dictionary{\\serviceid}{\\serviceaccount}, \\protoset{\\tuple{\\serviceid, \\blob}}} \\to \\dictionary{\\serviceid}{\\serviceaccount} \\\\\n    &\\tup{\\mathbf{d}, \\mathbf{p}} \\mapsto \\mathbf{d}'\\;\\where \\mathbf{d}' = \\mathbf{d}\\;\\text{except:} \\\\\n    &\\quad\\forall \\tup{s, \\mathbf{i}} \\in \\mathbf{p},\\;\n      s \\in \\keys{\\mathbf{d}},\\;\n      \\mathbf{d}\\subb{s}_\\sa\u00acrequests\\subb{\\blake{\\mathbf{i}}, \\len{\\mathbf{i}}} = \\sq{}:\\\\\n    &\\qquad \\mathbf{d}'\\subb{s}_\\sa\u00acrequests\\subb{\\blake{\\mathbf{i}}, \\len{\\mathbf{i}}} =\\sq{\\thetime'}\\\\\n    &\\qquad \\mathbf{d}'\\subb{s}_\\sa\u00acpreimages\\subb{\\blake{\\mathbf{i}}} = \\mathbf{i}\n  }\n\\end{equation}"},
{"label": "eq:operandtuple",
"index": "12.19",
"tex": "\\begin{align}\n  \\label{eq:operandtuple}\n  \\operandtuple &\\equiv \\tuple{\n    \\begin{alignedat}{5}\n      \\isa{\\ot\u00acpackagehash&}{\\hash},\\;\n      \\isa{&\\ot\u00acsegroot&}{\\hash},\\;\n      \\isa{&\\ot\u00acauthorizer&}{\\hash},\\;\n      \\isa{\\ot\u00acpayloadhash}{\\hash},\\;\n      \\isa{\\ot\u00acgaslimit&}{\\gas},\\;\n      \\isa{&\\ot\u00acauthtrace&}{\\blob},\\;\n      \\isa{&\\ot\u00acresult&}{\\blob \\cup \\workerror}\n    \\end{alignedat}\n  }"},
{"label": "eq:acconeout",
"index": "12.20",
"tex": "\n  \\label{eq:acconeout}\n  \\acconeout &\\equiv \\tuple{\n    \\begin{alignedat}{3}\n      \\isa{\\ao\u00acpoststate&}{\\partialstate},\\;\n      \\isa{&\\ao\u00acdefxfers&}{\\defxfers},\\;\n      \\isa{\\ao\u00acyield}{\\optional{\\hash}},\\;\n      \\isa{\\ao\u00acgasused&}{\\gas},\\;\n      \\isa{&\\ao\u00acprovisions&}{\\protoset{\\tuple{\\serviceid, \\blob}}}\n    \\end{alignedat}\n  }\n\\end{align}"},
{"label": "eq:accone",
"index": "12.21",
"tex": "\\begin{align}\n  \\label{eq:accone}\n  &\\accone \\colon \\abracegroup[\\;]{\n    &\\begin{aligned}\n      \\tuple{\\begin{aligned}\n        &\\partialstate, \\sequence{\\workreport},\n        &\\dictionary{\\serviceid}{\\gas}, \\serviceid\n      \\end{aligned}}\n      &\\to \\acconeout \n      \\tup{\\psX, \\mathbf{w}, \\mathbf{f}, s} &\\mapsto \\Psi_A(\\psX, \\thetime', s, g, \\mathbf{i})\n    \\end{aligned} "},
{"label": null,
"index": "12.22",
"tex": "\n    &\\text{where:} "},
{"label": null,
"index": "12.23",
"tex": "\n    &\\ \\begin{aligned}\n      g &= \\subifnone{\\mathbf{f}\\sub{s}, 0} + \\!\\!\\!\\!\\sum_{w \\in \\mathbf{w}, \\mathbf{r} \\in w_\\wr\u00acdigests , \\mathbf{r}_\\wd\u00acserviceindex = s}\\!\\!\\!\\!(\\mathbf{r}_\\wr\u00acauthgasused) \n      \\mathbf{i} &= \\sq{\\build{\n        \\tup{\\begin{alignedat}{3}\n          \\is{\\ot\u00acresult}{\\mathbf{r}_\\wd\u00acresult},\\,\n          \\is{\\ot\u00acgaslimit}{\\mathbf{r}_\\wd\u00acgaslimit},\\,\n          \\is{\\ot\u00acpayloadhash}{\\mathbf{r}_\\wd\u00acpayloadhash},\\,\n          \\is{&\\ot\u00acauthtrace\\;&}{w_\\wr\u00acauthtrace&},\n          \\is{\\ot\u00acsegroot}{(w_\\wr\u00acavspec)_\\as\u00acsegroot},\\,\n          \\is{\\ot\u00acpackagehash}{(w_\\wr\u00acavspec)_\\as\u00acpackagehash},\\,\n          \\is{&\\ot\u00acauthorizer\\;&}{w_\\wr\u00acauthorizer&}\n        \\end{alignedat}}\n      }{\n        \\begin{alignedat}{2}\n          w& \\orderedin \\mathbf{w},&\n          \\mathbf{r}& \\orderedin w_\\wr\u00acdigests,&\\ \\mathbf{r}_\\wd\u00acserviceindex = s\n        \\end{alignedat}\n      }}\n    \\end{aligned}\n  }\\!\\!\\!\\!\n\\end{align}"},
{"label": null,
"index": "12.24",
"tex": "\\begin{align}\n  &\\using g = \\max\\left(\n    \\Cblockaccgas,\n    \\Creportaccgas \\cdot \\Ccorecount + \\textstyle \\sum_{x \\in \\values{\\alwaysaccers}}(x)\n  \\right)"},
{"label": null,
"index": "12.25",
"tex": "\n  &\\also \\psX = \\tup{\n    \\is{\\ps\u00acaccounts}{\\accountspre},\n    \\is{\\ps\u00acstagingset}{\\stagingset},\n    \\is{\\ps\u00acauthqueue}{\\authqueue},\n    \\is{\\ps\u00acmanager}{\\manager},\n    \\is{\\ps\u00acassigners}{\\assigners},\n    \\is{\\ps\u00acdelegator}{\\delegator},\n    \\is{\\ps\u00acalwaysaccers}{\\alwaysaccers}\n  }\n  \\!\\!\\!\\!\\!"},
{"label": "eq:finalstateaccumulation",
"index": "12.26",
"tex": "\n  \\label{eq:finalstateaccumulation}\n  &\\tup{\n    \\local\u00acnumberofitemsaccumulated, \\psX', \\local\u00acdeferredtransfers, \\lastaccout', \\local\u00acservicegasused\n  } \\equiv \\accseq(g, \\justbecameavailable^*, \\psX, \\alwaysaccers) "},
{"label": "eq:accountspostaccdef",
"index": "12.27",
"tex": "\n  \\label{eq:accountspostaccdef}\n  &\\tup{\n    \\is\\ps\u00acaccounts{\\accountspostacc},\n    \\is\\ps\u00acstagingset{\\stagingset'},\n    \\is\\ps\u00acauthqueue{\\authqueue'},\n    \\is\\ps\u00acmanager{\\manager'},\n    \\is\\ps\u00acassigners{\\assigners'},\n    \\is\\ps\u00acdelegator{\\delegator'},\n    \\is\\ps\u00acalwaysaccers{\\alwaysaccers'}\n  } \\equiv \\psX'\n  \\!\\!\\!\\!\\!\n\\end{align}"},
{"label": "eq:accumulationstatisticsspec",
"index": "12.28",
"tex": "\\begin{align}\n  \\label{eq:accumulationstatisticsspec}\n  &\\accumulationstatistics \\in \\dictionary{\\serviceid}{\\tuple{\\gas, \\N}} "},
{"label": "eq:accumulationstatisticsdef",
"index": "12.29",
"tex": "\n  \\label{eq:accumulationstatisticsdef}\n  &\\textstyle \\accumulationstatistics \\equiv \\set{\\build{\n    \\kv{s}{\n      \\tup{\\sum_{\\tup{s, u} \\in \\mathbf{u}}(u), \\len{N(s)}}\n    }\n  }{\n    N(s) \\ne \\sq{}\n  }}\n  \\!\\!\\!\\!"},
{"label": null,
"index": "12.30",
"tex": "\n  \\where &N(s) \\equiv \\sq{\\build{r}{\n    w \\orderedin \\justbecameavailable^*\\sub{\\dots n} ,\n    r \\orderedin w_\\wr\u00acdigests ,\n    r_\\wd\u00acserviceindex = s\n  }}\n\\end{align}"},
{"label": null,
"index": "12.31",
"tex": "\\begin{equation}\n  \\selectxfers\\colon \\abracegroup[\\;]{\n    \\serviceid &\\to \\defxfers \\\\\n    d &\\mapsto \\sq{\\build{t}{\n      s \\orderedin \\serviceid,\\ \n      t \\orderedin \\local\u00acdeferredtransfers,\\ \n      t_\\dx\u00acsource = s,\\ \n      t_\\dx\u00acdest = d\n    }}\n  }\\!\\!\\!\\!\n\\end{equation}"},
{"label": null,
"index": "12.32",
"tex": "\\begin{align}\n  \\deferredeffects &= \\set{\\build{\n    \\kv{s}{\\Psi_T(\\accountspostacc, \\thetime', s, \\selectxfers(s))}\n  }{\n    \\kv{s}{a} \\in \\accountspostacc\n  }} "},
{"label": "eq:accountspostxferdef",
"index": "12.33",
"tex": "\n  \\label{eq:accountspostxferdef}\n  \\accountspostxfer &\\equiv \\set{ \\build{ \\kv{s}{a'} }{ \\kv{s}{\\tup{a, u}} \\in \\deferredeffects }} "},
{"label": null,
"index": "12.34",
"tex": "\n  &\\where a' = \\begin{cases}\n    a \\exc a'_\\sa\u00aclastacc = \\thetime' &\\when s \\in \\keys{\\accumulationstatistics} \n    a &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": "eq:deferredtransfers",
"index": "12.35",
"tex": "\\begin{align}\n  \\label{eq:deferredtransfers}\n  &\\deferredtransfersstatistics \\in \\dictionary{\\serviceid}{\\tuple{\\N, \\gas}} "},
{"label": null,
"index": "12.36",
"tex": "\n  &\\textstyle \\deferredtransfersstatistics \\equiv \\set{ \\build{ \\kv{d}{\\tup{\\len{\\selectxfers(d)}, u}} }{\n    \\begin{aligned}\n      \\selectxfers(d) &\\ne \\sq{},\n      \\exists a: \\deferredeffects\\subb{d} &= \\tup{a, u}\n    \\end{aligned}\n  }}\n\\end{align}"},
{"label": null,
"index": "12.37",
"tex": "\\begin{align}\n  \\accumulated'_{\\Cepochlen - 1} &= \\local\u00acfnsrmap(\\justbecameavailable^*\\sub{\\dots n}) "},
{"label": null,
"index": "12.38",
"tex": "\n  \\forall i \\in \\Nmax{\\Cepochlen - 1}: \\accumulated'\\sub{i} &\\equiv \\accumulated\\sub{i + 1} "},
{"label": null,
"index": "12.39",
"tex": "\n  \\forall i \\in \\N_\\Cepochlen : \\cyclic{\\ready'}\\sub{m - i} &\\equiv \\begin{cases}\n    E(\\justbecameavailable^Q, \\accumulated'\\sub{\\Cepochlen - 1}) &\\when i = 0 \n    \\sq{} &\\when 1 \\le i < \\thetime' - \\thetime \n    E(\\cyclic{\\ready}\\sub{m - i}, \\accumulated'\\sub{\\Cepochlen - 1}) &\\when i \\ge \\thetime' - \\thetime\n  \\end{cases}\n  \\!\\!\\!\\!\n\\end{align}"},
{"label": null,
"index": "12.40",
"tex": "\\begin{align}\n  \\xtpreimages &\\in \\sequence{\\tuple{ \\serviceid,\\, \\blob }} "},
{"label": "eq:preimagesareordered",
"index": "12.41",
"tex": "\n  \\label{eq:preimagesareordered}\\xtpreimages &= \\sqorderuniqby{i}{i \\in \\xtpreimages} "},
{"label": null,
"index": "12.42",
"tex": "\n  \\forall \\tup{\\xp\u00acserviceindex, \\xp\u00acdata} &\\in \\xtpreimages : Y(\\accountspre, \\xp\u00acserviceindex, \\blake{\\xp\u00acdata}, \\len{\\xp\u00acdata}) "},
{"label": null,
"index": "12.43",
"tex": "\n  \\where Y(\\mathbf{d}, s, h, l) &\\Leftrightarrow\n  h \\not\\in \\mathbf{d}\\subb{s}_\\sa\u00acpreimages \\wedge\n    \\mathbf{d}\\subb{s}_\\sa\u00acrequests\\subb{\\tup{h, l}} = \\sq{}\n\\end{align}"},
{"label": null,
"index": "12.44",
"tex": "\\begin{align}\n  \\using \\mathbf{p} = \\set{\\build{\n    \\tup{\\xp\u00acserviceindex, \\xp\u00acdata}\n  }{\n    \\tup{\\xp\u00acserviceindex, \\xp\u00acdata} \\in \\xtpreimages, Y(\\accountspostxfer, \\xp\u00acserviceindex, \\blake{\\xp\u00acdata}, \\len{\\xp\u00acdata})\n  }}"},
{"label": null,
"index": "12.45",
"tex": "\n  \\accountspostpreimage = \\accountspostxfer \\text{ ex. } \\forall \\tup{\\xp\u00acserviceindex,\\,\\xp\u00acdata} \\in \\mathbf{p} : \\abracegroup[\\,]{\n      \\quad\\accountspostpreimage\\subb{\\xp\u00acserviceindex}_\\sa\u00acpreimages\\subb{\\blake{\\xp\u00acdata}} &= \\xp\u00acdata "},
{"label": null,
"index": "12.46",
"tex": "\n      \\accountspostpreimage\\subb{\\xp\u00acserviceindex}_\\sa\u00acrequests\\subb{\\blake{\\xp\u00acdata}, \\len{\\xp\u00acdata}} &= \\sq{\\thetime'}\n    }\\!\\!\\!\\!\n\\end{align}"},
{"label": "eq:activityspec",
"index": "13.1",
"tex": "\\begin{align}\\label{eq:activityspec}\n  \\activity &\\equiv \\tup{\\valstatsaccumulator, \\valstatsprevious, \\corestats, \\servicestats}"},
{"label": null,
"index": "13.2",
"tex": "\n  \\tuple{\\valstatsaccumulator, \\valstatsprevious} &\\in \\sequence[\\Cvalcount]{\\tuple{\n    \\isa{\\vs\u00acblocks}{\\N}\\,,\n    \\isa{\\vs\u00actickets}{\\N}\\,,\n    \\isa{\\vs\u00acpreimagecount}{\\N}\\,,\n    \\isa{\\vs\u00acpreimagesize}{\\N}\\,,\n    \\isa{\\vs\u00acguarantees}{\\N}\\,,\n    \\isa{\\vs\u00acassurances}{\\N}\n%    \\isa{\\mathbf{u}}{\\sequence[\\Cvalcount]{\\N}}\n  }}^2\n  \\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\n\\end{align}"},
{"label": null,
"index": "13.3",
"tex": "\\begin{align}\n  \\using e =\\; &\\ffrac{\\thetime}{\\Cepochlen} \\ ,\\quad e' = \\ffrac{\\thetime'}{\\Cepochlen}"},
{"label": null,
"index": "13.4",
"tex": "\n  \\!\\tup{\\mathbf{a}, \\valstatsprevious'} \\equiv\\;&\\begin{cases}\n      \\tup{\\valstatsaccumulator, \\valstatsprevious} &\\when e' = e \n      \\tup{\\sq{\\tup{0, \\dots, \\sq{0, \\dots}}, \\dots}, \\valstatsaccumulator}\\!\\!\\!\\! &\\otherwise\n  \\end{cases}\\!\\!\\!\\!"},
{"label": null,
"index": "13.5",
"tex": "\n  \\forall v \\in \\valindex :&\\; \\abracegroup{\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00acblocks &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00acblocks + (v = \\H_\\\u00acauthorindex)"},
{"label": null,
"index": "13.6",
"tex": "\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00actickets &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00actickets + \\begin{cases}\n        \\len{\\xttickets} &\\when v = \\H_\\\u00acauthorindex \n        0 &\\otherwise\n      \\end{cases}"},
{"label": null,
"index": "13.7",
"tex": "\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00acpreimagecount &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00acpreimagecount + \\begin{cases}\n        \\len{\\xtpreimages} &\\when v = \\H_\\\u00acauthorindex \n        0 &\\otherwise\n      \\end{cases}"},
{"label": null,
"index": "13.8",
"tex": "\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00acpreimagesize &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00acpreimagesize + \\begin{cases}\n        \\sum_{d \\in \\xtpreimages}\\len{d} &\\when v = \\H_\\\u00acauthorindex \n        0 &\\otherwise\n      \\end{cases}"},
{"label": null,
"index": "13.9",
"tex": "\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00acguarantees &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00acguarantees + (\\activeset'\\sub{v} \\in \\reporters)"},
{"label": null,
"index": "13.10",
"tex": "\n    \\valstatsaccumulator'\\subb{v}_\\vs\u00acassurances &\\equiv\n      \\mathbf{a}\\subb{v}_\\vs\u00acassurances +\n        (\\exists a \\in \\xtassurances : a_\\xa\u00acassurer = v)\n  }\\!\\!\\!\\!\\!\n\\end{align}"},
{"label": null,
"index": "13.11",
"tex": "\\begin{align}\n  \\corestats &\\in \\sequence[\\Ccorecount]{\\tuple{\n    \\begin{alignedat}{7}\n      \\isa{\\cs\u00acdaload&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acpopularity&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acimportcount&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acxtcount&}{\\N}\\,,\\;\n      \\isa{\\cs\u00acxtsize&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acexportcount&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acbundlelen&}{\\N}\\,,\\;\n      \\isa{&\\cs\u00acgasused&}{\\gas}\n    \\end{alignedat}\n  }}"},
{"label": null,
"index": "13.12",
"tex": "\n  \\servicestats &\\in \\dictionary{\\serviceid}{\\tuple{\n    \\begin{alignedat}{3}\n      \\isa{\\ss\u00acprovision&}{\\tup{\\N, \\N}}\\,,\\;\n      \\isa{&\\ss\u00acrefinement&}{\\tup{\\N, \\gas}}\\,,\\;\n      \\isa{\\ss\u00acimportcount&}{\\N}\\,,\\;\n      \\isa{\\ss\u00acxtcount}{\\N}\\,,\\;\n      \\isa{&\\ss\u00acxtsize&}{\\N}\\,,\\;\n      \\isa{\\ss\u00acexportcount}{\\N}\\,,\\;\n      \\isa{\\ss\u00acaccumulation&}{\\tup{\\N, \\gas}}\\,,\\;\n      \\isa{&\\ss\u00acxferral&}{\\tup{\\N, \\gas}}\n    \\end{alignedat}\n  }}\n\\end{align}"},
{"label": null,
"index": "13.13",
"tex": "\\begin{align}\n  \\forall c \\in \\coreindex : \\corestats'\\subb{c} &\\equiv \\tup{\n    \\begin{alignedat}{5}\n      \\is{\\cs\u00acimportcount&}{R(c)_\\\u00acimportcount}\\,,\\;\n      \\is{&\\cs\u00acxtcount&}{R(c)_\\\u00acxtcount}\\,,\\;\n      \\is{&\\cs\u00acxtsize&}{R(c)_\\\u00acxtsize}\\,,\n      \\is{\\cs\u00acexportcount&}{R(c)_\\\u00acexportcount}\\,,\\;\n      \\is{&\\cs\u00acgasused&}{R(c)_\\\u00acgasused}\\,,\\;\n      \\is{&\\cs\u00acbundlelen&}{L(c)}\\,,\n      \\is{\\cs\u00acdaload&}{D(c)}\\,,\\;\n      \\is{&\\cs\u00acpopularity&}{\\span\\span \\textstyle \\sum_{a \\in \\xtassurances} a_\\xa\u00acavailabilities\\subb{c}\\qquad}\n    \\end{alignedat}\n  }\\!\\!\\!\\!"},
{"label": null,
"index": "13.14",
"tex": "\n  \\where R(c \\in \\coreindex) &\\equiv\n    \\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\n    \\sum_{\\wdX \\in \\wrX_\\wr\u00acdigests, \\wrX \\in \\incomingreports, \\wrX_\\wr\u00accore = c}\n    \\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\n    \\tup{\n      \\wdX_\\\u00acimportcount,\n      \\wdX_\\\u00acxtcount,\n      \\wdX_\\\u00acxtsize,\n      \\wdX_\\\u00acexportcount,\n      \\wdX_\\\u00acgasused,\n    }"},
{"label": null,
"index": "13.15",
"tex": "\n  \\also L(c \\in \\coreindex) &\\equiv\n    \\!\\!\\!\\!\\!\\!\\!\n    \\sum_{\\wrX \\in \\incomingreports, \\wrX_\\wr\u00accore = c}\n    \\!\\!\\!\\!\\!\\!\\!\n    (\\wrX_\\wr\u00acavspec)_\\as\u00acbundlelen"},
{"label": null,
"index": "13.16",
"tex": "\n  \\also D(c \\in \\coreindex) &\\equiv\n    \\!\\!\\!\\!\\!\\!\n    \\sum_{\\wrX \\in \\justbecameavailable, \\wrX_\\wr\u00accore = c}\n    \\!\\!\\!\\!\\!\\!\n    (\\wrX_\\wr\u00acavspec)_\\as\u00acbundlelen +\n    \\Csegmentsize\\ceil{(\\wrX_\\wr\u00acavspec)_\\as\u00acsegcount\\nicefrac{65}{64}}\n\\end{align}"},
{"label": null,
"index": "13.17",
"tex": "\\begin{align}\n  \\forall s \\in \\local\u00acservicesactive : \\servicestats'\\subb{s} &\\equiv \\tup{\n    \\begin{alignedat}{5}\n      \\is{\\ss\u00acimportcount&}{R(s)_\\\u00acimportcount}\\,,\\;\n      \\is{&\\ss\u00acxtcount&}{R(s)_\\\u00acxtcount}\\,,\\;\n      \\is{&\\ss\u00acxtsize&}{R(s)_\\\u00acxtsize}\\,,\n      \\is{\\ss\u00acexportcount&}{R(s)_\\\u00acexportcount}\\,,\\;\n      \\is{&\\ss\u00acrefinement&}{\\span\\span\\tup{R(s)_\\local\u00accounter, R(s)_\\\u00acgasused}}\\,,\\;\n      \\is{\\ss\u00acprovision&}{\n        \\span\\span\\textstyle\n        \\sum_{\\tup{\\xp\u00acserviceindex, \\xp\u00acdata}\\,\\in \\xtpreimages}\\tup{1, \\len{\\xp\u00acdata}}\n      }\\,,\\;\n      \\is{\\ss\u00acaccumulation&}{\n        \\span\\span\n        \\subifnone{\\accumulationstatistics\\subb{s}, \\tup{0, 0}}\n      }\\,,\\; \\ \\ \n      \\is{\\ss\u00acxferral&}{\n        \\span\\span\n        \\subifnone{\\deferredtransfersstatistics\\subb{s}, \\tup{0, 0}}\n      } \\quad\n    \\end{alignedat}\n  }\\!\\!\\!\\!"},
{"label": null,
"index": "13.18",
"tex": "\n  \\where \\local\u00acservicesactive &=\n    \\local\u00acservicesreported \\cup\n    \\local\u00acservicesprovided \\cup\n    \\keys{\\accumulationstatistics} \\cup\n    \\keys{\\deferredtransfersstatistics}"},
{"label": null,
"index": "13.19",
"tex": "\n  \\also \\local\u00acservicesreported &= \\set{\n    \\build{\\wdX_\\wd\u00acserviceindex}{\\wdX \\in \\wrX_\\wr\u00acdigests, \\wrX \\in \\incomingreports}\n  }"},
{"label": null,
"index": "13.20",
"tex": "\n  \\also \\local\u00acservicesprovided &= \\set{\n    \\build{s}{\\exists x: \\tup{s, x} \\in \\xtpreimages}\n  }"},
{"label": null,
"index": "13.21",
"tex": "\n  \\also R(s \\in \\serviceid) &\\equiv\n    \\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\n    \\sum_{\\wdX \\in \\wrX_\\wr\u00acdigests, \\wrX \\in \\incomingreports, \\wdX_\\wd\u00acserviceindex = s}\n    \\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\\!\n    \\tup{\n      \\is{\\local\u00accounter}{1},\n      \\wdX_\\wd\u00acgasused,\n      \\wdX_\\wd\u00acimportcount,\n      \\wdX_\\wd\u00acxtcount,\n      \\wdX_\\wd\u00acxtsize,\n      \\wdX_\\wd\u00acexportcount\n    }\n\\end{align}"},
{"label": "eq:segment",
"index": "14.1",
"tex": "\\begin{equation}\\label{eq:segment}\n  \\segment \\equiv \\blob[\\Csegmentsize]\n\\end{equation}"},
{"label": "eq:workpackage",
"index": "14.2",
"tex": "\\begin{equation}\n  \\label{eq:workpackage}\n  \\workpackage \\equiv \\tuple{\n    \\isa{\\wp\u00acauthtoken}{\\blob},\\ \n    \\isa{\\wp\u00acauthcodehost}{\\serviceid},\\ \n    \\isa{\\wp\u00acauthcodehash}{\\hash},\\ \n    \\isa{\\wp\u00acauthconfig}{\\blob},\\ \n    \\isa{\\wp\u00accontext}{\\workcontext},\\ \n    \\isa{\\wp\u00acworkitems}{\\sequence[1:\\Cmaxpackageitems]{\\workitem}}\n  }\n\\end{equation}"},
{"label": "eq:workitem",
"index": "14.3",
"tex": "\\begin{equation}\\label{eq:workitem}\n  \\workitem \\equiv \\tuple{\\begin{aligned}\n    &\\isa{\\wi\u00acserviceindex}{\\serviceid},\n    \\isa{\\wi\u00accodehash}{\\hash},\n    \\isa{\\wi\u00acpayload}{\\blob},\n    \\isa{\\wi\u00acrefgaslimit}{\\gas},\n    \\isa{\\wi\u00acaccgaslimit}{\\gas},\n    \\isa{\\wi\u00acexportcount}{\\N}, \\\\\n    &\\isa{\\wi\u00acimportsegments}{\\sequence{\\tuple{\\hash \\cup (\\hash^\\boxplus),\\N}}},\n    \\isa{\\wi\u00acextrinsics}{\\sequence{\\tuple{\\hash, \\N}}}\n  \\end{aligned}}\n\\end{equation}"},
{"label": "eq:limitworkpackagebandwidth",
"index": "14.4",
"tex": "\\begin{equation}\n  \\label{eq:limitworkpackagebandwidth}\n  \\!\\!\\!\\!\n  \\begin{aligned}\n    &\\forall \\wpX \\in \\workpackage: \\\\\n    &\\ \\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems} \\wiX_\\wi\u00acexportcount \\le \\Cmaxpackageexports \\ \\wedge\\ \n    \\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems} \\len{\\wiX_\\wi\u00acimportsegments} \\le \\Cmaxpackageimports \\ \\wedge\\ \n    \\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems} \\len{\\wiX_\\wi\u00acextrinsics} \\le \\Cmaxpackagexts\n  \\end{aligned}\n\\end{equation}"},
{"label": "eq:checkextractsize",
"index": "14.5",
"tex": "\\begin{align}\n  \\label{eq:checkextractsize}\n  &\\begin{aligned}\n    &\\forall \\wpX \\in \\workpackage: \\Big(\\len{\\wpX_\\wp\u00acauthtoken} + \\len{\\wpX_\\wp\u00acauthconfig} +\n    \\!\\!\\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems}\\!\\!S(\\wiX)\\Big) \\le \\Cmaxbundlesize \n    &\\where S(\\wiX \\in \\workitem) \\equiv \\len{\\wiX_\\wi\u00acpayload} + \\len{\\wiX_\\wi\u00acimportsegments}\\cdot\\Csegmentsize + \\!\\!\\!\\!\\!\\!\\sum_{\\tup{h, l} \\in \\wiX_\\wi\u00acextrinsics} \\!\\!\\!l\n  \\end{aligned}"},
{"label": null,
"index": "14.6",
"tex": "\n  &\\Cmaxbundlesize \\equiv 13,794,305"},
{"label": null,
"index": "14.7",
"tex": "\n  &\\phantom{\\Cmaxbundlesize} = \\Cmaxpackageimports(\\Csegmentsize + 1 + 32\\ceil{\\log_2(\\Cmemosize)}) + 4096 + 1\n\\end{align}"},
{"label": "eq:wplimits",
"index": "14.8",
"tex": "\\begin{equation}\n  \\label{eq:wplimits}\n  \\forall \\wpX \\in \\workpackage:\\ \\;\n    \\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems}(\\wiX_\\wi\u00acaccgaslimit) < \\Creportaccgas\n  \\quad\\wedge\\ \\;\n    \\sum_{\\wiX \\in \\wpX_\\wp\u00acworkitems}(\\wiX_\\wi\u00acrefgaslimit) < \\Cpackagerefgas\n\\end{equation}"},
{"label": null,
"index": "14.9",
"tex": "\\begin{equation}\n  \\itemtodigest\\colon\\abracegroup{\n    \\tuple{\\workitem, \\blob \\cup \\workerror, \\gas} &\\to \\workdigest\\\\\n    \\tup{\\tup{\\begin{aligned}\n      &\\\u00acserviceindex, \\\u00accodehash, \\\u00acpayload,\\\\\n      &\\wi\u00acaccgaslimit, \\\u00acexportcount, \\wi\u00acimportsegments, \\wi\u00acextrinsics\n    \\end{aligned}\n    }, \\wd\u00acresult, \\wd\u00acgasused} &\\mapsto \\tup{\\begin{aligned}\n      &\\wd\u00acserviceindex,\\,\n      \\wd\u00accodehash,\\,\n      \\is{\\wd\u00acpayloadhash}{\\blake{\\\u00acpayload}},\\,\n      \\is{\\wd\u00acgaslimit}{\\wi\u00acaccgaslimit},\\,\n      \\wd\u00acresult,\\,\n      \\wd\u00acgasused,\\\\\n      &\\is{\\wd\u00acimportcount}{\\len{\\wi\u00acimportsegments}},\\,\n      \\wd\u00acexportcount,\\,\n      \\is{\\wd\u00acxtcount}{\\len{\\wi\u00acextrinsics}},\\,\n      \\is{\\wd\u00acxtsize}{\\!\\!\\!\\!\\sum_{\\tup{h, z} \\in \\wi\u00acextrinsics}\\!\\!\\!\\!z}\n    \\end{aligned}}\\!\\!\\!\\!\n  }\n\\end{equation}"},
{"label": null,
"index": "14.10",
"tex": "\\begin{equation}\n  \\forall \\wpX \\in \\workpackage: \\abracegroup[\\,]{\n    \\wpX_\\wp\u00acauthorizer &\\equiv \\blake{\\wpX_\\wp\u00acauthcodehash \\concat \\wpX_\\wp\u00acauthconfig} \\\\\n    \\encode{\\var{\\wpX_\\wp\u00acmetadata}, \\wpX_\\wp\u00acauthcode} &\\equiv \\histlookup(\\accounts\\subb{\\wpX_\\wp\u00acauthcodehost}, (\\wpX_\\wp\u00accontext)_\\wc\u00aclookupanchortime, \\wpX_\\wp\u00acauthcodehash) \\\\\n    \\tup{\\wpX_\\wp\u00acmetadata, \\wpX_\\wp\u00acauthcode} &\\in \\tuple{\\blob, \\blob}\n  }\n\\end{equation}"},
{"label": "eq:pagedproofs",
"index": "14.11",
"tex": "\\begin{equation}\\label{eq:pagedproofs}\n  \\!\\!\\pagedproofs\\colon\\abracegroup{\n    \\sequence{\\segment} \\to \\,&\\sequence{\\segment} \\\\\n    \\mathbf{s} \\mapsto \\,&\\sq{\\build{\n      \\zeropad{l}{\\encode{\n        \\var{\\merklejustsubpath{6}{\\mathbf{s}, i}},\n        \\var{\\merklesubtreepage{6}{\\mathbf{s}, i}}\n      }}\n    }{\n      i \\orderedin \\Nmax{\\ceil{\\nicefrac{\\len{\\mathbf{s}}}{64}}}\n    }} \\\\\n    & \\where l = \\Csegmentsize\n  }\\!\\!\\!\\!\n\\end{equation}"},
{"label": "eq:workdigestfunction",
"index": "14.12",
"tex": "\\begin{equation}\\label{eq:workdigestfunction}\n  \\computereport \\colon \\abracegroup{\n    \\tuple{\\workpackage, \\coreindex} &\\to \\workreport \\\\\n    \\tup{\\wpX, \\\u00accore} &\\mapsto \\begin{cases}\n      \\error &\\when \\wr\u00acauthtrace \\not\\in \\blob[:\\Cmaxreportvarsize] \\\\\n      \\tup{\\wr\u00acavspec, \\is{\\wr\u00accontext}{\\wpX_\\wp\u00accontext}, \\\u00accore, \\is{\\wr\u00acauthorizer}{\\wpX_\\wp\u00acauthorizer}, \\wr\u00acauthtrace, \\wr\u00acsrlookup, \\wr\u00acdigests, \\wr\u00acauthgasused} &\\otherwise\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "14.13",
"tex": "\\begin{equation}\n  \\segrootlookup(r \\in \\hash \\cup \\hash^\\boxplus) \\equiv \\begin{cases}\n    r &\\when r \\in \\hash \\\\\n    \\wr\u00acsrlookup\\subb{h} &\\when \\exists h \\in \\hash: r = h^\\boxplus\n  \\end{cases}\n\\end{equation}"},
{"label": null,
"index": "14.14",
"tex": "\\begin{equation}\n  \\forall \\kv{h}{e} \\in \\wr\u00acsrlookup : \\exists \\wpX, \\\u00accore \\in \\workpackage, \\coreindex : \\blake{\\wpX} = h \\wedge (\\computereport(\\wpX, \\\u00accore)_\\wr\u00acavspec)_\\as\u00acsegroot = e\n  \\!\\!\\!\\!\n\\end{equation}"},
{"label": null,
"index": "14.15",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\extrinsicdata(\\wiX \\in \\workitem) &\\equiv \\sq{\\build{\\mathbf{d}}{(\\blake{\\mathbf{d}}, \\len{\\mathbf{d}}) \\orderedin \\wiX_\\wi\u00acextrinsics}} \\\\\n    \\importsegmentdata(\\wiX \\in \\workitem) &\\equiv \\sq{\\build{\\segsX\\subb{n}}{\\merklizecd{\\segsX} = \\segrootlookup(r), \\tup{r, n} \\orderedin \\wiX_\\wi\u00acimportsegments}} \\\\\n    \\justifysegmentdata(\\wiX \\in \\workitem) &\\equiv \\sq{\\build{\\var{\\fnmerklejustsubpath{0}{\\segsX, n}}}{\\merklizecd{\\segsX} = \\segrootlookup(r), \\tup{r, n} \\orderedin \\wiX_\\wi\u00acimportsegments}}\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "14.16",
"tex": "\\begin{equation}\n  \\wr\u00acavspec = \\newavailabilityspecifier(\n    \\blake{\\wpX},\n    \\encode{\n      \\wpX,\n      \\extrinsicdata^\\#(\\wpX_\\wp\u00acworkitems),\n      \\importsegmentdata^\\#(\\wpX_\\wp\u00acworkitems),\n      \\justifysegmentdata^\\#(\\wpX_\\wp\u00acworkitems)\n    },\n    \\concatall{\\allexports}\n  )\\!\\!\\!\\!\n\\end{equation}"},
{"label": null,
"index": "14.17",
"tex": "\\begin{equation}\n  \\!\\!\\!\n  \\newavailabilityspecifier\\colon\\abracegroup[\\,]{\n    \\tuple{\\hash, \\blob, \\sequence{\\segment}} &\\to \\avspec\\\\\n    \\tup{\\as\u00acpackagehash, \\mathbf{b},\\,\\mathbf{s}} &\\mapsto \\tup{\n      \\as\u00acpackagehash,\\,\n      \\is{\\as\u00acbundlelen}{\\len{\\mathbf{b}}},\\,\n      \\as\u00acerasureroot,\\,\n      \\is{\\as\u00acsegroot}{\\merklizecd{\\mathbf{s}}},\\,\n      \\is{\\as\u00acsegcount}{\\len{\\mathbf{s}}}\n    }\n  }\\!\\!\\!\\!\\!\n\\end{equation}"},
{"label": "eq:zeropadding",
"index": "14.18",
"tex": "\\begin{equation}\\label{eq:zeropadding}\n  \\fnzeropad{n \\in \\Nclamp{1}{}}\\colon\\abracegroup{\n    \\blob &\\to \\blob[k \\cdot n]\\\\\n    \\mathbf{x} &\\mapsto \\mathbf{x} \\concat \\sq{0, 0, \\dots}\\interval{((\\len{x} + n - 1) \\bmod n) + 1}{n}\n  }\n\\end{equation}"},
{"label": null,
"index": "15.1",
"tex": "\\begin{equation}\n  r = \\computereport(p, c)\n\\end{equation}"},
{"label": null,
"index": "15.2",
"tex": "\\begin{equation}\n  l = \\blake{\\encode{c, r}}\n\\end{equation}"},
{"label": "eq:auditselection",
"index": "17.1",
"tex": "\\begin{align}\\label{eq:auditselection}\n  \\local\u00acreports &\\in \\sequence[\\Ccorecount]{\\optional{\\workreport}} "},
{"label": null,
"index": "17.2",
"tex": "\n  \\local\u00acreports &\\equiv \\sq{\\build{\n    \\begin{rcases}\n      \\reports\\subb{\\cX}_\\rs\u00acworkreport &\\when \\reports\\subb{\\cX}_\\rs\u00acworkreport \\in \\justbecameavailable \n      \\none &\\otherwise\n    \\end{rcases}\n  }{\n    \\cX \\orderedin \\coreindex\n  }}\n\\end{align}"},
{"label": "eq:initialaudit",
"index": "17.3",
"tex": "\\begin{align}\n  \\label{eq:initialaudit}\n  \\local\u00acseed\\sub{0} &\\in \\bssignature{\n    \\activeset\\subb{v}_\\vk\u00acbs\n  }{\n    \\Xaudit \\concat \\banderout{\\H_\\\u00acvrfsig}\n  }{\n    \\sq{}\n  } "},
{"label": null,
"index": "17.4",
"tex": "\n  \\Xaudit &= \\token{\\$jam\\_audit}\n\\end{align}"},
{"label": null,
"index": "17.5",
"tex": "\\begin{align}\n  \\local\u00actranche\\sub{0} &= \\set{\\build{\\wrcX}{\\wrcX \\in \\mathbf{p}\\subrange{}{10}, \\wrX \\ne \\none}} "},
{"label": null,
"index": "17.6",
"tex": "\n  \\where \\mathbf{p} &= \\fyshuffle{\\sq{\\build{\\tup{\\cX, \\local\u00acreports\\sub{\\cX}}}{\\cX \\orderedin \\coreindex}}, \\banderout{\\local\u00acseed\\sub{0}}} "},
{"label": null,
"index": "17.7",
"tex": "\n\\end{align}"},
{"label": null,
"index": "17.8",
"tex": "\\begin{equation}\n  \\using n = \\ffrac{\\wallclock - \\Cslotseconds\\cdot\\H_\\\u00actimeslot}{\\Ctrancheseconds}\n\\end{equation}"},
{"label": "eq:announcement",
"index": "17.9",
"tex": "\\begin{align}\n  \\label{eq:announcement}\n  S &\\equiv \\edsignature{\\activeset\\subb{v}_\\vk\u00aced}{\\Xannounce \\append n \\concat \\mathbf{x}\\sub{n} \\concat \\blake{\\H}} "},
{"label": null,
"index": "17.10",
"tex": "\n  \\where \\mathbf{x}\\sub{n} &= \\encode{\\set{\\build{\\encode[2]{\\cX} \\concat \\blake{\\wrX}}{\\wrcX \\in \\local\u00actranche\\sub{n}}}}"},
{"label": null,
"index": "17.11",
"tex": "\n  \\Xannounce &= \\token{\\$jam\\_announce}\n\\end{align}"},
{"label": null,
"index": "17.12",
"tex": "\\begin{align}\n  A\\sub{n}: \\workreport &\\to \\protoset{\\valindex} "},
{"label": null,
"index": "17.13",
"tex": "\n%  \\forall \\tup{\\cX, \\wrX} &\\in \\local\u00actranche\\sub{0} : v \\in q\\sub{0}(\\wrX)\n  % TODO: #445 ^^^ Fix this.\n\\end{align}"},
{"label": null,
"index": "17.14",
"tex": "\\begin{align}\n  J_\\bool: \\workreport \\to \\protoset{\\valindex}\n\\end{align}"},
{"label": "eq:latertranches",
"index": "17.15",
"tex": "\n  \\label{eq:latertranches}\n  \\ \\local\u00acseed\\sub{n}(\\wrX) &\\in \\bssignature{\\activeset\\subb{v}_\\vk\u00acbs}{\\Xaudit \\concat \\banderout{\\H_\\\u00acvrfsig}\\concat\\blake{\\wrX}\\append n}{\\sq{}} "},
{"label": null,
"index": "17.16",
"tex": "\n  \\ \\local\u00actranche\\sub{n} &\\equiv \\set{ \\build{ \\wrX }{\\textstyle\\frac{\\Cvalcount}{256\\Cauditbiasfactor}\\banderout{\\local\u00acseed\\sub{n}(\\wrX)}\\sub{0} < m\\sub{n}, \\wrX \\in \\local\u00acreports, \\wrX \\ne \\none }}\\!\\!\\!\\!\n  \\nonumber \\where m\\sub{n} &= \\len{A_{n - 1}(\\wrX) \\setminus J_\\top(\\wrX)}\n\\end{align}"},
{"label": null,
"index": "17.17",
"tex": "\\begin{equation}\n  \\begin{aligned}\n  %  \\forall \\tup{\\cX, \\wrX} \\in \\local\u00actranche\\sub{n} \\!: e\\sub{n}(\\wrX) \\!\\Leftrightarrow\\! \\begin{cases}\n  %    \\wrX = \\computereport(p, \\cX)\\!\\!\\!\\!\\! &\\when \\exists p \\in \\workpackage: \\encode{p} = F(\\wrX) \\\\\n  %    \\bot &\\otherwise\n  %  \\end{cases}\n    \\forall \\tup{\\cX, \\wrX} \\in \\local\u00actranche\\sub{n} :\\ \\ &\\\\[-10pt]\n    e\\sub{n}(\\cX) \\Leftrightarrow &\\begin{cases}\n      \\wrX = \\computereport(p, \\cX)\\!\\!\\! &\\when \\exists p \\in \\workpackage: \\encode{p} = F(\\wrX) \\\\\n      \\bot &\\otherwise\n    \\end{cases}\n  \\end{aligned}\\!\\!\n\\end{equation}"},
{"label": "eq:judgments",
"index": "17.18",
"tex": "\\begin{align}\n  \\label{eq:judgments}\n  \\mathbf{j}\\sub{n} &= \\set{\\build{\n    \\edsigndata{\n      \\activeset\\subb{v}_\\vk\u00aced\n    }{\n      \\Xvalidif{e\\sub{n}(\\cX)} \\concat \\blake{\\wrX}\n    }\n  }{\n    \\tup{\\cX, \\wrX} \\in \\local\u00actranche\\sub{n}\n  }}\n\\end{align}"},
{"label": null,
"index": "17.19",
"tex": "\\begin{align}\n  U(\\wrX) &\\Leftrightarrow \\bigvee\\,\\abracegroup[\\,]{\n    &J_\\bot(\\wrX) = \\emptyset \\wedge \\exists n : A\\sub{n}(\\wrX) \\subset J_\\top(\\wrX) "},
{"label": null,
"index": "17.20",
"tex": "\n    &\\len{J_\\top(\\wrX)} > \\twothirds\\Cvalcount\n  }\n\\end{align}"},
{"label": null,
"index": "17.21",
"tex": "\\begin{align}\n  \\isaudited &\\Leftrightarrow \\forall \\wrX \\in \\justbecameavailable : U(\\wrX)\n\\end{align}"},
{"label": "eq:accoutsignedcommitment",
"index": "18.1",
"tex": "\\begin{align}\\label{eq:accoutsignedcommitment}\n  \\accoutcommitment{v} &\\equiv \\blssigndata{\\activeset'\\sub{v}}{\\Xbeefy \\concat \\text{last}(\\recenthistory)_\\rh\u00acaccoutlogsuperpeak}"},
{"label": null,
"index": "18.2",
"tex": "\n  \\Xbeefy &= \\token{\\$jam\\_beefy}\n\\end{align}"},
{"label": null,
"index": "19.1",
"tex": "\\begin{align}\n  \\ancestors(\\header^\\best) &\\owns \\header^\\final "},
{"label": null,
"index": "19.2",
"tex": "\n  \\isaudited^\\best &\\equiv \\top "},
{"label": null,
"index": "19.3",
"tex": "\n  \\not\\exists \\header^A, \\header^B &: \\bigwedge \\abracegroup[\\,]{\n    \\header^A &\\ne \\header^B "},
{"label": null,
"index": "19.4",
"tex": "\n    \\header^A_\\\u00actimeslot &= \\header^B_\\\u00actimeslot "},
{"label": null,
"index": "19.5",
"tex": "\n    \\header^A &\\in \\ancestors(\\header^\\best) "},
{"label": null,
"index": "19.6",
"tex": "\n    \\header^A &\\not\\in \\ancestors(\\header^\\final)\n  }\n\\end{align}"},
{"label": null,
"index": "19.7",
"tex": "\\begin{equation}\n  m = \\sum_{\\header^A \\in \\ancestors^\\best} \\isticketed^A\n\\end{equation}"},
{"label": null,
"index": "A.1",
"tex": "\\begin{align}\n  \\Psi&\\colon \\abracegroup{\n    \\tuple{\\blob, \\pvmreg, \\gas, \\regs, \\ram} &\\to \\tuple{\\set{\\halt, \\panic, \\oog} \\cup \\set{\\fault, \\host} \\times \\pvmreg, \\pvmreg, \\signedgas, \\regs, \\ram}"},
{"label": null,
"index": "A.2",
"tex": "\n    \\tup{\\mathbf{p}, \\imath, \\gascounter, \\registers, \\mem} &\\mapsto \\begin{cases}\n      \\Psi(\\mathbf{p}, \\imath', \\gascounter', \\registers', \\mem') &\\when \\varepsilon = \\continue\n      \\tup{\\oog, \\imath', \\gascounter', \\registers', \\mem'} &\\when \\gascounter' < 0\n      \\tup{\\varepsilon, 0, \\gascounter', \\registers', \\mem'} &\\when \\varepsilon \\in \\set{ \\panic, \\halt }\n      \\tup{\\varepsilon, \\imath', \\gascounter', \\registers', \\mem'} &\\otherwise\n    \\end{cases} "},
{"label": null,
"index": "A.3",
"tex": "\n    \\where \\tup{\\varepsilon, \\imath', \\gascounter', \\registers', \\mem'} &= \\begin{cases}\n      \\Psi_1(\\mathbf{c}, \\mathbf{k}, \\mathbf{j}, \\imath, \\gascounter, \\registers, \\mem) &\\when \\tup{\\mathbf{c}, \\mathbf{k}, \\mathbf{j}} = \\deblob(\\mathbf{p}) \n      \\tup{\\panic, \\imath, \\gascounter, \\registers, \\mem} &\\otherwise\n    \\end{cases}\n  }"},
{"label": null,
"index": "A.4",
"tex": "\n  \\deblob&\\colon\\abracegroup{\n    \\blob &\\to \\tuple{\\blob, \\bitstring, \\sequence{\\pvmreg}} \\cup \\error "},
{"label": null,
"index": "A.5",
"tex": "\n    \\mathbf{p} &\\mapsto \\begin{cases}\n      \\tup{\\mathbf{c}, \\mathbf{k}, \\mathbf{j}} &\\when \\exists!\\,\\mathbf{c}, \\mathbf{k}, \\mathbf{j} : \\mathbf{p} = \\encode{\\len{\\mathbf{j}}} \\concat \\encode[1]{z} \\concat \\encode{\\len{\\mathbf{c}}} \\concat \\encode[z]{\\mathbf{j}} \\concat \\encode{\\mathbf{c}} \\concat \\encode{\\mathbf{k}}\\,,\\ \\len{\\mathbf{k}} = \\len{\\mathbf{c}} \n      \\error &\\otherwise\n    \\end{cases} "},
{"label": null,
"index": "A.6",
"tex": "\n  }\n\\end{align}"},
{"label": null,
"index": "A.7",
"tex": "\\begin{equation}\n  \\Fskip\\colon\\abracegroup{\n    \\N &\\to \\N\\\\\n    i &\\mapsto \\min(24,\\ j \\in \\N : \\tup{\\mathbf{k} \\concat \\sq{1, 1, \\dots}}_{i + 1 + j} = 1)\n  }\n\\end{equation}"},
{"label": "eq:instructions",
"index": "A.8",
"tex": "\\begin{equation}\\label{eq:instructions}\n  \\instructions \\equiv \\mathbf{c} \\concat \\sq{0, 0, \\dots}\n\\end{equation}"},
{"label": null,
"index": "A.9",
"tex": "\\begin{equation}\n  \\basicblocks \\equiv \\left(\\set{0} \\cup \\set{\\build{n + 1 + \\Fskip(n)}{n \\in \\Nmax{\\len{\\mathbf{c}}} \\wedge \\mathbf{k}\\sub{n} = 1 \\wedge \\mathbf{c}\\sub{n} \\in T}}\\right) \\cap \\set{\\build{n}{\\mathbf{k}\\sub{n} = 1 \\wedge \\mathbf{c}\\sub{n} \\in U}}\n\\end{equation}"},
{"label": null,
"index": "A.10",
"tex": "\\begin{equation}\n  \\Psi_1\\colon \\abracegroup{\n    \\tuple{\\blob, \\bitstring, \\sequence{\\pvmreg}, \\pvmreg, \\gas, \\regs, \\ram} &\\to \\tuple{\\set{\\panic, \\halt, \\continue } \\cup \\set{\\fault, \\host} \\times \\pvmreg, \\pvmreg, \\signedgas, \\regs, \\ram}\\\\\n    \\tup{\\mathbf{c}, \\mathbf{k}, \\mathbf{j}, \\imath, \\gascounter, \\registers, \\mem} &\\mapsto \\tup{\\varepsilon, \\imath', \\gascounter', \\registers', \\mem'}\n  }\n\\end{equation}"},
{"label": null,
"index": "A.11",
"tex": "\\begin{equation}\n  \\varepsilon = \\continue,\\quad \\imath' = \\imath + 1 + \\Fskip(\\imath),\\quad \\gascounter' = \\gascounter - \\gascost,\\quad \\registers' = \\registers,\\quad\\mem' = \\mem \\text{ except as indicated }\n\\end{equation}"},
{"label": null,
"index": "A.12",
"tex": "\\begin{align}\n  \\using \\mathbf{x} &= \\set{\\build{x}{x \\in \\mathbf{r} \\wedge x \\bmod 2^{32} \\not\\in \\readable\\mem\\ \\vee\\ x \\in \\mathbf{w} \\wedge x \\bmod 2^{32} \\not\\in \\writable\\mem}} "},
{"label": null,
"index": "A.13",
"tex": "\n  \\varepsilon^\\mu &= \\begin{cases}\n    \\continue &\\when \\mathbf{x} = \\emset \n    \\panic &\\when \\min(\\mathbf{x}) \\bmod 2^{32} < 2^{16} \n    \\fault \\times \\Cpvmpagesize\\floor{\\min(\\mathbf{x}) \\bmod 2^{32} \\div \\Cpvmpagesize} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": "eq:signedfunc",
"index": "A.14",
"tex": "\\begin{align}\n  \\label{eq:signedfunc}\n  \\signfunc{n \\in \\N}&\\colon\\abracegroup{\n    \\Nbits{8n} &\\to \\Z_{-2^{8n-1}\\dots2^{8n-1}}"},
{"label": null,
"index": "A.15",
"tex": "\n    a &\\mapsto \\begin{cases}\n      a &\\when a < 2^{8n-1} \n      a -\\ 2^{8n} &\\otherwise\n    \\end{cases}\n  }"},
{"label": null,
"index": "A.16",
"tex": "\n  \\unsignfunc{n \\in \\N}&\\colon\\abracegroup{\n    \\Z_{-2^{8n-1}\\dots2^{8n-1}} &\\to \\Nbits{8n}"},
{"label": null,
"index": "A.17",
"tex": "\n    a &\\mapsto (2^{8n} + a) \\bmod 2^{8n}\n  }"},
{"label": "eq:bitsfunc",
"index": "A.18",
"tex": "\n  \\label{eq:bitsfunc}\n  \\bitsfunc{n\\in\\N}&\\colon\\abracegroup{\n    \\Nbits{8n} &\\to \\bitstring[8n]"},
{"label": null,
"index": "A.19",
"tex": "\n    x &\\mapsto \\mathbf{y}: \\forall i \\in \\Nmax{8n} : \\mathbf{y}\\subb{i} \\Leftrightarrow \\ffrac{x}{2^i}\\bmod 2\n  }"},
{"label": null,
"index": "A.20",
"tex": "\n  \\unbitsfunc{n\\in\\N}&\\colon\\abracegroup{\n    \\bitstring[8n] &\\to \\Nbits{8n}"},
{"label": null,
"index": "A.21",
"tex": "\n    \\mathbf{x} &\\mapsto y: \\sum_{i \\in \\Nmax{8n}} \\mathbf{x}\\sub{i} \\cdot 2^i\n  }"},
{"label": "eq:revbitsfunc",
"index": "A.22",
"tex": "\n  \\label{eq:revbitsfunc}\n  \\revbitsfunc{n\\in\\N}&\\colon\\abracegroup{\n    \\Nbits{8n} &\\to \\bitstring[8n]"},
{"label": null,
"index": "A.23",
"tex": "\n    x &\\mapsto \\mathbf{y}: \\forall i \\in \\Nmax{8n} : \\mathbf{y}[8n - 1 - i] \\Leftrightarrow \\ffrac{x}{2^i}\\bmod 2\n  }"},
{"label": null,
"index": "A.24",
"tex": "\n  \\revunbitsfunc{n\\in\\N}&\\colon\\abracegroup{\n    \\bitstring[8n] &\\to \\Nbits{8n}"},
{"label": null,
"index": "A.25",
"tex": "\n    \\mathbf{x} &\\mapsto y: \\sum_{i \\in \\Nmax{8n}} \\mathbf{x}\\sub{8n - 1 - i} \\cdot 2^i\n  }\n\\end{align}"},
{"label": "eq:signedextension",
"index": "A.26",
"tex": "\\begin{align}\\label{eq:signedextension}\n  \\fnsext{n \\in \\set{0, 1, 2, 3, 4, 8}}\\colon\\abracegroup{\n    \\Nbits{8n} &\\to \\pvmreg"},
{"label": null,
"index": "A.27",
"tex": "\n    x &\\mapsto x + \\ffrac{x}{2^{8n-1}}(2^{64}-2^{8n})\n  }\n\\end{align}"},
{"label": null,
"index": "A.28",
"tex": "\\begin{equation}\n  \\token{branch}(b, C) \\implies \\tup{\\varepsilon, \\imath'} = \\begin{cases}\n    \\tup{\\continue, \\imath} &\\when \\lnot C \\\\\n    \\tup{\\panic, \\imath} &\\otherwhen b \\not\\in \\basicblocks \\\\\n    \\tup{\\continue, b} &\\otherwise\n  \\end{cases}\n\\end{equation}"},
{"label": "eq:jumptablealignment",
"index": "A.29",
"tex": "\\begin{equation}\\label{eq:jumptablealignment}\n  \\token{djump}(a) \\implies \\tup{\\varepsilon, \\imath'} = \\begin{cases}\n    \\tup{\\halt, \\imath} &\\when a = 2^{32} - 2^{16}\\\\\n    \\tup{\\panic, \\imath} &\\otherwhen a = 0 \\vee a > \\len{\\mathbf{j}}\\cdot\\Cpvmdynaddralign \\vee a \\bmod \\Cpvmdynaddralign \\ne 0 \\vee \\mathbf{j}_{(\\nicefrac{a}{\\Cpvmdynaddralign}) - 1} \\not\\in \\basicblocks \\\\\n    (\\continue, \\mathbf{j}_{(\\nicefrac{a}{\\Cpvmdynaddralign}) - 1}) &\\otherwise\n  \\end{cases}\n\\end{equation}"},
{"label": null,
"index": "A.30",
"tex": "\\begin{equation}\n  \\text{opcode}\\colon\\abracegroup{\n    \\N &\\to \\N\\\\\n    n &\\mapsto \\begin{cases}\n    \\mathbf{c}\\sub{n} &\\when \\mathbf{k}\\sub{n} = 1 \\wedge \\mathbf{c}\\sub{n} \\in U \\\\\n    0 &\\otherwise\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "A.31",
"tex": "\\begin{equation}\n  \\ell \\equiv \\Fskip(\\imath)\n\\end{equation}"},
{"label": null,
"index": "A.32",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\using l_X = \\min(4, \\ell) \\,,\\quad\n  \\immed_X \\equiv \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+1}{l_X}}}\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.33",
"tex": "\\begin{equation}\n  \\using r_A = \\min(12, \\instructions_{\\imath+1} \\bmod 16) \\,,\\quad\n  \\reg'_A \\equiv \\reg'_{r_A} \\,,\\quad\n  \\immed_X \\equiv \\decode[8]{\\instructions\\subrange{\\imath+2}{8}}\n\\end{equation}"},
{"label": null,
"index": "A.34",
"tex": "\\begin{equation}\n\\begin{aligned}\n    \\using l_X &= \\min(4, \\instructions_{\\imath+1} \\bmod 8) \\,,\\quad&\n    \\immed_X &\\equiv \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}}} \\\\\n    \\using l_Y &= \\min(4, \\max(0, \\ell - l_X - 1)) \\,,\\quad&\n    \\immed_Y &\\equiv \\sext{l_Y}{\\decode[l_Y]{\\instructions\\subrange{\\imath+2+l_X}{l_Y}}}\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.35",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\using l_X = \\min(4, \\ell) \\,,\\quad\n  \\immed_X \\equiv \\imath + \\signfunc{l_X}(\\decode[l_X]{\\instructions\\subrange{\\imath+1}{l_X}})\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.36",
"tex": "\\begin{equation}\n\\begin{aligned}\n    \\using r_A &= \\min(12, \\instructions_{\\imath+1} \\bmod 16) \\,,\\quad&\n    \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n    \\reg'_A \\equiv \\reg'_{r_A} \\\\\n    \\using l_X &= \\min(4, \\max(0, \\ell - 1)) \\,,\\quad&\n    \\immed_X &\\equiv \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}}}\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.37",
"tex": "\\begin{equation}\n\\begin{aligned}\n    \\using r_A &= \\min(12, \\instructions_{\\imath+1} \\bmod 16) \\,,\\quad&\n    \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n    \\reg'_A \\equiv \\reg'_{r_A} \\\\\n    \\using l_X &= \\min(4, \\ffrac{\\instructions_{\\imath+1}}{16} \\bmod 8) \\,,\\quad&\n    \\immed_X &= \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}}} \\\\\n    \\using l_Y &= \\min(4, \\max(0, \\ell - l_X - 1)) \\,,\\quad&\n    \\immed_Y &= \\sext{l_Y}{\\decode[l_Y]{\\instructions\\subrange{\\imath+2+l_X}{l_Y}}}\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.38",
"tex": "\\begin{equation}\n  \\begin{aligned}\n      \\using r_A &= \\min(12, \\instructions_{\\imath+1} \\bmod 16) \\,,\\quad&\n      \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n      \\reg'_A \\equiv \\reg'_{r_A} \\\\\n      \\using l_X &= \\min(4, \\ffrac{\\instructions_{\\imath+1}}{16} \\bmod 8) \\,,\\quad&\n      \\immed_X &= \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}}} \\\\\n      \\using l_Y &= \\min(4, \\max(0, \\ell - l_X - 1)) \\,,\\quad&\n      \\immed_Y &= \\imath + \\signfunc{l_Y}(\\decode[l_Y]{\\instructions\\subrange{\\imath+2+l_X}{l_Y}})\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.39",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\using r_D &= \\min(12, (\\instructions_{\\imath+1}) \\bmod 16) \\,,\\quad&\n  \\reg_D &\\equiv \\reg_{r_D} \\,,\\quad\n  \\reg'_D \\equiv \\reg'_{r_D} \\\\\n  \\using r_A &= \\min(12, \\ffrac{\\instructions_{\\imath+1}}{16}) \\,,\\quad&\n  \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n  \\reg'_A \\equiv \\reg'_{r_A} \\\\\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.40",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\using r_A &= \\min(12, (\\instructions_{\\imath+1}) \\bmod 16) \\,,\\quad&\n  \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n  \\reg'_A \\equiv \\reg'_{r_A} \\\\\n  \\using r_B &= \\min(12, \\ffrac{\\instructions_{\\imath+1}}{16}) \\,,\\quad&\n  \\reg_B &\\equiv \\reg_{r_B} \\,,\\quad\n  \\reg'_B \\equiv \\reg'_{r_B} \\\\\n  \\using l_X &= \\min(4, \\max(0, \\ell - 1)) \\,,\\quad&\n  \\immed_X &\\equiv \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}}}\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.41",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\using r_A &= \\min(12, (\\instructions_{\\imath+1}) \\bmod 16) \\,,\\quad&\n    \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n    \\reg'_A \\equiv \\reg'_{r_A} \\\\\n    \\using r_B &= \\min(12, \\ffrac{\\instructions_{\\imath+1}}{16}) \\,,\\quad&\n    \\reg_B &\\equiv \\reg_{r_B} \\,,\\quad\n    \\reg'_B \\equiv \\reg'_{r_B} \\\\\n    \\using l_X &= \\min(4, \\max(0, \\ell - 1)) \\,,\\quad&\n    \\immed_X &\\equiv \\imath + \\signfunc{l_X}(\\decode[l_X]{\\instructions\\subrange{\\imath+2}{l_X}})\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.42",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\using r_A &= \\min(12, (\\instructions_{\\imath+1}) \\bmod 16) \\,,\\quad&\n    \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n    \\reg'_A \\equiv \\reg'_{r_A} \\\\\n    \\using r_B &= \\min(12, \\ffrac{\\instructions_{\\imath+1}}{16}) \\,,\\quad&\n    \\reg_B &\\equiv \\reg_{r_B} \\,,\\quad\n    \\reg'_B \\equiv \\reg'_{r_B} \\\\\n    \\using l_X &= \\min(4, \\instructions_{\\imath+2} \\bmod 8) \\,,\\quad&\n    \\immed_X &= \\sext{l_X}{\\decode[l_X]{\\instructions\\subrange{\\imath+3}{l_X}}} \\\\\n    \\using l_Y &= \\min(4, \\max(0, \\ell - l_X - 2)) \\,,\\quad&\n    \\immed_Y &= \\sext{l_Y}{\\decode[l_Y]{\\instructions\\subrange{\\imath+3+l_X}{l_Y}}}\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.43",
"tex": "\\begin{equation}\n\\begin{aligned}\n  \\using r_A &= \\min(12, (\\instructions_{\\imath+1}) \\bmod 16) \\,,\\quad&\n  \\reg_A &\\equiv \\reg_{r_A} \\,,\\quad\n  \\reg'_A \\equiv \\reg'_{r_A} \\\\\n  \\using r_B &= \\min(12, \\ffrac{\\instructions_{\\imath+1}}{16}) \\,,\\quad&\n  \\reg_B &\\equiv \\reg_{r_B} \\,,\\quad\n  \\reg'_B \\equiv \\reg'_{r_B} \\\\\n  \\using r_D &= \\min(12, \\instructions_{\\imath+2}) \\,,\\quad&\n  \\reg_D &\\equiv \\reg_{r_D} \\,,\\quad\n  \\reg'_D \\equiv \\reg'_{r_D} \\\\\n\\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "A.44",
"tex": "\\begin{equation}\n  \\smod\\colon\\abracegroup{\n    \\tuple{\\Z, \\Z} &\\to \\Z\\\\\n    \\tup{a, b} &\\mapsto \\begin{cases}\n      a &\\when b = 0\\\\\n      \\text{sgn}(a)(\\len{a} \\bmod \\len{b}) &\\otherwise \\\\\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "A.45",
"tex": "\\begin{equation}\n  \\rtz\\colon\\abracegroup{\n    \\Z &\\to \\Z\\\\\n    x &\\mapsto \\begin{cases}\n      \\ceil{x} &\\when x < 0\\\\\n      \\floor{x} &\\otherwise \\\\\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "A.46",
"tex": "\\begin{align}\n  &\\Psi_H\\colon \\abracegroup{\n    \\tuple{\\begin{aligned}\n      &\\blob, \\pvmreg, \\gas, \\regs,&\\ram, \\contextmutator{X}, X\n    \\end{aligned}\n    }\n    &\\to\n    \\tuple{\\set{\\panic, \\oog, \\halt} \\cup \\set{\\fault} \\times \\pvmreg, \\pvmreg, \\signedgas, \\regs, \\ram, X}"},
{"label": null,
"index": "A.47",
"tex": "\n    \\tup{\\mathbf{c}, \\imath, \\gascounter, \\registers, \\mem, f, \\mathbf{x}} &\\mapsto \\begin{cases}\n      \\multicolumn{2}{l}{\\text{let }(\\varepsilon', \\imath', \\gascounter', \\registers', \\mem') = \\Psi(\\mathbf{c}, \\imath, \\gascounter, \\registers, \\mem):} [8pt]\n      \\tup{\\varepsilon', \\imath', \\gascounter', \\registers', \\mem', \\mathbf{x}} &\\when \\varepsilon' \\in \\set{ \\halt, \\panic, \\oog } \\cup \\set{\\fault} \\times \\pvmreg [4pt]\n      \\tup{\\fault \\times a, \\imath', \\gascounter', \\registers', \\mem', \\mathbf{x}} &\\when \\bigwedge\\abracegroup[\\;]{\n        &\\varepsilon' = \\host \\times h[2pt]\n        &\\fault \\times a = f(h, \\gascounter', \\registers', \\mem', \\mathbf{x})[2pt]\n      }[10 pt]\n      \\Psi_H(\\mathbf{c}, \\imath', \\gascounter'', \\registers'', \\mem'', f, \\mathbf{x}'')\n       &\\when \\bigwedge\\abracegroup[\\;]{\n        &\\varepsilon' = \\host \\times h[2pt]\n        &\\tup{\\continue, \\gascounter'', \\registers'', \\mem'', \\mathbf{x}''} = f(h, \\gascounter', \\registers', \\mem', \\mathbf{x})\n      }[8pt]\n      \\tup{\\varepsilon'', \\imath', \\gascounter'', \\registers'', \\mem'', \\mathbf{x}''} &\\when  \\bigwedge\\abracegroup[\\;]{\n        &\\varepsilon' = \\host \\times h[2pt]\n        &\\tup{\\varepsilon'', \\gascounter'', \\registers'', \\mem'', \\mathbf{x}''} = f(h, \\gascounter', \\registers', \\mem', \\mathbf{x})[2pt]\n        &\\varepsilon'' \\in \\set{\\panic, \\halt, \\oog}\n      }[8pt]\n    \\end{cases} "},
{"label": null,
"index": "A.48",
"tex": "\n    }\\!\\!\\!\\!\\!\\!\\!\\!"},
{"label": null,
"index": "A.49",
"tex": "\n    &\\contextmutator{X} \\equiv \\tuple{\\N, \\gas, \\regs, \\ram, X} \\to \\tuple{\\set{\\continue, \\halt, \\panic, \\oog}, \\gas, \\regs, \\ram, X} \\cup \\set{\\fault} \\times \\pvmreg\n\\end{align}"},
{"label": null,
"index": "A.50",
"tex": "\\begin{equation}\nY\\colon\\abracegroup{\n  \\tuple{\\blob, \\blob[:\\Cpvminitinputsize]} &\\to \\tuple{\\blob, \\regs, \\ram}? \\\\\n  \\tup{\\mathbf{p}, \\mathbf{a}} &\\mapsto \\begin{cases}\n    \\tup{\\mathbf{c}, \\registers, \\mem} &\\when \\exists! \\tup{\\mathbf{c}, \\mathbf{o}, \\mathbf{w}, z, s} \\text{ which satisfy equation \\ref{eq:conditions}}\\\\\n    \\none &\\otherwise\n  \\end{cases}\n}\n\\end{equation}"},
{"label": "eq:conditions",
"index": "A.51",
"tex": "\\begin{align}\\label{eq:conditions}\n  &\\using \\mathcal{E}_3(\\len{\\mathbf{o}}) \\concat \\mathcal{E}_3(\\len{\\mathbf{w}}) \\concat \\mathcal{E}_2(z) \\concat \\mathcal{E}_3(s) \\concat \\mathbf{o} \\concat \\mathbf{w} \\concat \\mathcal{E}_4(\\len{\\mathbf{c}}) \\concat \\mathbf{c} = \\mathbf{p}"},
{"label": null,
"index": "A.52",
"tex": "\n  &\\Cpvminitzonesize = 2^{16}\\ ,\\quad\\Cpvminitinputsize = 2^{24}"},
{"label": null,
"index": "A.53",
"tex": "\n  &\\using \\rnp{x \\in \\N} \\equiv \\Cpvmpagesize\\ceil{ \\frac{x}{\\Cpvmpagesize} }\\quad,\\qquad\\rnq{x \\in \\N} \\equiv \\Cpvminitzonesize\\ceil{ \\frac{x}{\\Cpvminitzonesize} }"},
{"label": null,
"index": "A.54",
"tex": "\n  &5\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}} + \\rnq{\\len{\\mathbf{w}} + z\\Cpvmpagesize} + \\rnq{s} + \\Cpvminitinputsize \\leq 2^{32}\n\\end{align}"},
{"label": "eq:memlayout",
"index": "A.55",
"tex": "\\begin{equation}\\label{eq:memlayout}\n  \\forall i \\in \\Nbits{32} : ((\\mem_\\ram\u00acvalue)\\sub{i}, (\\mem_\\ram\u00acaccess)_{\\floor{\\nicefrac{i}{\\Cpvmpagesize}}}) = \\bracegroup{\\begin{alignedat}{5}\n    &\\tup{\\is{\\ram\u00acvalue}{\\mathbf{o}_{i - \\Cpvminitzonesize}},\\,\\is{\\ram\u00acaccess}{R}} &&\\ \\when\n        \\Cpvminitzonesize\n            &\\ \\leq i < \\ &&\n                \\Cpvminitzonesize + \\len{\\mathbf{o}}\\\\\n    &\\tup{0, R} &&\\ \\when\n        \\Cpvminitzonesize + \\len{\\mathbf{o}}\n            &\\ \\leq i < \\ &&\n                \\Cpvminitzonesize + \\rnp{\\len{\\mathbf{o}}} \\\\\n    &(\\mathbf{w}_{i - (2\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}})}, W) &&\\ \\when\n        2\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}}\n            &\\ \\leq i < \\ &&\n                2\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}} + \\len{\\mathbf{w}}\\\\\n    &\\tup{0, W} &&\\ \\when\n        2\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}} + \\len{\\mathbf{w}}\n            &\\ \\leq i < \\ &&\n                2\\Cpvminitzonesize + \\rnq{\\len{\\mathbf{o}}} + \\rnp{\\len{\\mathbf{w}}} + z\\Cpvmpagesize\\\\\n    &\\tup{0, W} &&\\ \\when\n        2^{32} - 2\\Cpvminitzonesize - \\Cpvminitinputsize - \\rnp{s}\n            &\\ \\leq i < \\ &&\n                2^{32} - 2\\Cpvminitzonesize - \\Cpvminitinputsize\\\\\n    &(\\mathbf{a}_{i - (2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize)}, R) &&\\ \\when\n        2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize\n            &\\ \\leq i < \\ &&\n                2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize + \\len{\\mathbf{a}}\\\\\n    &\\tup{0, R} &&\\ \\when\n        2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize + \\len{\\mathbf{a}}\n            &\\ \\leq i < \\ &&\n                2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize + \\rnp{\\len{\\mathbf{a}}}\\\\\n    &\\tup{0, \\none} &&\\otherwise&&&\n  \\end{alignedat}}\\\\\n\\end{equation}"},
{"label": "eq:registers",
"index": "A.56",
"tex": "\\begin{equation}\\label{eq:registers}\n  \\forall i \\in \\Nmax{13} : \\registers\\sub{i} = \\begin{cases}\n      2^{32} - 2^{16} &\\when i = 0\\\\\n      2^{32} - 2\\Cpvminitzonesize - \\Cpvminitinputsize &\\when i = 1\\\\\n      2^{32} - \\Cpvminitzonesize - \\Cpvminitinputsize &\\when i = 7\\\\\n      \\len{\\mathbf{a}}&\\when i = 8\\\\\n      0 &\\otherwise\n    \\end{cases}\n\\end{equation}"},
{"label": null,
"index": "A.57",
"tex": "\\begin{equation}\n  \\Psi_M\\colon \\abracegroup{\n    \\tuple{\n      \\blob, \\pvmreg, \\gas, \\blob[:\\Cpvminitinputsize], \\contextmutator{X}, X\n    } &\\to \\tuple{\\gas, \\blob \\cup \\set{\\panic, \\oog}, X}\\\\\n    \\tup{\\mathbf{p}, \\imath, \\gascounter, \\mathbf{a}, f, \\mathbf{x}} &\\mapsto \\begin{cases}\n      \\tup{0, \\panic, \\mathbf{x}} &\\when Y(\\mathbf{p}, \\mathbf{a}) = \\none\\\\\n      R(\\gascounter, \\Psi_H(\\mathbf{c}, \\imath, \\gascounter, \\registers, \\mem, f, \\mathbf{x})) &\\when Y(\\mathbf{p}, \\mathbf{a}) = \\tup{\\mathbf{c}, \\registers, \\mem}\\\\\n      \\multicolumn{2}{l}{\n        \\quad \\where R \\colon \\tup{\\gascounter, \\tup{\\begin{alignedat}{5}\n          &\\varepsilon,\\, &&\\imath',\\, &&\\gascounter',\\\\\n          &\\registers',\\, &&\\mem',\\, &&\\mathbf{x}'\n        \\end{alignedat}\n        }} \\mapsto \\begin{cases}\n          \\tup{u, \\oog, \\mathbf{x}'} &\\when \\varepsilon = \\oog \\\\\n          \\tup{u, \\memory'_{\\registers'_{7}\\dots+\\registers'_{8}}, \\mathbf{x}'} &\\when \\varepsilon = \\halt \\wedge \\Nrange{\\registers'_{7}}{\\registers'_{8}} \\subseteq \\readable{\\mem'} \\\\\n          \\tup{u, \\sq{}, \\mathbf{x}'} &\\when \\varepsilon = \\halt \\wedge \\Nrange{\\registers'_{7}}{\\registers'_{8}} \\not\\subseteq \\readable{\\mem'} \\\\\n          \\tup{u, \\panic, \\mathbf{x}'} &\\otherwise \\\\\n          \\multicolumn{2}{l}{\\quad \\where u = \\gascounter - \\max(\\gascounter', 0)}\n        \\end{cases}\n      }\\!\\!\\!\\!\\!\\!\\!\\!\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": "eq:isauthinvocation",
"index": "B.1",
"tex": "\\begin{align}\n  \\label{eq:isauthinvocation}\n  \\Psi_I &\\colon \\abracegroup{\n    \\tuple{\\workpackage, \\coreindex} &\\to \\tuple{\\blob \\cup \\workerror, \\gas} "},
{"label": null,
"index": "B.2",
"tex": "\n    \\tup{\\wpX, c} &\\mapsto \\begin{cases}\n      \\tup{\\token{BAD}, 0} &\\when \\wpX_\\wp\u00acauthcode = \\none \n      \\tup{\\token{BIG}, 0} &\\otherwhen \\len{\\wpX_\\wp\u00acauthcode} > \\Cmaxauthcodesize \n      \\tup{\\mathbf{r}, u} &\\otherwise \n      \\multicolumn{2}{l}{\\where \\tup{u, \\mathbf{r}, \\none} = \\Psi_M(\\wpX_\\wp\u00acauthcode, 0, \\Cpackageauthgas, \\encode[2]{c}, F, \\none)}\n    \\end{cases}"},
{"label": null,
"index": "B.3",
"tex": "\n  } "},
{"label": "eq:isauthorizedmutator",
"index": "B.4",
"tex": "\n  \\label{eq:isauthorizedmutator}F \\in \\contextmutator{\\emset} &\\colon\n    \\tup{n, \\gascounter, \\registers, \\memory} \\mapsto \\begin{cases}\n      \\Omega_G(\\gascounter, \\registers, \\memory) &\\when n = \\mathtt{gas} \n      \\Omega_Y(\\gascounter, \\registers, \\memory, \\wpX, \\none, \\none, \\none, \\none, \\none, \\none, \\none) &\\when n = \\mathtt{fetch} \n      \\tup{\\continue, \\gascounter - 10, \\sq{\\registers_0, \\dots, \\registers_6, \\mathtt{WHAT}, \\registers_8, \\dots}, \\memory} &\\otherwise\n    \\end{cases}\n\\end{align}"},
{"label": null,
"index": "B.5",
"tex": "\\begin{equation}\n  \\Cexpungeperiod \\equiv \\Cmaxlookupanchorage + 4,800 = 19,200\n\\end{equation}"},
{"label": "eq:pvmguest",
"index": "B.6",
"tex": "\\begin{equation}\\label{eq:pvmguest}\n  \\pvmguest \\equiv \\tuple{\\isa{\\pg\u00accode}{\\blob}, \\isa{\\pg\u00acram}{\\ram}, \\isa{\\pg\u00acpc}{\\pvmreg}}\n\\end{equation}"},
{"label": "eq:refinvocation",
"index": "B.7",
"tex": "\\begin{align}\n  &\\Psi_R \\colon \\abracegroup{\n    \\label{eq:refinvocation}\n    \\tuple{\\N, \\workpackage, \\blob, \\sequence{\\sequence{\\segment}}, \\N} &\\to \\tuple{\\blob \\cup \\workerror, \\sequence{\\segment}, \\gas} "},
{"label": null,
"index": "B.8",
"tex": "\n    \\tup{i, p, \\mathbf{r}, \\overline{\\mathbf{i}}, \\segoff} &\\mapsto \\begin{cases}\n      \\tup{\\token{BAD}, \\sq{}, 0} &\\when w_\\wi\u00acserviceindex \\not\\in \\keys{\\accounts} \\vee \\histlookup(\\accounts\\subb{w_\\wi\u00acserviceindex}, (p_\\wp\u00accontext)_\\wc\u00aclookupanchortime, w_\\wi\u00accodehash) = \\none \n      \\tup{\\token{BIG}, \\sq{}, 0} &\\otherwhen \\len{\\histlookup(\\accounts\\subb{w_\\wi\u00acserviceindex}, (p_\\wp\u00accontext)_\\wc\u00aclookupanchortime, w_\\wi\u00accodehash)} > \\Cmaxservicecodesize \n      &\\otherwise: \n      &\\quad\\using a = \\encode{i, w_\\wi\u00acserviceindex, \\var{w_\\wi\u00acpayload}, \\blake{p}}\\;,\\ \\encode{\\var{\\mathbf{z}}, \\mathbf{c}} = \\histlookup(\\accounts\\subb{w_\\wi\u00acserviceindex}, (p_\\wp\u00accontext)_\\wc\u00aclookupanchortime, w_\\wi\u00accodehash)\n      &\\quad\\also \\tup{u, \\mathbf{o}, \\tup{\\mathbf{m}, \\mathbf{e}}} = \\Psi_M(\\mathbf{c}, 0, w_\\wi\u00acrefgaslimit, a, F, \\tup{\\emptyset, \\sq{}})\\ \\colon\n      \\tup{\\mathbf{o}, \\sq{}, u} &\\quad\\when \\mathbf{o} \\in \\set{ \\oog, \\panic }  \n      \\tup{\\mathbf{o}, \\mathbf{e}, u} &\\quad\\otherwise \n      \\multicolumn{2}{l}{\\where w = p_\\wp\u00acworkitems\\subb{i}}\n    \\end{cases} "},
{"label": null,
"index": "B.9",
"tex": "\n  } "},
{"label": "eq:refinemutator",
"index": "B.10",
"tex": "\n  \\label{eq:refinemutator}\n  &F \\in \\contextmutator{\\tuple{\\dictionary{\\N}{\\pvmguest}, \\sequence{\\segment}}} \\colon\n    (n, \\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) \\mapsto \\begin{cases}\n      \\Omega_G(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{gas} \n      \\Omega_Y(\\gascounter, \\registers, \\memory, p, \\zerohash, \\mathbf{r}, i, \\overline{\\mathbf{i}}, \\overline{\\mathbf{x}}, \\none, \\none, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{fetch}\n      \\Omega_H(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}, w_\\wi\u00acserviceindex, \\accounts, (p_\\wp\u00accontext)_\\wc\u00aclookupanchortime) &\\when n = \\mathtt{historical\\_lookup}\n      \\Omega_E(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}, \\segoff) &\\when n = \\mathtt{export}\n      \\Omega_M(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{machine}\n      \\Omega_P(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{peek}\n      \\Omega_O(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{poke}\n      \\Omega_Z(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{pages}\n      \\Omega_K(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{invoke}\n      \\Omega_X(\\gascounter, \\registers, \\memory, \\tup{\\mathbf{m}, \\mathbf{e}}) &\\when n = \\mathtt{expunge}\n      \\tup{\\continue, \\gascounter - 10, \\registers', \\memory} &\\otherwise\n      \\multicolumn{2}{l}{\\where \\registers' = \\registers \\exc \\registers'_7 = \\mathtt{WHAT}} \n      \\multicolumn{2}{l}{\\also \\overline{\\mathbf{x}} = \\sq{\\build{\n        \\sq{\\build{\n          \\mathbf{x}\n        }{\n          \\tup{\\blake{\\mathbf{x}}, \\len{\\mathbf{x}}} \\orderedin \\wiX_\\wi\u00acextrinsics\n        }}\n      }{\n        \\wiX \\orderedin p_\\wp\u00acworkitems\n      }}}\n    \\end{cases}\n\\end{align}"},
{"label": "eq:implications",
"index": "B.11",
"tex": "\\begin{align}\\label{eq:implications}\n  \\implications &\\equiv \\tuple{\n    \\isa{\\im\u00acid}{\\serviceid},\n    \\isa{\\im\u00acstate}{\\partialstate},\n    \\isa{\\im\u00acnextfreeid}{\\serviceid},\n    \\isa{\\im\u00acxfers}{\\defxfers},\n    \\isa{\\im\u00acyield}{\\optional{\\hash}},\n    \\isa{\\im\u00acprovisions}{\\protoset{\\tuple{\\serviceid, \\blob}}}\n  }"},
{"label": null,
"index": "B.12",
"tex": "\n  \\forall \\imX \\in \\implications :\n    \\imX_\\im\u00acself &\\equiv (\\imX_\\im\u00acstate)_\\ps\u00acaccounts\\subb{\\imX_\\im\u00acid}\n\\end{align}"},
{"label": "eq:accinvocation",
"index": "B.13",
"tex": "\\begin{align}\n  \\label{eq:accinvocation}\n  \\Psi_A& \\colon\\abracegroup{\n    \\tuple{\n      \\partialstate, \\timeslot, \\serviceid, \\gas, \\sequence{\\operandtuple}\n    }\n    &\\to \\acconeout\n    "},
{"label": null,
"index": "B.14",
"tex": "\n    \\tup{\\local\u00acbasestate, t, s, g, \\mathbf{o}} &\\mapsto \\begin{cases}\n      \\tup{\n        \\ao\u00acpoststate,\n        \\is{\\ao\u00acdefxfers}{\\sq{}},\n        \\is{\\ao\u00acyield}{\\none},\n        \\is{\\ao\u00acgasused}{0},\n        \\is{\\ao\u00acprovisions}{\\sq{}}\n      }\n        &\\when \\mathbf{c} = \\none \\vee \\len{\\mathbf{c}} > \\Cmaxservicecodesize \n      C(\\Psi_M(\\mathbf{c}, 5, g, \\encode{t, s, \\len{\\mathbf{o}}}, F, I(\\local\u00acbasestate, s)^2))\n        &\\otherwise \n      \\where \\mathbf{c} = \\local\u00acbasestate_\\ps\u00acaccounts\\subb{s}_\\sa\u00accode&\n    \\end{cases} "},
{"label": null,
"index": "B.15",
"tex": "\n  }"},
{"label": null,
"index": "B.16",
"tex": "\n  I&\\colon\\abracegroup{\n    \\tuple{\\partialstate, \\serviceid} &\\to \\implications"},
{"label": null,
"index": "B.17",
"tex": "\n    \\tup{\\im\u00acstate, \\im\u00acid} &\\mapsto \\tup{\n      \\im\u00acid,\n      \\im\u00acstate,\n      \\im\u00acnextfreeid,\n      \\is{\\im\u00acxfers}{\\sq{}},\n      \\is{\\im\u00acyield}{\\none},\n      \\is{\\im\u00acprovisions}{\\sq{}}\n    }"},
{"label": null,
"index": "B.18",
"tex": "\n    &\\qquad\\where \\im\u00acnextfreeid = \\text{check}((\\decode[4]{\\blake{\\encode{\\im\u00acid, \\entropyaccumulator', \\H_\\\u00actimeslot}}} \\bmod (2^{32}-2^9)) + 2^8) "},
{"label": null,
"index": "B.19",
"tex": "\n  }"},
{"label": null,
"index": "B.20",
"tex": "\n  F \\in \\contextmutator{\\implicationspair} &\\colon \\tup{n, \\gascounter, \\registers, \\memory, \\imXY} \\mapsto \\begin{cases}\n  \\Omega_G(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{gas} \n    \\Omega_Y(\\gascounter, \\registers, \\memory, \\none, \\entropyaccumulator', \\none, \\none, \\none, \\none, \\mathbf{o}, \\none, \\imXY) &\\when n = \\mathtt{fetch}\n    G(\\Omega_R(\\gascounter, \\registers, \\memory, \\imX_\\im\u00acself, \\imX_\\im\u00acid, (\\imX_\\im\u00acstate)_\\ps\u00acaccounts), \\imXY) &\\when n = \\mathtt{read} \n    G(\\Omega_W(\\gascounter, \\registers, \\memory, \\imX_\\im\u00acself, \\imX_\\im\u00acid), \\imXY) &\\when n = \\mathtt{write} \n    G(\\Omega_L(\\gascounter, \\registers, \\memory, \\imX_\\im\u00acself, \\imX_\\im\u00acid, (\\imX_\\im\u00acstate)_\\ps\u00acaccounts), \\imXY) &\\when n = \\mathtt{lookup} \n    G(\\Omega_I(\\gascounter, \\registers, \\memory, \\imX_\\im\u00acid, (\\imX_\\im\u00acstate)_\\ps\u00acaccounts), \\imXY) &\\when n = \\mathtt{info} \n    \\Omega_B(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{bless}\n    \\Omega_A(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{assign}\n    \\Omega_D(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{designate}\n    \\Omega_C(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{checkpoint} \n    \\Omega_N(\\gascounter, \\registers, \\memory, \\imXY, \\H_\\\u00actimeslot) &\\when n = \\mathtt{new} \n    \\Omega_U(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{upgrade} \n    \\Omega_T(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{transfer} \n    \\Omega_J(\\gascounter, \\registers, \\memory, \\imXY, \\H_\\\u00actimeslot) &\\when n = \\mathtt{eject} \n    \\Omega_Q(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{query} \n    \\Omega_S(\\gascounter, \\registers, \\memory, \\imXY, \\H_\\\u00actimeslot) &\\when n = \\mathtt{solicit} \n    \\Omega_F(\\gascounter, \\registers, \\memory, \\imXY, \\H_\\\u00actimeslot) &\\when n = \\mathtt{forget} \n    \\Omega_\\Taurus(\\gascounter, \\registers, \\memory, \\imXY) &\\when n = \\mathtt{yield} \n    \\Omega_\\Aries(\\gascounter, \\registers, \\memory, \\imXY, \\imX_\\im\u00acid) &\\when n = \\mathtt{provide} \n    \\tup{\\continue, \\gascounter - 10, \\sq{\\registers_0, \\dots, \\registers_6, \\mathtt{WHAT}, \\registers_8, \\dots}, \\memory, \\imXY} &\\otherwise\n  \\end{cases} "},
{"label": null,
"index": "B.21",
"tex": "\n  G&\\colon\\abracegroup{\n    \\tuple{\\tuple{\\set{\\continue, \\halt, \\panic, \\oog}, \\gas, \\regs, \\ram, \\serviceaccount}, \\implicationspair} &\\to \\tuple{\\set{\\continue, \\halt, \\panic, \\oog}, \\gas, \\regs, \\ram, \\implicationspair} "},
{"label": null,
"index": "B.22",
"tex": "\n    \\tup{\\tup{\\execst, \\gascounter, \\registers, \\memory, \\mathbf{s}}, \\imXY} &\\mapsto \\tup{\\execst, \\gascounter, \\registers, \\memory, \\tup{\\imX^*, \\imY}} "},
{"label": null,
"index": "B.23",
"tex": "\n    &\\qquad \\where \\imX^* = \\imX \\exc \\imX^*_\\im\u00acself = \\mathbf{s}\n  }"},
{"label": null,
"index": "B.24",
"tex": "\n  C&\\colon\\abracegroup{\n    \\tuple{\\gas, \\blob \\cup \\set{\\oog, \\panic}, \\implicationspair} &\\to \\acconeout "},
{"label": null,
"index": "B.25",
"tex": "\n    \\tup{\\ao\u00acgasused, \\mathbf{o}, \\imXY} &\\mapsto \\begin{cases}\n      \\tup{\n        \\is{\\ao\u00acpoststate}{\\imY_\\im\u00acstate},\n        \\is{\\ao\u00acdefxfers}{\\imY_\\im\u00acxfers},\n        \\is{\\ao\u00acyield}{\\imY_\\im\u00acyield},\n        \\ao\u00acgasused,\n        \\is{\\ao\u00acprovisions}{\\imY_\\im\u00acprovisions}\n      } & \\when \\mathbf{o} \\in \\set{\\oog, \\panic} \n      \\tup{\n        \\is{\\ao\u00acpoststate}{\\imX_\\im\u00acstate},\n        \\is{\\ao\u00acdefxfers}{\\imX_\\im\u00acxfers},\n        \\is{\\ao\u00acyield}{\\mathbf{o}},\n        \\ao\u00acgasused,\n        \\is{\\ao\u00acprovisions}{\\imXY_\\im\u00acprovisions}\n      } & \\otherwhen \\mathbf{o} \\in \\hash \n      \\tup{\n        \\is{\\ao\u00acpoststate}{\\imX_\\im\u00acstate},\n        \\is{\\ao\u00acdefxfers}{\\imX_\\im\u00acxfers},\n        \\is{\\ao\u00acyield}{\\imX_\\im\u00acyield},\n        \\ao\u00acgasused,\n        \\is{\\ao\u00acprovisions}{\\imX_\\im\u00acprovisions}\n      } & \\otherwise \n    \\end{cases}\n  }\n\\end{align}"},
{"label": null,
"index": "B.26",
"tex": "\\begin{equation}\n  \\text{check}(i \\in \\serviceid) \\equiv \\begin{cases}\n    i &\\when i \\not\\in \\keys{\\local\u00acbasestate_\\ps\u00acaccounts} \\\\\n    \\text{check}((i - 2^8 + 1) \\bmod (2^{32}-2^9) + 2^8)&\\otherwise\n  \\end{cases}\n\\end{equation}"},
{"label": "eq:onxferinvocation",
"index": "B.27",
"tex": "\\begin{align}\n  \\label{eq:onxferinvocation}\n  \\Psi_T &: \\begin{cases}\n    \\tuple{\\dictionary{\\serviceid}{\\serviceaccount}, \\timeslot, \\serviceid, \\defxfers}\n    &\\to \\tuple{\\serviceaccount, \\gas} \n    \\tup{\\mathbf{d}, t, s, \\mathbf{t}} &\\mapsto \\begin{cases}\n      \\tup{\\mathbf{s}, 0}\n        &\\when \\mathbf{s}_\\sa\u00accode = \\none \\vee\n          \\len{\\mathbf{s}_\\sa\u00accode} > \\Cmaxservicecodesize \\vee\n          \\mathbf{t} = \\sq{} \n      \\tup{\\mathbf{s}', u} &\\otherwise \n      \\multicolumn{2}{l}{\n        \\begin{aligned}\n          \\quad\\where \\tup{u, \\mathbf{r}, \\mathbf{s}'} &= \\Psi_M(\n            \\mathbf{s}_\\sa\u00accode,\n            10,\n            \\sum_{r \\in \\mathbf{t}}{(r_\\dx\u00acgas)},\n            \\encode{t, s, \\len{\\mathbf{t}}},\n            F,\n            \\mathbf{s}\n          ) \n          \\quad\\also \\mathbf{s} &= \\mathbf{d}\\subb{s} \\exc \\mathbf{s}_\\sa\u00acbalance = \\mathbf{d}\\subb{s}_\\sa\u00acbalance + \\sum_{r \\in \\mathbf{t}}{r_\\dx\u00acamount} \n        \\end{aligned}\n      }\n    \\end{cases} \n  \\end{cases} "},
{"label": null,
"index": "B.28",
"tex": "\n  \\also F &\\in \\contextmutator{\\serviceaccount}\\colon \\tup{n, \\gascounter, \\registers, \\memory, \\mathbf{s}} \\equiv \\begin{cases}\n    \\Omega_G(\\gascounter, \\registers, \\memory) &\\when n = \\mathtt{gas} \n    \\Omega_Y(\\gascounter, \\registers, \\memory, \\none, \\entropyaccumulator', \\none, \\none, \\none, \\none, \\none, \\mathbf{t}) &\\when n = \\mathtt{fetch}\n    \\Omega_L(\\gascounter, \\registers, \\memory, \\mathbf{s}, s, \\mathbf{d}) &\\when n = \\mathtt{lookup} \n    \\Omega_R(\\gascounter, \\registers, \\memory, \\mathbf{s}, s, \\mathbf{d}) &\\when n = \\mathtt{read} \n    \\Omega_W(\\gascounter, \\registers, \\memory, \\mathbf{s}, s) &\\when n = \\mathtt{write} \n    \\Omega_I(\\gascounter, \\registers, \\memory, s, \\mathbf{d}) &\\when n = \\mathtt{info} \n    \\tup{\\continue, \\gascounter - 10, \\sq{\\registers_0, \\dots, \\registers_6, \\mathtt{WHAT}, \\registers_8, \\dots}, \\memory, \\mathbf{s}} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "B.29",
"tex": "\\begin{align}\n  \\gascounter' &\\equiv \\gascounter - g"},
{"label": null,
"index": "B.30",
"tex": "\n  \\tup{\\execst', \\registers', \\memory', \\mathbf{s}'} &\\equiv \\begin{cases}\n    \\tup{\\oog, \\registers, \\memory, \\mathbf{s}} &\\when \\gascounter < g\n    \\tup{\\continue, \\registers, \\memory, \\mathbf{s}} \\text{ except as indicated below} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "B.31",
"tex": "\\begin{align}\n  \\gascounter' &\\equiv \\gascounter - g"},
{"label": null,
"index": "B.32",
"tex": "\n  \\tup{\\execst', \\registers', \\memory'} &\\equiv \\begin{cases}\n    \\tup{\\oog, \\registers, \\memory} &\\when \\gascounter < g\n    \\tup{\\continue, \\registers, \\memory} \\text{ except as indicated below} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "B.33",
"tex": "\\begin{align}\n  \\gascounter' &\\equiv \\gascounter - g"},
{"label": null,
"index": "B.34",
"tex": "\n  \\tup{\\execst', \\registers', \\memory', \\imX', \\mathbf{y}'} &\\equiv \\begin{cases}\n    \\tup{\\oog, \\registers, \\memory, \\mathbf{x}, \\mathbf{y}} &\\when \\gascounter < g\n    \\tup{\\continue, \\registers, \\memory, \\mathbf{x}, \\mathbf{y}} \\text{ except as indicated below} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "C.1",
"tex": "\\begin{equation}\n  \\encode{\\none} \\equiv \\sq{}\n\\end{equation}"},
{"label": null,
"index": "C.2",
"tex": "\\begin{equation}\n  \\encode{x \\in \\blob} \\equiv x\n\\end{equation}"},
{"label": null,
"index": "C.3",
"tex": "\\begin{equation}\n  \\encode{\\tup{a, b, \\dots}} \\equiv \\encode{a} \\concat \\encode{b} \\concat \\dots\n\\end{equation}"},
{"label": null,
"index": "C.4",
"tex": "\\begin{align}\n  \\encode{a, b, \\dots} &\\equiv \\encode{\\tup{a, b, \\dots}}\n\\end{align}"},
{"label": null,
"index": "C.5",
"tex": "\\begin{equation}\n  \\fnencode\\colon\\abracegroup{\n    \\Nbits{64} &\\to \\blob[1:9] \\\\\n    x &\\mapsto \\begin{cases}\n     \\sq{0} &\\when x = 0 \\\\\n      \\sq{2^8-2^{8-l} + \\ffrac{x}{2^{8l}}} \\concat \\encode[l]{x \\bmod 2^{8l}} &\\when \\exists l \\in \\N_8 : 2^{7l} \\le x < 2^{7(l+1)} \\\\\n     \\sq{2^8-1} \\concat \\encode[8]{x} &\\otherwhen x < 2^{64} \\\\\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "C.6",
"tex": "\\begin{equation}\n  \\encode{[\\mathbf{i}_0, \\mathbf{i}_1, ...]} \\equiv \\encode{\\mathbf{i}_0} \\concat \\encode{\\mathbf{i}_1} \\concat \\dots\n\\end{equation}"},
{"label": null,
"index": "C.7",
"tex": "\\begin{equation}\n  \\var{x} \\equiv \\tup{\\len{x}, x}\\text{ thus }\\encode{\\var{x}} \\equiv \\encode{\\len{x}}\\concat\\encode{x}\n\\end{equation}"},
{"label": null,
"index": "C.8",
"tex": "\\begin{align}\n  \\maybe{x} \\equiv \\begin{cases}\n    0 &\\when x = \\none \n    \\tup{1, x} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "C.9",
"tex": "\\begin{align}\n  \\encode{b \\in \\bitstring} &\\equiv \\begin{cases}\n    \\sq{} &\\when b = \\sq{} \n    \\sq{\n      \\sum\\limits_{i=0}^{\\min(8, \\len{b})}\n      b\\sub{i} \\cdot 2^i\n    } \\concat \\encode{b\\interval{8}{}} &\\otherwise\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "C.10",
"tex": "\\begin{equation}\n  \\forall K, V: \\encode{d \\in \\dictionary{K}{V}} \\equiv\n    \\encode{\n      \\var{\\sq{\n        \\orderby{k}{\n          \\build{\n            \\tup{\\encode{k}, \\encode{d\\subb{k}}}\n          }{\n            k \\in \\keys{d}\n          }\n        }\n      }}\n    }\n\\end{equation}"},
{"label": null,
"index": "C.11",
"tex": "\\begin{equation}\n  \\encode{\\set{a, b, c, \\dots}} \\equiv \\encode{a} \\concat \\encode{b} \\concat \\encode{c} \\concat \\dots \\where a < b < c < \\dots\n\\end{equation}"},
{"label": null,
"index": "C.12",
"tex": "\\begin{equation}\n  \\fnencode[l \\in \\N]\\colon\\abracegroup{\n    \\Nbits{8l} &\\to \\blob[l] \\\\\n    x &\\mapsto \\begin{cases}\n      \\sq{} &\\when l = 0 \\\\\n      \\sq{x \\bmod 256} \\concat \\encode[l - 1]{\\floor{\\frac{x}{256}}} &\\otherwise\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "C.13",
"tex": "\\begin{align}\n  \\encode[l \\in \\N]{a, b, \\dots} &\\equiv \\encode[l]{\\tup{a, b, \\dots}}"},
{"label": null,
"index": "C.14",
"tex": "\n  \\encode[l \\in \\N]{\\tup{a, b, \\dots}} &\\equiv \\encode[l]{a} \\concat \\encode[l]{b} \\concat \\dots"},
{"label": null,
"index": "C.15",
"tex": "\n  \\encode[l \\in \\N]{\\sq{\\mathbf{i}_0, \\mathbf{i}_1, \\dots}} &\\equiv \\encode[l]{\\mathbf{i}_0} \\concat \\encode[l]{\\mathbf{i}_1} \\concat \\dots\n\\end{align}"},
{"label": null,
"index": "C.16",
"tex": "\\begin{align}\n  \\encode{\\block} &= \\encode{\n    \\header,\n    \\encodetickets{\\xttickets},\n    \\encodepreimages{\\xtpreimages},\n    \\encodeguarantees{\\xtguarantees},\n    \\encodeassurances{\\xtassurances},\n    \\encodedisputes{\\xtdisputes}\n  }\n  "},
{"label": null,
"index": "C.17",
"tex": "\n  \\encodetickets{\\xttickets} &= \\encode{\\var{\\xttickets}} \n  "},
{"label": null,
"index": "C.18",
"tex": "\n  \\encodepreimages{\\xtpreimages} &= \\encode{\n    \\var{\\sq{\\build{\n      \\tup{\\encode[4]{\\xp\u00acserviceindex}, \\var{\\xp\u00acdata}}\n    }{\n      \\tup{\\xp\u00acserviceindex, \\xp\u00acdata} \\orderedin \\xtpreimages}\n    }}}\n  "},
{"label": null,
"index": "C.19",
"tex": "\n  \\encodeguarantees{\\xtguarantees} &= \\encode{\n    \\var{\\sq{\\build{\n      \\tup{\\xg\u00acworkreport, \\encode[4]{\\xg\u00actimeslot}, \\var{\n        \\sq{\\build{\n          \\tup{\\encode[2]{v}, s}\n        }{\n          \\tup{v, s} \\orderedin \\xg\u00accredential\n        }}\n      }}\n    }{\n      \\tup{\\xg\u00acworkreport, \\xg\u00actimeslot, \\xg\u00accredential} \\orderedin \\xtguarantees}\n    }}}\n  "},
{"label": null,
"index": "C.20",
"tex": "\n  \\encodeassurances{\\xtassurances} &= \\encode{\n    \\var{\\sq{\\build{\n      \\tup{\\xa\u00acanchor, \\xa\u00acavailabilities, \\encode[2]{\\xa\u00acassurer}, \\xa\u00acsignature}\n    }{\n      \\tup{\\xa\u00acanchor, \\xa\u00acavailabilities, \\xa\u00acassurer, \\xa\u00acsignature} \\orderedin \\xtassurances}\n    }}}\n  "},
{"label": null,
"index": "C.21",
"tex": "\n  \\encodedisputes{\\tup{\\mathbf{v}, \\mathbf{c}, \\mathbf{f}}} &= \\encode{\n    \\var{\\sq{\\build{\n      \\tup{\\xv\u00acreporthash, \\encode[4]{\\xv\u00acepochindex},\n        \\sq{\\build{\n          \\tup{\\xvj\u00acvalidity, \\encode[2]{\\xvj\u00acjudgeindex}, \\xvj\u00acsignature}\n        }{\n          \\tup{\\xvj\u00acvalidity, \\xvj\u00acjudgeindex, \\xvj\u00acsignature} \\orderedin \\xv\u00acjudgments\n        }}\n      }\n    }{\n      \\tup{\\xv\u00acreporthash, \\xv\u00acepochindex, \\xv\u00acjudgments} \\orderedin \\mathbf{v}\n    }}},\n    \\var{\\mathbf{c}},\n    \\var{\\mathbf{f}}\n  }\n  "},
{"label": null,
"index": "C.22",
"tex": "\n  \\encode{\\header} &= \\encode{\n    \\encodeunsignedheader{\\header},\n    \\H_\\\u00acsealsig\n  }\n  "},
{"label": null,
"index": "C.23",
"tex": "\n  \\encodeunsignedheader{\\header} &= \\encode{\n    \\H_\\\u00acparent,\n    \\H_\\\u00acpriorstateroot,\n    \\H_\\\u00acextrinsichash\n    \\encode[4]{\\H_\\\u00actimeslot}\n    \\maybe{\\H_\\\u00acepochmark},\n    \\maybe{\\H_\\\u00acwinnersmark},\n    \\encode[2]{\\H_\\\u00acauthorindex},\n    \\H_\\\u00acvrfsig,\n    \\var{\\H_\\\u00acoffendersmark}\n  }\n  "},
{"label": null,
"index": "C.24",
"tex": "\n  \\encode{\\wcX \\in \\workcontext} &\\equiv \\encode{\n    \\wcX_\\wc\u00acanchorhash,\n    \\wcX_\\wc\u00acanchorpoststate,\n    \\wcX_\\wc\u00acanchoraccoutlog,\n    \\wcX_\\wc\u00aclookupanchorhash,\n    \\encode[4]{\\wcX_\\wc\u00aclookupanchortime},\n    \\var{\\wcX_\\wc\u00acprerequisites}\n  }\n  "},
{"label": null,
"index": "C.25",
"tex": "\n  \\encode{\\asX \\in \\avspec} &\\equiv \\encode{\n    \\asX_\\as\u00acpackagehash,\n    \\encode[4]{\\asX_\\as\u00acbundlelen},\n    \\asX_\\as\u00acerasureroot,\n    \\asX_\\as\u00acsegroot,\n    \\encode[2]{\\asX_\\as\u00acsegcount}\n  }\n  "},
{"label": null,
"index": "C.26",
"tex": "\n  \\encode{\\wdX \\in \\workdigest} &\\equiv \\encode{\n    \\encode[4]{\\wdX_\\wd\u00acserviceindex},\n    \\wdX_\\wd\u00accodehash,\n    \\wdX_\\wd\u00acpayloadhash,\n    \\encode[8]{\\wdX_\\wd\u00acgaslimit},\n    \\encoderesult{\\wdX_\\wd\u00acresult}\n    % These are variable length, since we never access them individually, digests\n    % are never accessed directly by the PVM and space is at a premium here.\n    \\wdX_\\wd\u00acgasused,\n    \\wdX_\\wd\u00acimportcount,\n    \\wdX_\\wd\u00acxtcount,\n    \\wdX_\\wd\u00acxtsize,\n    \\wdX_\\wd\u00acexportcount,\n  }\n  "},
{"label": null,
"index": "C.27",
"tex": "\n  \\encode{\\wrX \\in \\workreport} &\\equiv \\encode{\n    \\wrX_\\wr\u00acavspec,\n    \\wrX_\\wr\u00accontext,\n    \\wrX_\\wr\u00accore,\n    \\wrX_\\wr\u00acauthorizer,\n    \\wrX_\\wr\u00acauthgasused,\n    \\var{\\wrX_\\wr\u00acauthtrace},\n    \\var{\\wrX_\\wr\u00acsrlookup},\n    \\var{\\wrX_\\wr\u00acdigests}\n  }\n  "},
{"label": null,
"index": "C.28",
"tex": "\n  \\encode{\\wpX \\in \\workpackage} &\\equiv \\encode{\n    \\encode[4]{\\wpX_\\wp\u00acauthcodehost},\n    \\wpX_\\wp\u00acauthcodehash,\n    \\wpX_\\wp\u00accontext,\n    \\var{\\wpX_\\wp\u00acauthtoken},\n    \\var{\\wpX_\\wp\u00acauthconfig},\n    \\var{\\wpX_\\wp\u00acworkitems}\n  }\n  "},
{"label": null,
"index": "C.29",
"tex": "\n  \\encode{\\wiX \\in \\workitem} &\\equiv \\encode{\n    \\encode[4]{\\wiX_\\wi\u00acserviceindex},\n    \\wiX_\\wi\u00accodehash,\n    \\encode[8]{\\wiX_\\wi\u00acrefgaslimit},\n    \\encode[8]{\\wiX_\\wi\u00acaccgaslimit},\n    \\encode[2]{\\wiX_\\wi\u00acexportcount},\n    \\var{\\wiX_\\wi\u00acpayload},\n    \\var{\\encodeimportrefs{\\wiX_\\wi\u00acimportsegments}},\n    \\var{\\sq{\\build{\n      \\tup{h, \\encode[4]{i}}\n    }{\n      \\tup{h, i} \\orderedin \\wiX_\\wi\u00acextrinsics\n    }}}\n  }\n  "},
{"label": null,
"index": "C.30",
"tex": "\n  \\encode{\\stX \\in \\safroleticket} &\\equiv \\encode{\n    \\stX_\\st\u00acid,\n    \\stX_\\st\u00acentryindex\n  }\n  "},
{"label": null,
"index": "C.31",
"tex": "\n  \\encode{\\dxX \\in \\defxfer} &\\equiv \\encode{\n    \\encode[4]{\\dxX_\\dx\u00acsource},\n    \\encode[4]{\\dxX_\\dx\u00acdest},\n    \\encode[8]{\\dxX_\\dx\u00acamount},\n    \\dxX_\\dx\u00acmemo,\n    \\encode[8]{\\dxX_\\dx\u00acgas}\n  }\n  "},
{"label": null,
"index": "C.32",
"tex": "\n  \\encode{\\otX \\in \\operandtuple} &\\equiv \\encode{\n    \\otX_\\ot\u00acpackagehash,\n    \\otX_\\ot\u00acsegroot,\n    \\otX_\\ot\u00acauthorizer,\n    \\otX_\\ot\u00acpayloadhash,\n    \\otX_\\ot\u00acgaslimit,\n    \\encoderesult{\\otX_\\ot\u00acresult},\n    \\var{\\otX_\\ot\u00acauthtrace}\n  }\n  "},
{"label": null,
"index": "C.33",
"tex": "\n  \\encoderesult{o \\in \\workerror \\cup \\blob} &\\equiv \\begin{cases}\n    \\tup{0, \\var{o}} &\\when o \\in \\blob \n    1 &\\when o = \\infty \n    2 &\\when o = \\panic \n    3 &\\when o = \\badexports \n    4 &\\when o = \\oversize \n    5 &\\when o = \\token{BAD} \n    6 &\\when o = \\token{BIG}\n    \n  \\end{cases}\n  "},
{"label": null,
"index": "C.34",
"tex": "\n  \\encodeimportref{\\tup{\n    h \\in \\hash \\cup \\hash^\\boxplus,\n    i \\in \\Nbits{15}\n  }} &\\equiv \\begin{cases}\n    \\tup{h, \\encode[2]{i}} &\\when h \\in \\hash\n    \\tup{r, \\encode[2]{i + 2^{15}}} &\\when \\exists r \\in \\hash, h = r^\\boxplus\n  \\end{cases}\n\\end{align}"},
{"label": null,
"index": "D.1",
"tex": "\\begin{equation}\n  C\\colon\\abracegroup{\n    \\Nbits{8} \\cup \\tup{\\Nbits{8}, \\serviceid} \\cup \\tup{\\serviceid, \\blob} &\\to \\blob[31] \\\\\n    i \\in \\Nbits{8} &\\mapsto \\sq{i, 0, 0, \\dots} \\\\\n    \\tup{i, s \\in \\serviceid} &\\mapsto \\sq{i, n_0, 0, n_1, 0, n_2, 0, n_3, 0, 0, \\dots}\\ \\where n = \\encode[4]{s} \\\\\n    \\tup{s, h} &\\mapsto \\sq{n_0, a_0, n_1, a_1, n_2, a_2, n_3, a_3, a_4, a_5, \\dots, a_{26}}\\ \\where n = \\encode[4]{s}, a = \\blake{h}\\interval{0}{27}\n  }\n\\end{equation}"},
{"label": null,
"index": "D.2",
"tex": "\\begin{equation}\n  T(\\thestate) \\equiv \\abracegroup{\n    &&C(1) &\\mapsto \\encode{\\sq{\\build{\\var{x}}{x \\orderedin \\authpool}}} \\;, \\\\\n    &&C(2) &\\mapsto \\encode{\\authqueue} \\;, \\\\\n    &&C(3) &\\mapsto \\encode{\n      \\var{\\sq{\\build{\n        \\tup{\\rh\u00acheaderhash, \\rh\u00acaccoutlogsuperpeak, \\rh\u00acstateroot, \\var{\\rh\u00acreportedpackagehashes}}\n      }{\n        \\tup{\\rh\u00acheaderhash, \\rh\u00acaccoutlogsuperpeak, \\rh\u00acstateroot, \\rh\u00acreportedpackagehashes} \\orderedin \\recenthistory\n      }}},\n      \\mmrencode{\\accoutbelt}\n    } \\;, \\\\\n    &&C(4) &\\mapsto \\encode{\n      \\pendingset,\n      \\epochroot,\n      \\abracegroupboth{\n        0\\ &\\when \\sealtickets \\in \\sequence[\\Cepochlen]{\\safroleticket}\\\\\n        1\\ &\\when \\sealtickets \\in \\sequence[\\Cepochlen]{\\bskey}\\\\\n      },\n      \\sealtickets,\n      \\var{\\ticketaccumulator}\n    } \\;, \\\\\n    &&C(5) &\\mapsto \\encode{\n      \\var{\\sqorderby{x}{x \\in \\goodset}},\n      \\var{\\sqorderby{x}{x \\in \\badset}},\n      \\var{\\sqorderby{x}{x \\in \\wonkyset}},\n      \\var{\\sqorderby{x}{x \\in \\offenders}}\n    } \\;, \\\\\n    &&C(6) &\\mapsto \\encode{\\entropy} \\;, \\\\\n    &&C(7) &\\mapsto \\encode{\\stagingset} \\;, \\\\\n    &&C(8) &\\mapsto \\encode{\\activeset} \\;, \\\\\n    &&C(9) &\\mapsto \\encode{\\previousset} \\;, \\\\\n    &&C(10) &\\mapsto \\encode{\n      \\sq{\\build{\n        \\maybe{\\tup{\\rs\u00acworkreport, \\encode[4]{\\rs\u00actimestamp}}}\n      }{\n        \\tup{\\rs\u00acworkreport, \\rs\u00actimestamp} \\orderedin \\reports\n      }}\n    } \\;, \\\\\n    &&C(11) &\\mapsto \\encode[4]{\\thetime} \\;, \\\\\n    &&C(12) &\\mapsto \\encode{\n      \\encode[4]{\\manager, \\assigners, \\delegator},\n      \\alwaysaccers\n    } \\;, \\\\\n    &&C(13) &\\mapsto \\encode{\n      \\encode[4]{\\valstatsaccumulator, \\valstatsprevious},\n      \\corestats,\n      \\servicestats\n    } \\;, \\\\\n    &&C(14) &\\mapsto \\encode{\n      \\sq{\\build{\n        \\var{\\sq{\\build{\n          \\tup{\\mathbf{w}, \\var{\\mathbf{d}}}\n        }{\n          \\tup{\\mathbf{w}, \\mathbf{d}} \\orderedin \\mathbf{i}\n        }}}\n      }{\n        \\mathbf{i} \\orderedin \\ready\n      }}\n    } \\;, \\\\\n    &&C(15) &\\mapsto \\encode{\n      \\sq{\\build{\\var{\\mathbf{i}}}{\\mathbf{i} \\orderedin \\accumulated}}\n    } \\;, \\\\\n    &&C(16) &\\mapsto \\encode{\n      \\var{\\sq{\\build{\\tup{\\encode[4]{s}, \\encode{h}}}{\\tup{s, h} \\orderedin \\lastaccout}}}\n    } \\;, \\\\\n    \\forall \\kv{s}{\\saX} \\in \\accounts: &&C(255, s) &\\mapsto \\encode{\n      \\saX_\\sa\u00accodehash,\n      \\encode[8]{\n        \\saX_\\sa\u00acbalance,\n        \\saX_\\sa\u00acminaccgas,\n        \\saX_\\sa\u00acminmemogas,\n        \\saX_\\sa\u00acoctets,\n        \\saX_\\sa\u00acgratis\n      },\n      \\encode[4]{\n        \\saX_\\sa\u00acitems,\n        \\saX_\\sa\u00accreated,\n        \\saX_\\sa\u00aclastacc,\n        \\saX_\\sa\u00acparent\n      }\n    } \\;, \\\\\n    \\forall \\kv{s}{\\saX} \\in \\accounts, \\kv{\\mathbf{k}}{\\mathbf{v}} \\in \\saX_\\sa\u00acstorage:\n      &&C(s, \\encode[4]{2^{32}-1} \\concat \\mathbf{k}) &\\mapsto \\mathbf{v} \\;, \\\\\n    \\forall \\kv{s}{\\saX} \\in \\accounts, \\kv{h}{\\mathbf{p}} \\in \\saX_\\sa\u00acpreimages:\n      &&C(s, \\encode[4]{2^{32}-2} \\concat h) &\\mapsto \\mathbf{p} \\;, \\\\\n    \\forall \\kv{s}{\\saX} \\in \\accounts, \\kv{\\tup{h, l}}{\\mathbf{t}} \\in \\saX_\\sa\u00acrequests:\n      &&C(s, \\encode[4]{l} \\concat h) &\\mapsto \\encode{\n        \\var{\\sq{\\build{\\encode[4]{x}}{x \\orderedin \\mathbf{t}}}}\n      }\n  }\n\\end{equation}"},
{"label": null,
"index": "D.3",
"tex": "\\begin{align}\n  B&\\colon\\abracegroup{\n    \\tuple{\\hash, \\hash} &\\to \\bitstring[512]"},
{"label": null,
"index": "D.4",
"tex": "\n    \\tup{l, r} &\\mapsto \\sq{0} \\concat \\text{bits}(l)\\interval{1}{} \\concat \\text{bits}(r)\n  }"},
{"label": null,
"index": "D.5",
"tex": "\n  L&\\colon\\abracegroup{\n    \\tuple{\\blob[31], \\blob} &\\to \\bitstring[512]"},
{"label": null,
"index": "D.6",
"tex": "\n    \\tup{k, v} &\\mapsto \\begin{cases}\n      \\sq{1, 0} \\concat \\text{bits}(\\encode[1]{\\len{v}})\\interval{2}{} \\concat \\text{bits}(k) \\concat \\text{bits}(v) \\concat \\sq{0, 0, \\dots} &\\when \\len{v} \\le 32\n      \\sq{1, 1, 0, 0, 0, 0, 0, 0} \\concat \\text{bits}(k) \\concat \\text{bits}(\\blake{v}) &\\otherwise\n    \\end{cases}\n  }\n\\end{align}"},
{"label": null,
"index": "D.7",
"tex": "\\begin{align}\n  \\merklizestate{\\thestate} &\\equiv M(\\set{\\build{\\kv{\\text{bits}(k)}{\\tup{k, v}}}{\\kv{k}{v} \\in T(\\thestate) }})"},
{"label": null,
"index": "D.8",
"tex": "\n  M(d: \\dictionary{\\bitstring}{\\tuple{\\blob[31], \\blob}}) &\\equiv \\begin{cases}\n    \\zerohash &\\when \\len{d} = 0\n    \\blake{\\text{bits}^{-1}(L(k, v))} &\\when \\values{d} = \\set{ \\tup{k, v} }\n    \\blake{\\text{bits}^{-1}(B(M(l), M(r)))} &\\otherwise\n    \\multicolumn{2}{l}{\\quad\\where \\forall b, p: \\kv{b}{p} \\in d \\Leftrightarrow \\kv{b\\interval{1}{}}{p} \\in \\begin{cases}\n      l &\\when b_0 = 0 \n      r &\\when b_0 = 1\n    \\end{cases}\n  }\\end{cases}\n\\end{align}"},
{"label": "eq:merklenode",
"index": "E.1",
"tex": "\\begin{equation}\n  N\\colon\\abracegroup{\n    \\tuple{\\sequence{\\blob[n]}, \\blob \\to \\hash} &\\to \\blob[n] \\cup \\hash \\\\\n    \\tup{\\mathbf{v}, H} &\\mapsto \\begin{cases}\n      \\zerohash &\\when \\len{\\mathbf{v}} = 0 \\\\\n      \\mathbf{v}_0 &\\when \\len{\\mathbf{v}} = 1 \\\\\n      H(\\token{\\$node} \\concat N(\\mathbf{v}_{\\dots\\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}}}, H) \\concat N(\\mathbf{v}_{\\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}}\\dots}, H)) &\\otherwise\n    \\end{cases}\n  }\\label{eq:merklenode}\n\\end{equation}"},
{"label": null,
"index": "E.2",
"tex": "\\begin{equation}\n  T\\colon\\abracegroup{\n    \\tuple{\\sequence{\\blob[n]}, \\Nmax{\\len{\\mathbf{v}}}, \\blob \\to \\hash}\\ &\\to \\sequence{\\blob[n] \\cup \\hash}\\\\\n    \\tup{\\mathbf{v}, i, H} &\\mapsto \\begin{cases}\n     \\sq{N(P^\\bot(\\mathbf{v}, i), H)} \\concat T(P^\\top(\\mathbf{v}, i), i - P_I(\\mathbf{v}, i), H) &\\when \\len{\\mathbf{v}} > 1\\\\\n      \\sq{} &\\otherwise\\\\\n      \\multicolumn{2}{l}{\n        \\begin{aligned}\n          \\quad \\where P^s(\\mathbf{v}, i) &\\equiv \\begin{cases}\n            \\mathbf{v}_{\\dots\\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}}} &\\when (i < \\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}}) = s\\\\\n            \\mathbf{v}_{\\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}}\\dots} &\\otherwise\n          \\end{cases}\\\\[4pt]\n          \\quad \\also P_I(\\mathbf{v}, i) &\\equiv \\begin{cases}\n            0 &\\when i < \\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}} \\\\\n            \\ceil{\\nicefrac{\\len{\\mathbf{v}}}{2}} &\\otherwise\n          \\end{cases}\\\\\n        \\end{aligned}\n      }\n    \\end{cases}\\\\\n  }\n\\end{equation}"},
{"label": "eq:simplemerkleroot",
"index": "E.3",
"tex": "\\begin{equation}\n    \\fnmerklizewb\\colon \\abracegroup{\n      \\label{eq:simplemerkleroot}\n      \\tuple{\\sequence{\\blob}, \\blob \\to \\hash} &\\to \\hash \\\\\n      \\tup{\\mathbf{v}, H} &\\mapsto \\begin{cases}\n        H(\\mathbf{v}_0) &\\when \\len{\\mathbf{v}} = 1 \\\\\n        N(\\mathbf{v}, H) &\\otherwise\n      \\end{cases} \\\\\n    }\n\\end{equation}"},
{"label": "eq:constantdepthmerkleroot",
"index": "E.4",
"tex": "\\begin{align}\n  \\label{eq:constantdepthmerkleroot}\n  \\fnmerklizecd&\\colon \\abracegroup{\n    \\tuple{\\sequence{\\blob}, \\blob \\to \\hash} &\\to \\hash"},
{"label": null,
"index": "E.5",
"tex": "\n    \\tup{\\mathbf{v}, H} &\\mapsto N(C(\\mathbf{v}, H), H)\n  }"},
{"label": "eq:constantdepthsubtreemerklejust",
"index": "E.6",
"tex": "\n  \\label{eq:constantdepthsubtreemerklejust}\n  \\fnmerklejustsubpath{x}&\\colon \\abracegroup{\n    \\tuple{\\sequence{\\blob}, \\Nmax{\\len{\\mathbf{v}}}, \\blob \\to \\hash} &\\to \\sequence{\\hash}"},
{"label": null,
"index": "E.7",
"tex": "\n    \\tup{\\mathbf{v}, i, H} &\\mapsto T(C(\\mathbf{v}, H), 2^xi, H)_{\\dots\\max(0, \\ceil{\\log_2(\\max(1, \\len{\\mathbf{v}})) - x})}\n  }"},
{"label": "eq:constantdepthsubtreemerkleleafpage",
"index": "E.8",
"tex": "\n  \\label{eq:constantdepthsubtreemerkleleafpage}\n  \\fnmerklesubtreepage{x}&\\colon \\abracegroup{\n    \\tuple{\\sequence{\\blob}, \\Nmax{\\len{\\mathbf{v}}}, \\blob \\to \\hash} &\\to \\sequence{\\hash}"},
{"label": null,
"index": "E.9",
"tex": "\n    \\tup{\\mathbf{v}, i, H} &\\mapsto \\sq{\\build{H(\\token{\\$leaf} \\concat l)}{l \\orderedin \\mathbf{v}_{2^xi \\dots \\min(2^xi+2^x, \\len{\\mathbf{v}})}}}\n  }\n\\end{align}"},
{"label": null,
"index": "E.10",
"tex": "\\begin{equation}\n  C\\colon\\abracegroup{\n    \\tuple{\\sequence{\\blob}, \\blob \\to \\hash} &\\to \\sequence{\\hash}\\\\\n    \\tup{\\mathbf{v}, H} &\\mapsto \\mathbf{v}' \\ \\where \\abracegroup[\\;]{\n      \\len{\\mathbf{v}} &= 2^{\\ceil{\\log_2(\\max(1, \\len{\\mathbf{v}}))}}\\\\\n      \\mathbf{v}'\\sub{i} &= \\begin{cases}\n        H(\\token{\\$leaf} \\concat \\mathbf{v}\\sub{i}) &\\when i < \\len{\\mathbf{v}}\\\\\n        \\zerohash &\\otherwise \\\\\n      \\end{cases}\n    }\n  }\n\\end{equation}"},
{"label": "eq:mmrappend",
"index": "E.11",
"tex": "\\begin{equation}\n  \\begin{aligned}\n    \\label{eq:mmrappend}\n    \\fnmmrappend&\\colon\\deffunc{\n      \\tuple{\\sequence{\\optional{\\hash}}, \\hash, \\blob\\to\\hash} &\\to \\sequence{\\optional{\\hash}}\\\\\n      \\tup{\\mathbf{r}, l, H} &\\mapsto P(\\mathbf{r}, l, 0, H)\n    }\\\\\n    \\where P&\\colon\\deffunc{\n      \\tuple{\\sequence{\\optional{\\hash}}, \\hash, \\N, \\blob\\to\\hash} &\\to \\sequence{\\optional{\\hash}}\\\\\n      \\tup{\\mathbf{r}, l, n, H} &\\mapsto \\begin{cases}\n        \\mathbf{r} \\append l &\\when n \\ge \\len{\\mathbf{r}}\\\\\n        R(\\mathbf{r}, n, l) &\\when n < \\len{\\mathbf{r}} \\wedge \\mathbf{r}\\sub{n} = \\none\\\\\n        P(R(\\mathbf{r}, n, \\none), H(\\mathbf{r}\\sub{n} \\concat l), n + 1, H) &\\otherwise\n      \\end{cases}\n    }\\\\\n    \\also R&\\colon\\deffunc{\n      \\tuple{\\sequence{T}, \\N, T} &\\to \\sequence{T}\\\\\n      \\tup{\\mathbf{s}, i, v} &\\mapsto \\mathbf{s}'\\ \\where \\mathbf{s}' = \\mathbf{s} \\exc \\mathbf{s}'\\sub{i} = v\n    }\n  \\end{aligned}\n\\end{equation}"},
{"label": null,
"index": "E.12",
"tex": "\\begin{equation}\n  \\fnmmrencode\\colon\\deffunc{\n    \\sequence{\\optional{\\hash}} &\\to \\blob \\\\\n    \\mathbf{b} &\\mapsto \\encode{\\var{\\sq{\\build{\\maybe{x}}{x \\orderedin \\mathbf{b}}}}}\n  }\n\\end{equation}"},
{"label": null,
"index": "E.13",
"tex": "\\begin{equation}\n  \\fnmmrsuperpeak\\colon\\deffunc{\n    \\sequence{\\optional{\\hash}} &\\to \\hash \\\\\n    \\mathbf{b} &\\mapsto \\begin{cases}\n      \\zerohash &\\when \\len{\\mathbf{h}} = 0\\\\\n      \\mathbf{h}_0 &\\when \\len{\\mathbf{h}} = 1\\\\\n      \\keccak{\\token{\\$peak} \\concat \\mmrsuperpeak{\\mathbf{h}_{\\dots\\len{\\mathbf{h}}-1}} \\concat \\mathbf{h}_{\\len{\\mathbf{h}}-1}} &\\otherwise \\\\\n      \\multicolumn{2}{l}{\\where \\mathbf{h} = \\sq{\\build{h}{h \\orderedin \\mathbf{b}, h \\ne \\none}}}\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": "eq:suffle",
"index": "F.1",
"tex": "\\begin{equation}\\label{eq:suffle}\n  \\forall T, l \\in \\N: \\fnfyshuffle\\colon\\abracegroup{\n    \\tuple{\\sequence[l]{T}, \\sequence[l:]{\\N}} &\\to \\sequence[l]{T}\\\\\n    \\tup{\\mathbf{s}, \\mathbf{r}} &\\mapsto \\begin{cases}\n      \\sq{\\mathbf{s}_{\\mathbf{r}_0 \\bmod l}} \\concat \\fyshuffle{\\mathbf{s}'\\sub{\\dots l-1}, \\mathbf{r}\\sub{1\\dots}}\\ \\where \\mathbf{s}' = \\mathbf{s} \\exc \\mathbf{s'}\\sub{\\mathbf{r}_0 \\bmod l} = \\mathbf{s}\\sub{l - 1} &\\when \\mathbf{s} \\ne \\sq{}\\\\\n      \\sq{} &\\otherwise\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "F.2",
"tex": "\\begin{align}\n  \\forall l \\in \\N:\\ \\fnseqfromhash{l}&\\colon\\abracegroup{\n    \\hash &\\to \\sequence[l]{\\Nbits{32}}"},
{"label": null,
"index": "F.3",
"tex": "\n    h &\\mapsto \\sq{\\build{\n      \\decode[4]{\\blake{h \\concat \\encode[4]{\\floor{\\nicefrac{i}{8}}}}\n      \\sub{4i \\bmod 32 \\dots+4}}\n    }{\n      i \\orderedin \\N\\sub{l}\n    }}\n  }"},
{"label": "eq:sequencefromhash",
"index": "F.4",
"tex": "\n  \\label{eq:sequencefromhash}\n  \\forall T, l \\in \\N:\\ \\fnfyshuffle&\\colon\\abracegroup{\n    \\tuple{\\sequence[l]{T}, \\hash} &\\to \\sequence[l]{T}"},
{"label": null,
"index": "F.5",
"tex": "\n    \\tup{\\mathbf{s}, h} &\\mapsto \\fyshuffle{\\mathbf{s}, \\seqfromhash{l}{h}}\n  }\n\\end{align}"},
{"label": null,
"index": "G.1",
"tex": "\\begin{align}\n  \\bssignature{k \\in \\bskey}{c \\in \\hash}{m \\in \\blob} \\subset \\blob[96] &\\equiv \\set{\\build{x}{x \\in \\blob[96], \\text{verify}(k, c, m, x) = \\top }}  "},
{"label": null,
"index": "G.2",
"tex": "\n  \\banderout{s \\in \\bssignature{k}{c}{m}} \\in \\hash &\\equiv \\text{output}(x \\mid x \\in \\bssignature{k}{c}{m})\\interval{}{32}\n\\end{align}"},
{"label": null,
"index": "G.3",
"tex": "\\begin{align}\n  \\getringroot{\\sequence{\\bskey}} \\in \\ringroot &\\equiv \\text{commit}(\\sequence{\\bskey})  "},
{"label": null,
"index": "G.4",
"tex": "\n  \\bsringproof{r \\in \\ringroot}{c \\in \\hash}{m \\in \\blob} \\subset \\blob[784] &\\equiv \\set{\\build{x}{x \\in \\blob[784], \\text{verify}(r, c, m, x) = \\top }}  "},
{"label": null,
"index": "G.5",
"tex": "\n  \\banderout{p \\in \\bsringproof{r}{c}{m}} \\in \\hash &\\equiv \\text{output}(x \\mid x \\in \\bsringproof{r}{c}{m})\\interval{}{32}\n\\end{align}"},
{"label": null,
"index": "H.1",
"tex": "\\begin{align}\n  \\forall n \\in \\N, k \\in \\N :\\ &\\spl{n}(\\mathbf{d} \\in \\blob[kn]) \\in \\sequence[k]{\\blob[n]} \\equiv \\sq{\\mathbf{d}\\subrange{0}{n}, \\mathbf{d}\\subrange{n}{n}, \\cdots, \\mathbf{d}\\subrange{(k-1)n}{n}} "},
{"label": null,
"index": "H.2",
"tex": "\n  \\forall n \\in \\N, k \\in \\N :\\ &\\join(\\mathbf{c} \\in \\sequence[k]{\\blob[n]}) \\in \\blob[kn] \\equiv \\mathbf{c}_0 \\concat \\mathbf{c}_1 \\concat \\dots\n\\end{align}"},
{"label": "eq:transpose",
"index": "H.3",
"tex": "\\begin{equation}\\label{eq:transpose}\n  {}^\\text{T}\\sq{\\sq{\\mathbf{x}_{0, 0}, \\mathbf{x}_{0, 1}, \\mathbf{x}_{0, 2}, \\dots}, \\sq{\\mathbf{x}_{1, 0}, \\mathbf{x}_{1, 1}, \\dots}, \\dots} \\equiv \\sq{\\sq{\\mathbf{x}_{0, 0}, \\mathbf{x}_{1, 0}, \\mathbf{x}_{2, 0}, \\dots}, \\sq{\\mathbf{x}_{0, 1}, \\mathbf{x}_{1, 1}, \\dots}, \\dots}\n\\end{equation}"},
{"label": "eq:erasurecoding",
"index": "H.4",
"tex": "\\begin{equation}\\label{eq:erasurecoding}\n  \\fnerasurecode_{k \\in \\N}\\colon\\abracegroup{\n    \\blob[684k] &\\to \\sequence[1023]{\\blob[2k]} \\\\\n    \\mathbf{d} &\\mapsto \\join^\\#({}^{\\text{T}}\\sq{\\build{\\erasurecode{\\mathbf{p}}}{\\mathbf{p} \\orderedin{}^\\text{T}\\spl{2}^\\#(\\spl{2k}(\\mathbf{d}))}})\n  }\n\\end{equation}"},
{"label": "eq:erasurecodinginv",
"index": "H.5",
"tex": "\\begin{equation}\n  \\label{eq:erasurecodinginv}\n  \\fnecrecover_{k \\in \\N}\\colon\\abracegroup{\n    \\protoset{\\tuple{\\blob[2k], \\Nmax{1023}}}_{342} &\\to \\blob[684k] \\\\\n    \\mathbf{c} &\\mapsto \\begin{cases}\n      \\encode{\\sq{\\build{\\mathbf{x}}{\\tup{\\mathbf{x}, i} \\orderedin \\sqorderby{i}{\\tup{\\mathbf{x}, i} \\in \\mathbf{c}}}}} &\\when \\set{\\build{i}{\\tup{\\mathbf{x}, i} \\in \\mathbf{c}}} = \\Nmax{342}\\\\\n      \\join(\\join^\\#({}^\\text{T}\\sq{\n        \\build{\n          \\ecrecover{}{\\set{\\build{\n           (\\spl{2}(\\mathbf{x})\\sub{p}, i)\n          }{\n            \\tup{\\mathbf{x}, i} \\in \\mathbf{c}\n          }}}\n        }{\n          p \\in \\Nmax{k}\n        }\n      })) &\\text{always}\\\\\n    \\end{cases}\n  }\n\\end{equation}"},
{"label": null,
"index": "H.6",
"tex": "\\begin{equation}\nx^{16} + x^5 + x^3 + x^2 + 1\n\\end{equation}"},
{"label": null,
"index": "H.7",
"tex": "\\begin{equation}\n\\finitefield_{16} \\equiv \\frac{\\finitefield_2\\subb{x}}{x^{16}} + x^5 + x^3 + x^2 + 1\n\\end{equation}"},
{"label": null,
"index": "H.8",
"tex": "\\begin{equation}\nm\\sub{i} = \\tup{m\\sub{i, 0} \\ldots m\\sub{i, 15}}\n\\end{equation}"},
{"label": null,
"index": "H.9",
"tex": "\\begin{equation}\n\\tilde{i} = \\sum^{15}_{j = 0} i\\sub{j} v\\sub{j}\n\\end{equation}"},
{"label": null,
"index": "H.10",
"tex": "\\begin{equation}\n   \\begin{array}{l}\n     p (\\tilde{0}) = \\widetilde{m_0}\\\\\n     p (\\tilde{1}) = \\widetilde{m_1}\\\\\n     \\vdots\\\\\n     p (\\widetilde{341}) = \\widetilde{m_{341}}\n   \\end{array}\n\\end{equation}"},
{"label": null,
"index": "H.11",
"tex": "\\begin{equation}\n   \\begin{array}{l}\n     \\widetilde{r_{342}} : = p (\\widetilde{342})\\\\\n     \\widetilde{r_{343}} : = p (\\widetilde{343})\\\\\n     \\vdots\\\\\n     \\widetilde{r_{1022}} : = p (\\widetilde{1022})\n   \\end{array}\n\\end{equation}"}]